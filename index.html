<!DOCTYPE html>
<html :lang="currentLanguage" :dir="currentLanguage === 'ar' ? 'rtl' : 'ltr'">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title x-text="translations[currentLanguage].title">ŸÑŸàÿ≠ÿ© ÿ™ÿ≠ŸÉŸÖ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© - SABIC</title>

    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/jspdf-autotable@latest/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

    <script>
        // Ensure jsPDF is available globally
        window.addEventListener('load', function() {
            if (typeof window.jspdf !== 'undefined') {
                window.jsPDF = window.jspdf.jsPDF;
            }
            // Alternative check
            if (typeof window.jsPDF === 'undefined' && typeof window.jspdf !== 'undefined') {
                window.jsPDF = window.jspdf.jsPDF;
            }
        });
    </script>

    <style>
        :root {
            /* SABIC Official Colors */
            --primary: #004C97;
            --primary-light: #1E5AA8;
            --primary-dark: #003875;
            --secondary: #F9A11B;
            --secondary-light: #FBB040;
            --secondary-dark: #E08900;

            /* Button Colors - Gray Theme */
            --btn-light: #F1F5F9;
            --btn-light-hover: #E2E8F0;
            --btn-light-border: #CBD5E1;
            --btn-dark: #64748B;
            --btn-dark-hover: #475569;
            --btn-dark-border: #334155;
            --btn-darker: #334155;
            --btn-darker-hover: #1E293B;
            --btn-darker-border: #0F172A;

            /* Neutral Colors */
            --dark: #1F2937;
            --light: #F8FAFC;
            --card-bg: #FFFFFF;
            --border: #E2E8F0;
            --text-primary: #0F172A;
            --text-secondary: #64748B;
            --text-muted: #94A3B8;

            /* Layout */
            --sidebar-width: 280px;
            --border-radius: 8px;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--light);
            color: var(--text-primary);
            overflow-x: hidden;
            transition: all 0.3s ease;
        }

        /* RTL/LTR Support */
        [dir="rtl"] {
            font-family: 'Segoe UI', 'Tahoma', 'Arial', sans-serif;
        }

        [dir="ltr"] {
            font-family: 'Segoe UI', 'Roboto', 'Arial', sans-serif;
        }

        /* Language Toggle in Header */
        .language-toggle-header {
            display: flex;
            background: linear-gradient(135deg, var(--primary), #003875);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 16px rgba(0, 76, 151, 0.3);
        }

        .lang-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .lang-btn.active {
            background: rgba(255, 255, 255, 0.25);
            color: white;
            font-weight: 700;
        }

        .lang-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.15);
            color: white;
        }

        .lang-btn i {
            font-size: 0.9rem;
        }



        /* Sidebar RTL/LTR */
        [dir="rtl"] .sidebar {
            right: 0;
            left: auto;
        }

        [dir="ltr"] .sidebar {
            left: 0;
            right: auto;
        }

        [dir="rtl"] .main-content {
            margin-right: var(--sidebar-width);
            margin-left: 0;
        }

        [dir="ltr"] .main-content {
            margin-left: var(--sidebar-width);
            margin-right: 0;
        }

        /* Sidebar collapsed state for LTR */
        [dir="ltr"] .sidebar.collapsed {
            transform: translateX(-100%);
        }

        [dir="rtl"] .sidebar.collapsed {
            transform: translateX(100%);
        }

        [dir="ltr"] .main-content.expanded {
            margin-left: 0;
        }

        [dir="rtl"] .main-content.expanded {
            margin-right: 0;
        }

        /* Sidebar Styles */
        .sidebar {
            position: fixed;
            top: 0;
            width: min(80vw, var(--sidebar-width));
            height: 100vh;
            background: linear-gradient(180deg, var(--primary) 0%, #003875 100%);
            color: white;
            z-index: 1000;
            transition: transform 0.3s ease;
            overflow-y: auto;
        }

        [dir="rtl"] .sidebar { right: 0; }
        [dir="ltr"] .sidebar { left: 0; }

        [dir="ltr"] .sidebar {
            left: 0;
        }

        .sidebar.collapsed {
            transform: translateX(100%);
        }
        [dir="ltr"] .sidebar.collapsed { transform: translateX(-100%); }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-logo {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .sidebar-subtitle {
            font-size: 0.875rem;
            opacity: 0.8;
        }

        .sidebar-nav {
            padding: 1rem 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.2s;
            cursor: pointer;
        }

        .nav-item:hover,
        .nav-item.active {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .nav-item i {
            width: 20px;
            margin-left: 0.75rem;
        }

        /* Main Content */
        .main-content {
            min-height: 100vh;
            transition: all 0.3s ease;
            padding: 2rem;
        }

        [dir="rtl"] .main-content {
            margin-right: var(--sidebar-width);
            margin-left: 0;
        }

        [dir="ltr"] .main-content {
            margin-left: var(--sidebar-width);
            margin-right: 0;
        }

        .main-content.expanded {
            margin-right: 0;
            margin-left: 0;
        }

        /* Header */
        .header {
            background: white;
            padding: 0.75rem 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1100; /* keep header above sidebar */
        }

        .header-title {
            font-size: clamp(1rem, 2.2vw, 1.5rem);
            font-weight: 700;
            color: var(--primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 60vw;
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .hamburger-btn {
            background: transparent;
            border: none;
            width: 40px;
            height: 40px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--primary);
        }

        /* Content Area */
        .content {
            padding: 2rem;
        }

        /* Professional Cards */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--btn-dark), var(--btn-darker));
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
            border-color: var(--primary-light);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        @media (max-width: 1024px) { .kpi-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 640px) { .kpi-grid { grid-template-columns: 1fr; } }

        .kpi-card {
            background: linear-gradient(135deg, var(--primary), #003875);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .kpi-card:hover::before {
            transform: translateX(100%);
        }

        .kpi-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .kpi-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .kpi-icon {
            position: absolute;
            top: 1rem;
            left: 1rem;
            font-size: 2rem;
            opacity: 0.3;
        }

        /* Professional Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: 1px solid transparent;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: var(--shadow);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--btn-dark), var(--btn-darker));
            color: white;
            border-color: var(--btn-darker-border);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--btn-darker), var(--btn-darker-hover));
            border-color: var(--btn-darker-border);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--btn-light), var(--btn-light-hover));
            color: var(--text-primary);
            border-color: var(--btn-light-border);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, var(--btn-light-hover), var(--btn-dark));
            color: white;
            border-color: var(--btn-dark-border);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--btn-dark), var(--btn-darker));
            color: white;
            border-color: var(--btn-darker-border);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, var(--btn-darker), var(--btn-darker-hover));
            border-color: var(--btn-darker-border);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--btn-darker), var(--btn-darker-hover));
            color: white;
            border-color: var(--btn-darker-border);
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, var(--btn-darker-hover), var(--text-primary));
            border-color: var(--btn-darker-border);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--btn-dark), var(--btn-darker));
            color: white;
            border-color: var(--btn-darker-border);
        }

        .btn-info:hover {
            background: linear-gradient(135deg, var(--btn-darker), var(--btn-darker-hover));
            border-color: var(--btn-darker-border);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--btn-light), var(--btn-light-hover));
            color: var(--text-primary);
            border-color: var(--btn-light-border);
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, var(--btn-light-hover), var(--btn-dark));
            color: white;
            border-color: var(--btn-dark-border);
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            background: var(--card-bg);
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: all 0.3s ease;
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 76, 151, 0.1), inset 0 1px 2px rgba(0, 0, 0, 0.05);
            background: #FEFEFE;
        }

        .form-input:hover,
        .form-select:hover {
            border-color: var(--primary-light);
        }

        .form-checkbox {
            width: 1rem;
            height: 1rem;
            border: 2px solid var(--border);
            border-radius: 3px;
            background: var(--card-bg);
            transition: all 0.2s ease;
        }

        .form-checkbox:checked {
            background: var(--primary);
            border-color: var(--primary);
        }

        /* Dropzone */
        .dropzone {
            border: 2px dashed var(--primary);
            border-radius: 12px;
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #F8FAFC;
        }

        .dropzone:hover,
        .dropzone.drag-over {
            background: #EBF4FF;
            border-color: #003875;
            transform: scale(1.02);
        }

        .dropzone-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        /* Table */
        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--card-bg);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-bg);
        }

        .table th,
        .table td {
            padding: 0.75rem;
            text-align: right;
            border-bottom: 1px solid var(--border);
            color: var(--text-primary);
        }

        .table th {
            background: var(--light);
            font-weight: 600;
            color: var(--text-primary);
        }

        .table tr:hover {
            background: var(--light);
        }

        /* Charts */
        .chart-container {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            min-height: 400px;
            transition: all 0.3s ease;
        }

        .chart-container:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-1px);
        }

        /* Status Badges */
        .status {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-success {
            background: #DCFCE7;
            color: #166534;
        }

        .status-warning {
            background: #FEF3C7;
            color: #92400E;
        }

        .status-danger {
            background: #FEE2E2;
            color: #991B1B;
        }

        .status-info {
            background: #DBEAFE;
            color: #1E40AF;
        }

        /* Mobile overlay for sidebar */
        .mobile-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,0.45); z-index: 900; }

        /* Tablet & down: make content full width and sidebar overlay */
        @media (max-width: 1024px) {
            [dir="rtl"] .main-content, [dir="ltr"] .main-content { margin: 0 !important; }
            .main-content { padding: 1rem; }
            .sidebar { width: min(90vw, 320px); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: min(90vw, 320px);
            }

            .main-content {
                margin: 0 !important;
            }

            .kpi-grid {
                grid-template-columns: 1fr;
            }

            .header {
                padding: 0.75rem 1rem;
                flex-direction: row;
                gap: 0.5rem;
            }

            .header-actions {
                flex-direction: row;
                width: auto;
                gap: 0.25rem;
                flex-wrap: wrap;
            }

            .content {
                padding: 1rem;
            }

            .card {
                padding: 1rem;
            }

            .grid {
                grid-template-columns: 1fr !important;
            }

            .table-container {
                font-size: 0.875rem;
            }

            .btn {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }

            .form-input,
            .form-select {
                padding: 0.5rem;
            }
        }

        @media (max-width: 480px) {
            .header-title {
                font-size: 1.25rem;
            }

            .kpi-value {
                font-size: 1.5rem;
            }

            .card-title {
                font-size: 1rem;
            }

            .btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
            }
        }

        /* Extra small phones tweaks */
        @media (max-width: 480px) {
            .header-title { font-size: 1.1rem; }
            .hamburger-btn { width: 36px; height: 36px; font-size: 1rem; }
            .lang-btn { padding: 0.35rem 0.6rem; font-size: 0.75rem; }
            .btn { padding: 0.4rem 0.6rem; font-size: 0.8rem; }
            .form-label { font-size: 0.8rem; }
            .form-input, .form-select { font-size: 0.8rem; padding: 0.4rem 0.5rem; }
            .table { font-size: 0.8rem; }
        }

        /* Dark Mode */
        body.dark {
            background: #111827;
            color: #F9FAFB;
        }

        body.dark .card,
        body.dark .chart-container {
            background: #1F2937;
            border-color: #374151;
        }

        body.dark .header {
            background: #1F2937;
            border-bottom: 1px solid #374151;
        }

        body.dark .form-input,
        body.dark .form-select {
            background: #374151;
            border-color: #4B5563;
            color: #F9FAFB;
        }

        body.dark .table {
            background: #1F2937;
        }

        body.dark .table th {
            background: #374151;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        /* Professional Export Buttons - Gray Theme */
        .export-btn-excel {
            background: linear-gradient(135deg, var(--btn-dark), var(--btn-darker));
            border-color: var(--btn-darker-border);
            color: white;
            position: relative;
        }

        .export-btn-excel:hover {
            background: linear-gradient(135deg, var(--btn-darker), var(--btn-darker-hover));
            border-color: var(--btn-darker-border);
        }

        .export-btn-pdf {
            background: linear-gradient(135deg, var(--btn-darker), var(--btn-darker-hover));
            border-color: var(--btn-darker-border);
            color: white;
            position: relative;
        }

        .export-btn-pdf:hover {
            background: linear-gradient(135deg, var(--btn-darker-hover), var(--text-primary));
            border-color: var(--btn-darker-border);
        }

        .export-btn-csv {
            background: linear-gradient(135deg, var(--btn-light), var(--btn-light-hover));
            border-color: var(--btn-light-border);
            color: var(--text-primary);
            position: relative;
        }

        .export-btn-csv:hover {
            background: linear-gradient(135deg, var(--btn-light-hover), var(--btn-dark));
            color: white;
            border-color: var(--btn-dark-border);
        }

        /* Icon Styles */
        .btn i {
            font-size: 1rem;
            margin-right: 0.25rem;
        }

        .fas, .far {
            color: inherit;
        }

        /* Report Card Styles */
        .report-card {
            transition: all 0.3s ease;
            border: 1px solid #E5E7EB;
        }

        .report-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .format-buttons {
            display: flex;
            gap: 4px;
        }

        .format-buttons .btn {
            padding: 4px 8px;
            font-size: 10px;
            min-width: auto;
        }

        /* Search Export Section */
        .export-section {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .export-section .btn {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .export-section .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .export-label {
            font-weight: 600;
            color: var(--text-primary);
            white-space: nowrap;
        }

        .export-divider {
            width: 1px;
            height: 2rem;
            background: var(--border);
        }

        /* Search Actions Container */
        .search-actions {
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .search-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            justify-content: space-between;
        }

        @media (max-width: 768px) {
            .search-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .export-section {
                flex-direction: column;
                gap: 0.75rem;
            }

            .export-section .btn {
                width: 100%;
                justify-content: center;
            }
        }
        /* === Mobile fixes (force no sidebar margin) === */
        @media (max-width: 768px) {
            [dir="rtl"] .main-content,
            [dir="ltr"] .main-content {
                margin: 0 !important; /* override RTL/LTR margins on mobile */
            }

            /* Sidebar covers full width on phones */
            .sidebar {
                width: 100% !important;
                max-width: 100% !important;
            }

            /* Slightly tighter content padding on mobile */
            .content { padding: 1rem !important; }

            /* Keep header pinned like desktop on phones */
            .header {
                position: fixed;
                top: env(safe-area-inset-top, 0);
                left: 0;
                right: 0;
                width: 100%;
                z-index: 1100; /* ensure above sidebar/backdrop */
            }

            /* Add space under fixed header so content doesn't slide under it */
            [dir="rtl"] .main-content,
            [dir="ltr"] .main-content {
                padding-top: calc(64px + 1rem) !important; /* header height + spacing */
            }
        }
    </style>
</head>

<body x-data="dashboard()" x-init="init()" x-effect="document.body.style.overflow = (window.innerWidth <= 768 && sidebarOpen) ? 'hidden' : ''">


    <!-- Sidebar -->
    <div class="sidebar" :class="{ 'collapsed': !sidebarOpen }">
        <div class="sidebar-header">
            <div class="sidebar-logo">SABIC Analytics</div>
            <div class="sidebar-subtitle" x-text="translations[currentLanguage].subtitle"></div>
        </div>

        <nav class="sidebar-nav">
            <!-- Upload Files -->
            <a class="nav-item" :class="{ 'active': currentView === 'upload' }" @click="setView('upload')">
                <i class="fas fa-upload"></i>
                <span x-text="translations[currentLanguage].nav.upload"></span>
            </a>

            <!-- Smart Search -->
            <a class="nav-item" :class="{ 'active': currentView === 'search' }" @click="setView('search')">
                <i class="fas fa-search"></i>
                <span x-text="translations[currentLanguage].nav.search"></span>
            </a>

            <!-- Overview (Dashboard) -->
            <a class="nav-item" :class="{ 'active': currentView === 'dashboard' }" @click="setView('dashboard')">
                <i class="fas fa-tachometer-alt"></i>
                <span x-text="translations[currentLanguage].nav.dashboard"></span>
            </a>

            <!-- Analytics -->
            <a class="nav-item" :class="{ 'active': currentView === 'analytics' }" @click="setView('analytics')">
                <i class="fas fa-chart-line"></i>
                <span x-text="translations[currentLanguage].nav.analytics"></span>
            </a>

            <!-- Reports -->
            <a class="nav-item" :class="{ 'active': currentView === 'reports' }" @click="setView('reports')">
                <i class="fas fa-file-alt"></i>
                <span x-text="translations[currentLanguage].nav.reports"></span>
            </a>

            <!-- Emails -->
            <a class="nav-item" :class="{ 'active': currentView === 'email' }" @click="setView('email')">
                <i class="fas fa-envelope"></i>
                <span x-text="translations[currentLanguage].nav.email"></span>
            </a>

            <!-- Cost Calculation -->
            <a class="nav-item" :class="{ 'active': currentView === 'costs' }" @click="setView('costs')">
                <i class="fas fa-calculator"></i>
                <span x-text="translations[currentLanguage].nav.costs"></span>
            </a>

            <!-- Settings -->
            <a class="nav-item" :class="{ 'active': currentView === 'settings' }" @click="setView('settings')">
                <i class="fas fa-cog"></i>
                <span x-text="translations[currentLanguage].nav.settings"></span>
            </a>
        </nav>
    </div>

    <!-- Main Content -->
        <!-- Backdrop for mobile when sidebar is open -->
        <div x-show="sidebarOpen && isMobile()" x-transition.opacity class="mobile-backdrop" @click="sidebarOpen = false"></div>

    <div class="main-content" :class="{ 'expanded': !sidebarOpen }">
        <!-- Header -->
        <header class="header">
            <div class="flex items-center gap-4">
                <button @click="sidebarOpen = !sidebarOpen" class="hamburger-btn" aria-label="Menu">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 class="header-title" x-text="getViewTitle()"></h1>
            </div>

            <div class="header-actions">
                <!-- Language Toggle -->
                <div class="language-toggle-header">
                    <button @click="setLanguage('ar')" :class="{ 'active': currentLanguage === 'ar' }" class="lang-btn">
                        <i class="fas fa-globe-asia"></i> ÿßŸÑÿπÿ±ÿ®Ÿäÿ©
                    </button>
                    <button @click="setLanguage('en')" :class="{ 'active': currentLanguage === 'en' }" class="lang-btn">
                        <i class="fas fa-globe-americas"></i> English
                    </button>
                </div>

                <button @click="toggleTheme()" class="btn btn-secondary">
                    <i :class="isDark ? 'fas fa-sun' : 'fas fa-moon'"></i>
                    <span x-text="isDark ? translations[currentLanguage].common.lightMode : translations[currentLanguage].common.darkMode"></span>
                </button>

                <div class="flex items-center gap-2">
                    <input type="checkbox" x-model="maskPII" id="maskPII">
                    <label for="maskPII" class="text-sm" x-text="translations[currentLanguage].common.hidePersonalData"></label>
                </div>
            </div>
        </header>

        <!-- Content -->
        <main class="content">
            <!-- Dashboard View -->
            <div x-show="currentView === 'dashboard'" class="fade-in">
                <!-- KPI Cards -->
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <i class="fas fa-users kpi-icon"></i>
                        <div class="kpi-value" x-text="kpis.totalRecords"></div>
                        <div class="kpi-label" x-text="translations[currentLanguage].dashboard.kpis.totalRecords"></div>
                    </div>
                    <div class="kpi-card" style="background: linear-gradient(135deg, var(--success), #059669);">
                        <i class="fas fa-check-circle kpi-icon"></i>
                        <div class="kpi-value" x-text="kpis.completionRate + '%'"></div>
                        <div class="kpi-label" x-text="translations[currentLanguage].dashboard.kpis.completionRate"></div>
                    </div>
                    <div class="kpi-card" style="background: linear-gradient(135deg, var(--warning), #D97706);">
                        <i class="fas fa-building kpi-icon"></i>
                        <div class="kpi-value" x-text="kpis.totalCompanies"></div>
                        <div class="kpi-label" x-text="translations[currentLanguage].dashboard.kpis.totalCompanies"></div>
                    </div>
                    <div class="kpi-card" style="background: linear-gradient(135deg, var(--info), #1D4ED8);">
                        <i class="fas fa-graduation-cap kpi-icon"></i>
                        <div class="kpi-value" x-text="kpis.totalPrograms"></div>
                        <div class="kpi-label" x-text="translations[currentLanguage].dashboard.kpis.totalPrograms"></div>
                    </div>
                </div>

                <!-- Charts Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="chart-container">
                        <div id="companyChart"></div>
                    </div>
                    <div class="chart-container">
                        <div id="programChart"></div>
                    </div>
                    <div class="chart-container">
                        <div id="attendanceChart"></div>
                    </div>
                    <div class="chart-container">
                        <div id="timelineChart"></div>
                    </div>
                </div>
            </div>

            <!-- Upload View -->
            <div x-show="currentView === 'upload'" class="fade-in">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title" x-text="translations[currentLanguage].upload.title"></h2>
                        <p class="text-gray-600" x-text="translations[currentLanguage].upload.subtitle"></p>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <div class="form-group">
                                <label class="form-label" x-text="translations[currentLanguage].upload.selectFile"></label>
                                <div class="dropzone"
                                     @click="$refs.fileInput.click()"
                                     @drop.prevent="handleDrop($event)"
                                     @dragover.prevent
                                     @dragenter.prevent="dragActive = true"
                                     @dragleave.prevent="dragActive = false"
                                     :class="{ 'drag-over': dragActive }">
                                    <input type="file" x-ref="fileInput" @change="handleFile($event.target.files[0])" accept=".xlsx,.xls" class="hidden">
                                    <i class="fas fa-cloud-upload-alt dropzone-icon"></i>
                                    <h3 class="text-lg font-semibold mb-2" x-text="translations[currentLanguage].upload.dragDrop"></h3>
                                    <p class="text-sm text-gray-600" x-text="translations[currentLanguage].upload.supportedFormats"></p>
                                </div>
                            </div>
                        </div>

                        <div>
                            <div class="form-group">
                                <label class="form-label" x-text="translations[currentLanguage].upload.selectSheet || 'ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸàÿ±ŸÇÿ©'"></label>
                                <select x-model="selectedSheet" class="form-select">
                                    <option value="" x-text="translations[currentLanguage].upload.chooseSheet || 'ÿßÿÆÿ™ÿ± Ÿàÿ±ŸÇÿ©...'"></option>
                                    <template x-for="sheet in sheets" :key="sheet">
                                        <option :value="sheet" x-text="sheet"></option>
                                    </template>
                                </select>
                            </div>

                            <div class="form-group">
                                <div class="flex gap-3">
                                    <button @click="processData()" :disabled="!selectedSheet || processing" class="btn btn-primary">
                                        <i class="fas fa-cog" :class="{ 'loading': processing }"></i>
                                        <span x-text="processing ? (translations[currentLanguage].upload.processing || 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ...') : (translations[currentLanguage].upload.analyze || 'ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™')"></span>
                                    </button>
                                    <button @click="clearData()" class="btn btn-danger">
                                        <i class="fas fa-trash"></i>
                                        <span x-text="translations[currentLanguage].upload.clear || 'ŸÖÿ≥ÿ≠ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™'"></span>
                                    </button>
                                </div>
                            </div>

                            <div x-show="status" class="mt-4">
                                <div :class="statusClass" class="status" x-text="status"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search View -->
            <div x-show="currentView === 'search'" class="fade-in">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title" x-text="translations[currentLanguage].search.title"></h2>
                    </div>

                    <!-- Advanced Multi-Filter System -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border border-blue-200 mb-6">
                        <h3 class="font-semibold text-blue-900 mb-4">üîç <span x-text="translations[currentLanguage].search.filters"></span></h3>

                        <!-- Filter Controls -->
                        <div class="space-y-4">
                            <template x-for="(filterItem, index) in advancedFilters" :key="index">
                                <div class="bg-white p-4 rounded-lg border border-blue-100">
                                    <div class="grid grid-cols-1 lg:grid-cols-5 gap-4 items-end">
                                        <!-- Enable/Disable Filter -->
                                        <div class="form-group">
                                            <label class="flex items-center space-x-2">
                                                <input type="checkbox" x-model="filterItem.enabled" @change="applyAdvancedFilter()" class="form-checkbox">
                                                <span class="form-label mb-0" x-text="translations[currentLanguage].search.enable"></span>
                                            </label>
                                        </div>

                                        <!-- Column Selection -->
                                        <div class="form-group">
                                            <label class="form-label" x-text="translations[currentLanguage].search.column"></label>
                                            <select x-model="filterItem.column" @change="updateFilterValues(index)" class="form-select" :disabled="!filterItem.enabled">
                                                <option value="" x-text="translations[currentLanguage].search.chooseColumn"></option>
                                                <template x-for="col in columns" :key="col">
                                                    <option :value="col" x-text="col"></option>
                                                </template>
                                            </select>
                                        </div>

                                        <!-- Value Selection -->
                                        <div class="form-group">
                                            <label class="form-label" x-text="translations[currentLanguage].search.value"></label>
                                            <!-- Date Range for Date Columns -->
                                            <div x-show="filterItem.enabled && isDateColumn(filterItem.column)" class="space-y-2">
                                                <input type="date" x-model="filterItem.startDate" class="form-input text-sm" :placeholder="translations[currentLanguage].search.fromDate" @change="applyAdvancedFilter()">
                                                <input type="date" x-model="filterItem.endDate" class="form-input text-sm" :placeholder="translations[currentLanguage].search.toDate" @change="applyAdvancedFilter()">
                                            </div>
                                            <!-- Dropdown for Categorical Columns -->
                                            <select x-show="filterItem.enabled && !isDateColumn(filterItem.column) && columnValues[filterItem.column]"
                                                    x-model="filterItem.value" @change="applyAdvancedFilter()" class="form-select">
                                                <option value="" x-text="translations[currentLanguage].search.allValues"></option>
                                                <template x-for="value in columnValues[filterItem.column]" :key="value">
                                                    <option :value="value" x-text="value"></option>
                                                </template>
                                            </select>
                                            <!-- Text Input for Other Columns -->
                                            <input x-show="filterItem.enabled && !isDateColumn(filterItem.column) && !columnValues[filterItem.column]"
                                                   type="text" x-model="filterItem.value" @keyup.enter="applyAdvancedFilter()"
                                                   class="form-input" :placeholder="translations[currentLanguage].search.enterValue">
                                        </div>



                                        <!-- Remove Filter -->
                                        <div class="form-group">
                                            <button @click="removeFilter(index)" class="btn btn-danger w-full" x-show="advancedFilters.length > 1">
                                                <i class="fas fa-trash"></i>
                                                <span x-text="translations[currentLanguage].search.delete"></span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <!-- Filter Actions -->
                        <div class="flex gap-3 mt-4">
                            <button @click="addFilter()" class="btn btn-primary">
                                <i class="fas fa-plus"></i>
                                <span x-text="translations[currentLanguage].search.addFilter"></span>
                            </button>
                            <button @click="applyAdvancedFilter()" class="btn btn-success">
                                <i class="fas fa-search"></i>
                                <span x-text="translations[currentLanguage].search.applyFilters"></span>
                            </button>
                            <button @click="resetAdvancedFilters()" class="btn btn-secondary">
                                <i class="fas fa-undo"></i>
                                <span x-text="translations[currentLanguage].search.reset"></span>
                            </button>
                        </div>
                    </div>

                    <!-- Quick Filters -->
                    <div x-show="quickFilters.length > 0" class="mb-6">
                        <h3 class="text-lg font-semibold mb-3" x-text="translations[currentLanguage].search.quickFilters || 'ŸÅŸÑÿßÿ™ÿ± ÿ≥ÿ±Ÿäÿπÿ©'"></h3>
                        <div class="flex flex-wrap gap-2">
                            <template x-for="quickFilter in quickFilters" :key="quickFilter.key">
                                <button @click="applyQuickFilter(quickFilter)"
                                        class="btn btn-secondary text-sm"
                                        :class="{ 'btn-primary': isQuickFilterActive(quickFilter) }">
                                    <span x-text="quickFilter.label"></span>
                                    <span class="ml-1" x-text="'(' + quickFilter.count + ')'"></span>
                                </button>
                            </template>
                        </div>
                    </div>

                    <!-- Search Actions -->
                    <div class="search-actions">
                        <div class="search-controls">
                            <!-- Search Controls -->
                            <div class="flex gap-3">
                                <button @click="applyFilter()" class="btn btn-primary">
                                    <i class="fas fa-search"></i>
                                    <span x-text="translations[currentLanguage].search.search || 'ÿ®ÿ≠ÿ´'"></span>
                                </button>
                                <button @click="resetFilter()" class="btn btn-secondary">
                                    <i class="fas fa-undo"></i>
                                    <span x-text="translations[currentLanguage].search.reset"></span>
                                </button>
                            </div>

                            <!-- Export Controls -->
                            <div x-show="visibleRows.length > 0" class="export-section fade-in">
                                <span class="export-label">
                                    <i class="fas fa-download text-blue-600"></i>
                                    <span x-text="translations[currentLanguage].search.export + ':'"></span>
                                </span>

                                <div class="flex gap-2">
                                    <button @click="exportFiltered('excel')" class="btn export-btn-excel">
                                        <i class="fas fa-file-excel"></i>
                                        <span x-text="translations[currentLanguage].search.excel"></span>
                                    </button>
                                    <button @click="exportFiltered('pdf')" class="btn export-btn-pdf">
                                        <i class="fas fa-file-pdf"></i>
                                        <span x-text="translations[currentLanguage].search.pdf"></span>
                                    </button>
                                    <button @click="exportFiltered('csv')" class="btn export-btn-csv">
                                        <i class="fas fa-file-csv"></i>
                                        <span x-text="translations[currentLanguage].search.csv"></span>
                                    </button>
                                </div>

                                <div class="export-divider"></div>

                                <button @click="generateFilterReport()" class="btn btn-info">
                                    <i class="fas fa-chart-bar"></i>
                                    <span x-text="translations[currentLanguage].search.detailedReport || 'ÿ™ŸÇÿ±Ÿäÿ± ÿ™ŸÅÿµŸäŸÑŸä'"></span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Filter Results Summary -->
                    <div x-show="visibleRows.length > 0" class="mb-6">
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200 mb-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="bg-blue-500 text-white p-2 rounded-full">
                                        <i class="fas fa-filter"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-blue-900" x-text="translations[currentLanguage].search.searchResults"></h3>
                                        <p class="text-sm text-blue-700">
                                            <span x-text="translations[currentLanguage].search.foundResults"></span>
                                            <strong x-text="visibleRows.length"></strong>
                                            <span x-text="translations[currentLanguage].search.outOf"></span>
                                            <strong x-text="rows.length"></strong>
                                            <span x-text="translations[currentLanguage].search.records"></span>
                                        </p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-2xl font-bold text-blue-600" x-text="Math.round((visibleRows.length / rows.length) * 100) + '%'"></div>
                                    <div class="text-xs text-blue-500" x-text="translations[currentLanguage].search.ofTotalData || 'ŸÖŸÜ ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™'"></div>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 lg:grid-cols-6 gap-4">
                            <div class="bg-white p-4 rounded-lg border border-gray-200 text-center hover:shadow-md transition-shadow">
                                <div class="text-2xl font-bold text-gray-700" x-text="visibleRows.length"></div>
                                <div class="text-sm text-gray-600" x-text="translations[currentLanguage].search.matchingResults"></div>
                                <div class="w-full bg-gray-100 rounded-full h-2 mt-2">
                                    <div class="bg-gray-500 h-2 rounded-full transition-all duration-500" :style="'width: ' + Math.round((visibleRows.length / rows.length) * 100) + '%'"></div>
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg border border-gray-200 text-center hover:shadow-md transition-shadow">
                                <div class="text-2xl font-bold text-gray-700" x-text="getFilteredCompletionRate() + '%'"></div>
                                <div class="text-sm text-gray-600" x-text="translations[currentLanguage].search.completionRate"></div>
                                <div class="w-full bg-gray-100 rounded-full h-2 mt-2">
                                    <div class="bg-gray-500 h-2 rounded-full transition-all duration-500" :style="'width: ' + getFilteredCompletionRate() + '%'"></div>
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg border border-gray-200 text-center hover:shadow-md transition-shadow">
                                <div class="text-2xl font-bold text-gray-700" x-text="getFilteredCompaniesCount()"></div>
                                <div class="text-sm text-gray-600" x-text="translations[currentLanguage].search.companiesCount"></div>
                                <div class="w-full bg-gray-100 rounded-full h-2 mt-2">
                                    <div class="bg-gray-500 h-2 rounded-full transition-all duration-500" :style="'width: ' + Math.min(100, (getFilteredCompaniesCount() / kpis.totalCompanies) * 100) + '%'"></div>
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg border border-gray-200 text-center hover:shadow-md transition-shadow">
                                <div class="text-2xl font-bold text-gray-700" x-text="getFilteredProgramsCount()"></div>
                                <div class="text-sm text-gray-600" x-text="translations[currentLanguage].search.programsCount"></div>
                                <div class="w-full bg-gray-100 rounded-full h-2 mt-2">
                                    <div class="bg-gray-500 h-2 rounded-full transition-all duration-500" :style="'width: ' + Math.min(100, (getFilteredProgramsCount() / kpis.totalPrograms) * 100) + '%'"></div>
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg border border-gray-200 text-center hover:shadow-md transition-shadow">
                                <div class="text-2xl font-bold text-gray-700" x-text="getFilteredClassesCount()"></div>
                                <div class="text-sm text-gray-600" x-text="translations[currentLanguage].search.classesCount"></div>
                                <div class="w-full bg-gray-100 rounded-full h-2 mt-2">
                                    <div class="bg-gray-500 h-2 rounded-full transition-all duration-500" :style="'width: ' + Math.min(100, (getFilteredClassesCount() / getTotalClasses()) * 100) + '%'"></div>
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg border border-gray-200 text-center hover:shadow-md transition-shadow" x-show="filteredCostStats.totalCost > 0">
                                <div class="text-2xl font-bold text-gray-700" x-text="formatCurrency(filteredCostStats.totalCost)"></div>
                                <div class="text-sm text-gray-600" x-text="translations[currentLanguage].search.totalCost"></div>
                                <div class="w-full bg-gray-100 rounded-full h-2 mt-2">
                                    <div class="bg-gray-500 h-2 rounded-full transition-all duration-500" :style="'width: ' + Math.min(100, (filteredCostStats.totalCost / getTotalCost()) * 100) + '%'"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Filtered Cost Analysis -->
                    <div x-show="filteredCostStats.totalCost > 0" class="mt-6">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Company Cost Breakdown -->
                            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200">
                                <h4 class="font-semibold text-blue-900 mb-3">üí∞ <span x-text="translations[currentLanguage].search.companyCosts || 'ÿ™ŸÉÿßŸÑŸäŸÅ ÿßŸÑÿ¥ÿ±ŸÉÿßÿ™ (ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÖŸÅŸÑÿ™ÿ±ÿ©)'"></span></h4>
                                <div class="space-y-2 max-h-64 overflow-y-auto">
                                    <template x-for="company in filteredCompanyCosts" :key="company.name">
                                        <div class="flex justify-between items-center p-3 bg-white rounded-lg border border-blue-100">
                                            <div>
                                                <div class="font-medium text-blue-900" x-text="company.name"></div>
                                                <div class="text-xs text-blue-600">
                                                    <span x-text="company.trainees"></span> <span x-text="translations[currentLanguage].costs.trainees"></span> ‚Ä¢
                                                    <span x-text="company.classes"></span> <span x-text="translations[currentLanguage].costs.classes"></span>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <div class="font-bold text-blue-700" x-text="formatCurrency(company.totalCost)"></div>
                                                <div class="text-xs text-blue-500" x-text="formatCurrency(company.avgCost) + ' / ' + translations[currentLanguage].costs.trainees"></div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>

                            <!-- Date Range Analysis -->
                            <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-lg border border-green-200">
                                <h4 class="font-semibold text-green-900 mb-3">üìÖ <span x-text="translations[currentLanguage].search.dateRangeAnalysis || 'ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÜÿ∑ÿßŸÇ ÿßŸÑÿ≤ŸÖŸÜŸä'"></span></h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg border border-green-100">
                                        <span class="text-green-700" x-text="translations[currentLanguage].search.selectedPeriod + ':' || 'ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑŸÖÿ≠ÿØÿØÿ©:'"></span>
                                        <span class="font-bold text-green-900" x-text="getDateRangeText()"></span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg border border-green-100">
                                        <span class="text-green-700" x-text="translations[currentLanguage].search.dailyCostAverage + ':' || 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿ™ŸÉŸÑŸÅÿ© ÿßŸÑŸäŸàŸÖŸäÿ©:'"></span>
                                        <span class="font-bold text-green-900" x-text="formatCurrency(getDailyCostAverage())"></span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg border border-green-100">
                                        <span class="text-green-700" x-text="translations[currentLanguage].search.topCostCompany + ':' || 'ÿ£ÿπŸÑŸâ ÿ¥ÿ±ŸÉÿ© ÿ™ŸÉŸÑŸÅÿ©:'"></span>
                                        <span class="font-bold text-green-900" x-text="getTopCostCompany()"></span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-white rounded-lg border border-green-100">
                                        <span class="text-green-700" x-text="translations[currentLanguage].search.avgTraineesPerClass + ':' || 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑŸÖÿ™ÿØÿ±ÿ®ŸäŸÜ/ŸÉŸÑÿßÿ≥:'"></span>
                                        <span class="font-bold text-green-900" x-text="getAvgTraineesPerClass()"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Search Results Table -->
                <div x-show="visibleRows.length > 0" class="card">
                    <div class="card-header">
                        <h2 class="card-title" x-text="translations[currentLanguage].search.results"></h2>
                        <div class="flex gap-2">
                            <button @click="currentPage = Math.max(1, currentPage - 1)" :disabled="currentPage === 1" class="btn btn-secondary">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                            <span class="px-3 py-2 text-sm">
                                <span x-text="translations[currentLanguage].search.page || 'ÿµŸÅÿ≠ÿ©'"></span>
                                <span x-text="currentPage"></span>
                                <span x-text="translations[currentLanguage].search.of || 'ŸÖŸÜ'"></span>
                                <span x-text="totalPages"></span>
                            </span>
                            <button @click="currentPage = Math.min(totalPages, currentPage + 1)" :disabled="currentPage === totalPages" class="btn btn-secondary">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <template x-for="col in columns" :key="col">
                                        <th x-text="col"></th>
                                    </template>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="(row, index) in paginatedRows" :key="index">
                                    <tr>
                                        <template x-for="col in columns" :key="col">
                                            <td x-text="maskPII ? maskValue(col, row[col]) : row[col]"></td>
                                        </template>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Analytics View -->
            <div x-show="currentView === 'analytics'" class="fade-in">
                <!-- Analytics Controls -->
                <div class="card mb-6">
                    <div class="card-header">
                        <h2 class="card-title" x-text="translations[currentLanguage].analytics.title"></h2>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                        <div class="form-group">
                            <label class="form-label" x-text="translations[currentLanguage].analytics.groupBy"></label>
                            <select x-model="analytics.groupBy" @change="updateAnalytics()" class="form-select">
                                <option value="" x-text="translations[currentLanguage].analytics.chooseColumn"></option>
                                <template x-for="col in columns" :key="col">
                                    <option :value="col" x-text="col"></option>
                                </template>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" x-text="translations[currentLanguage].analytics.analysisType"></label>
                            <select x-model="analytics.type" @change="updateAnalytics()" class="form-select">
                                <option value="count" x-text="translations[currentLanguage].analytics.count"></option>
                                <option value="completion" x-text="translations[currentLanguage].analytics.completion"></option>
                                <option value="distribution" x-text="translations[currentLanguage].analytics.distribution"></option>
                                <option value="comparison" x-text="translations[currentLanguage].analytics.comparison"></option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" x-text="translations[currentLanguage].analytics.chartType"></label>
                            <select x-model="analytics.chartType" @change="updateAnalytics()" class="form-select">
                                <option value="bar" x-text="translations[currentLanguage].analytics.bar"></option>
                                <option value="pie" x-text="translations[currentLanguage].analytics.pie"></option>
                                <option value="line" x-text="translations[currentLanguage].analytics.line"></option>
                                <option value="scatter" x-text="translations[currentLanguage].analytics.scatter"></option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Analytics Results -->
                <div x-show="analytics.groupBy" class="space-y-6">
                    <!-- Key Insights Banner -->
                    <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 rounded-lg">
                        <h3 class="text-xl font-bold mb-2" x-text="translations[currentLanguage].analytics.smartAnalysisResults"></h3>
                        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="text-center">
                                <div class="text-2xl font-bold" x-text="Object.keys(analyticsData).length"></div>
                                <div class="text-sm opacity-90" x-text="translations[currentLanguage].analytics.totalCategories"></div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold" x-text="getTotalAnalyzedRecords()"></div>
                                <div class="text-sm opacity-90" x-text="translations[currentLanguage].analytics.totalRecords"></div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold" x-text="getAnalyticsCompletionRate() + '%'"></div>
                                <div class="text-sm opacity-90" x-text="translations[currentLanguage].analytics.averageValue"></div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold" x-text="getAnalyticsVariance()"></div>
                                <div class="text-sm opacity-90" x-text="translations[currentLanguage].analytics.variance || 'ÿßŸÑÿ™ÿ®ÿßŸäŸÜ'"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Analytics Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Summary Stats -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title" x-text="translations[currentLanguage].analytics.detailedStats"></h3>
                            </div>
                            <div class="space-y-4">
                                <div class="bg-gray-50 p-3 rounded">
                                    <div class="flex justify-between">
                                        <span class="text-gray-700" x-text="translations[currentLanguage].analytics.largestCategory + ':'"></span>
                                        <span class="font-bold text-gray-900" x-text="getLargestCategory()"></span>
                                    </div>
                                </div>
                                <div class="bg-gray-50 p-3 rounded">
                                    <div class="flex justify-between">
                                        <span class="text-gray-700" x-text="translations[currentLanguage].analytics.smallestCategory + ':'"></span>
                                        <span class="font-bold text-gray-900" x-text="getSmallestCategory()"></span>
                                    </div>
                                </div>
                                <div class="bg-gray-50 p-3 rounded">
                                    <div class="flex justify-between">
                                        <span class="text-gray-700" x-text="translations[currentLanguage].analytics.average + ':'"></span>
                                        <span class="font-bold text-gray-900" x-text="getAverageValue()"></span>
                                    </div>
                                </div>
                                <div class="bg-gray-50 p-3 rounded">
                                    <div class="flex justify-between">
                                        <span class="text-gray-700" x-text="translations[currentLanguage].analytics.median + ':'"></span>
                                        <span class="font-bold text-gray-900" x-text="getMedianValue()"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Top Performers -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">üèÜ <span x-text="translations[currentLanguage].analytics.topPerformers || 'ÿßŸÑÿ£ŸÅÿ∂ŸÑ ÿ£ÿØÿßÿ°Ÿã'"></span></h3>
                            </div>
                            <div class="space-y-3">
                                <template x-for="(item, index) in getTopPerformers()" :key="item.name">
                                    <div class="flex justify-between items-center p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border-l-4 border-green-500">
                                        <div>
                                            <div class="font-medium" x-text="item.name"></div>
                                            <div class="text-xs text-gray-600" x-text="(translations[currentLanguage].analytics.rank || 'ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ©') + ' ' + (index + 1)"></div>
                                        </div>
                                        <div class="text-right">
                                            <div class="font-bold text-green-600" x-text="item.value"></div>
                                            <div class="text-xs text-gray-500" x-text="item.percentage + '%'"></div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Bottom Performers -->
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">‚ö†Ô∏è <span x-text="translations[currentLanguage].analytics.needsImprovement || 'Ÿäÿ≠ÿ™ÿßÿ¨ ÿ™ÿ≠ÿ≥ŸäŸÜ'"></span></h3>
                            </div>
                            <div class="space-y-3">
                                <template x-for="(item, index) in getBottomPerformers()" :key="item.name">
                                    <div class="flex justify-between items-center p-3 bg-gradient-to-r from-red-50 to-pink-50 rounded-lg border-l-4 border-red-500">
                                        <div>
                                            <div class="font-medium" x-text="item.name"></div>
                                            <div class="text-xs text-gray-600" x-text="translations[currentLanguage].analytics.needsAttention || 'Ÿäÿ≠ÿ™ÿßÿ¨ ÿßŸÜÿ™ÿ®ÿßŸá'"></div>
                                        </div>
                                        <div class="text-right">
                                            <div class="font-bold text-red-600" x-text="item.value"></div>
                                            <div class="text-xs text-gray-500" x-text="item.percentage + '%'"></div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- Data Distribution Visualization -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" x-text="translations[currentLanguage].analytics.dataDistribution || 'ÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ±ÿ¶Ÿä'"></h3>
                        </div>
                        <div class="space-y-4">
                            <template x-for="item in getSortedAnalyticsData().slice(0, 10)" :key="item.name">
                                <div class="space-y-2">
                                    <div class="flex justify-between text-sm">
                                        <span class="font-medium" x-text="item.name"></span>
                                        <span x-text="item.count + ' (' + item.percentage + '%)'"></span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-3">
                                        <div class="bg-gradient-to-r from-blue-500 to-purple-600 h-3 rounded-full transition-all duration-500"
                                             :style="'width: ' + item.percentage + '%'"></div>
                                    </div>
                                    <div x-show="analytics.type === 'completion'" class="flex justify-between text-xs text-gray-600">
                                        <span x-text="translations[currentLanguage].analytics.completionRate + ':'"></span>
                                        <span x-text="item.completionRate + '%'"></span>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Analytics Chart -->
                <div x-show="analytics.groupBy" class="card mb-6">
                    <div class="card-header">
                        <h3 class="card-title" x-text="translations[currentLanguage].analytics.interactiveChart || 'ÿßŸÑÿ±ÿ≥ŸÖ ÿßŸÑÿ®ŸäÿßŸÜŸä ÿßŸÑÿ™ŸÅÿßÿπŸÑŸä'"></h3>
                        <div class="flex gap-2">
                            <button @click="exportChart()" class="btn btn-secondary">
                                <i class="fas fa-download"></i>
                                <span x-text="translations[currentLanguage].analytics.exportChart || 'ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ±ÿ≥ŸÖ'"></span>
                            </button>
                            <button @click="fullScreenChart()" class="btn btn-secondary">
                                <i class="fas fa-expand"></i>
                                <span x-text="translations[currentLanguage].analytics.fullScreen || 'ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©'"></span>
                            </button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <div id="analyticsChart"></div>
                    </div>
                </div>

                <!-- Detailed Analysis Table -->
                <div x-show="analytics.groupBy" class="card">
                    <div class="card-header">
                        <h3 class="card-title" x-text="translations[currentLanguage].analytics.detailedAnalysis || 'ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ™ŸÅÿµŸäŸÑŸä'"></h3>
                        <div class="flex gap-2">
                            <select x-model="analyticsExportFormat" class="form-select text-sm">
                                <option value="excel">Excel</option>
                                <option value="pdf">PDF</option>
                                <option value="csv">CSV</option>
                            </select>
                            <button @click="exportAnalyticsData()" class="btn btn-success">
                                <i class="fas fa-download"></i>
                                <span x-text="translations[currentLanguage].analytics.exportAnalysis || 'ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ'"></span>
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th x-text="analytics.groupBy"></th>
                                    <th x-text="translations[currentLanguage].analytics.count"></th>
                                    <th x-text="translations[currentLanguage].analytics.percentage || 'ÿßŸÑŸÜÿ≥ÿ®ÿ©'"></th>
                                    <th x-show="analytics.type === 'completion'" x-text="translations[currentLanguage].analytics.completionRate"></th>
                                    <th x-text="translations[currentLanguage].analytics.ranking || 'ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®'"></th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="(item, index) in getSortedAnalyticsData()" :key="item.name">
                                    <tr>
                                        <td class="font-medium" x-text="item.name"></td>
                                        <td x-text="item.count"></td>
                                        <td x-text="item.percentage + '%'"></td>
                                        <td x-show="analytics.type === 'completion'" x-text="item.completionRate + '%'"></td>
                                        <td>
                                            <span class="status"
                                                  :class="index < 3 ? 'status-success' : index >= getSortedAnalyticsData().length - 3 ? 'status-danger' : 'status-info'"
                                                  x-text="index + 1">
                                            </span>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Default Charts when no specific analysis -->
                <div x-show="!analytics.groupBy" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="chart-container">
                        <div id="locationChart"></div>
                    </div>
                    <div class="chart-container">
                        <div id="moduleChart"></div>
                    </div>
                    <div class="chart-container">
                        <div id="companyAnalyticsChart"></div>
                    </div>
                    <div class="chart-container">
                        <div id="programAnalyticsChart"></div>
                    </div>
                </div>
            </div>

            <!-- Email View -->
            <div x-show="currentView === 'email'" class="fade-in">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title" x-text="translations[currentLanguage].email.title"></h2>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-4" x-text="translations[currentLanguage].email.templates"></h3>
                            <div class="form-group">
                                <label class="form-label" x-text="translations[currentLanguage].email.messageType"></label>
                                <select x-model="emailTemplate" class="form-select">
                                    <option value="announcement" x-text="translations[currentLanguage].email.announcement"></option>
                                    <option value="appreciation" x-text="translations[currentLanguage].email.appreciation"></option>
                                    <option value="graduation" x-text="translations[currentLanguage].email.graduation"></option>
                                    <option value="reminder" x-text="translations[currentLanguage].email.reminder"></option>
                                    <option value="cancellation" x-text="translations[currentLanguage].email.cancellation"></option>
                                </select>
                            </div>

                            <div class="space-y-3">
                                <button @click="copyEmails()" class="btn btn-secondary w-full">
                                    <i class="fas fa-copy"></i>
                                    <span x-text="translations[currentLanguage].email.copyEmails + ' (' + getEmailCount() + ')'"></span>
                                </button>
                                <button @click="generateEmail()" class="btn btn-primary w-full">
                                    <i class="fas fa-envelope"></i>
                                    <span x-text="translations[currentLanguage].email.generateEmail"></span>
                                </button>
                            </div>
                        </div>

                        <div>
                            <h3 class="text-lg font-semibold mb-4" x-text="translations[currentLanguage].email.preview"></h3>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <div class="mb-3">
                                    <strong x-text="translations[currentLanguage].email.subject + ':'"></strong>
                                    <p x-text="getEmailSubject()"></p>
                                </div>
                                <div>
                                    <strong x-text="translations[currentLanguage].email.body + ':'"></strong>
                                    <p class="whitespace-pre-line" x-text="getEmailBody()"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports View -->
            <div x-show="currentView === 'reports'" class="fade-in">
                <div class="card mb-6">
                    <div class="card-header">
                        <h2 class="card-title" x-text="translations[currentLanguage].reports.title"></h2>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Quick Reports -->
                        <div>
                            <h3 class="text-lg font-semibold mb-4" x-text="translations[currentLanguage].reports.quickReports"></h3>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <div>
                                        <span class="font-medium" x-text="translations[currentLanguage].reports.completedTrainees"></span>
                                        <span class="bg-gray-100 text-gray-800 px-2 py-1 rounded text-sm ml-2" x-text="getCompletedCount()"></span>
                                    </div>
                                    <div class="flex gap-2">
                                        <select x-model="quickReportFormat" class="form-select text-sm">
                                            <option value="excel">Excel</option>
                                            <option value="pdf">PDF</option>
                                            <option value="csv">CSV</option>
                                        </select>
                                        <button @click="exportQuickReport('complete', quickReportFormat)" class="btn btn-success">
                                            <i class="fas fa-download"></i>
                                            <span x-text="translations[currentLanguage].reports.export"></span>
                                        </button>
                                    </div>
                                </div>

                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <div>
                                        <span class="font-medium" x-text="translations[currentLanguage].reports.incompleteTrainees"></span>
                                        <span class="bg-gray-100 text-gray-800 px-2 py-1 rounded text-sm ml-2" x-text="getIncompleteCount()"></span>
                                    </div>
                                    <div class="flex gap-2">
                                        <select x-model="quickReportFormat" class="form-select text-sm">
                                            <option value="excel">Excel</option>
                                            <option value="pdf">PDF</option>
                                            <option value="csv">CSV</option>
                                        </select>
                                        <button @click="exportQuickReport('incomplete', quickReportFormat)" class="btn btn-warning">
                                            <i class="fas fa-download"></i>
                                            <span x-text="translations[currentLanguage].reports.export"></span>
                                        </button>
                                    </div>
                                </div>

                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <div>
                                        <span class="font-medium" x-text="translations[currentLanguage].reports.companyReport"></span>
                                        <span class="bg-gray-100 text-gray-800 px-2 py-1 rounded text-sm ml-2" x-text="kpis.totalCompanies"></span>
                                    </div>
                                    <div class="flex gap-2">
                                        <select x-model="quickReportFormat" class="form-select text-sm">
                                            <option value="excel">Excel</option>
                                            <option value="pdf">PDF</option>
                                            <option value="csv">CSV</option>
                                        </select>
                                        <button @click="exportQuickReport('companies', quickReportFormat)" class="btn btn-info">
                                            <i class="fas fa-download"></i>
                                            <span x-text="translations[currentLanguage].reports.export"></span>
                                        </button>
                                    </div>
                                </div>

                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <div>
                                        <span class="font-medium" x-text="translations[currentLanguage].reports.programReport"></span>
                                        <span class="bg-gray-100 text-gray-800 px-2 py-1 rounded text-sm ml-2" x-text="kpis.totalPrograms"></span>
                                    </div>
                                    <div class="flex gap-2">
                                        <select x-model="quickReportFormat" class="form-select text-sm">
                                            <option value="excel">Excel</option>
                                            <option value="pdf">PDF</option>
                                            <option value="csv">CSV</option>
                                        </select>
                                        <button @click="exportQuickReport('programs', quickReportFormat)" class="btn btn-primary">
                                            <i class="fas fa-download"></i>
                                            <span x-text="translations[currentLanguage].reports.export"></span>
                                        </button>
                                    </div>
                                </div>

                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <div>
                                        <span class="font-medium" x-text="translations[currentLanguage].reports.summaryReport"></span>
                                        <span class="bg-gray-100 text-gray-800 px-2 py-1 rounded text-sm ml-2" x-text="translations[currentLanguage].reports.comprehensive || 'ÿ¥ÿßŸÖŸÑ'"></span>
                                    </div>
                                    <div class="flex gap-2">
                                        <select x-model="quickReportFormat" class="form-select text-sm">
                                            <option value="excel">Excel</option>
                                            <option value="pdf">PDF</option>
                                            <option value="csv">CSV</option>
                                        </select>
                                        <button @click="exportQuickReport('summary', quickReportFormat)" class="btn btn-secondary">
                                            <i class="fas fa-download"></i>
                                            <span x-text="translations[currentLanguage].reports.export"></span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Custom Report Builder -->
                        <div>
                            <h3 class="text-lg font-semibold mb-4" x-text="translations[currentLanguage].reports.customReport"></h3>
                            <div class="space-y-4">
                                <div class="form-group">
                                    <label class="form-label" x-text="translations[currentLanguage].reports.selectColumns"></label>
                                    <div class="space-y-2 max-h-40 overflow-y-auto border rounded p-2">
                                        <label class="flex items-center gap-2">
                                            <input type="checkbox" @change="toggleAllColumns($event)" :checked="selectedColumns.length === columns.length">
                                            <span class="font-semibold" x-text="translations[currentLanguage].reports.selectAll || 'ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÉŸÑ'"></span>
                                        </label>
                                        <hr>
                                        <template x-for="col in columns" :key="col">
                                            <label class="flex items-center gap-2">
                                                <input type="checkbox" :value="col" x-model="selectedColumns">
                                                <span x-text="col"></span>
                                            </label>
                                        </template>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" x-text="translations[currentLanguage].reports.filterData || 'ŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™'"></label>
                                    <select x-model="reportFilter" class="form-select">
                                        <option value="all" x-text="translations[currentLanguage].reports.allData || 'ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™'"></option>
                                        <option value="complete" x-text="translations[currentLanguage].reports.completedOnly || 'ÿßŸÑŸÖŸÉÿ™ŸÖŸÑŸäŸÜ ŸÅŸÇÿ∑'"></option>
                                        <option value="incomplete" x-text="translations[currentLanguage].reports.incompleteOnly || 'ÿ∫Ÿäÿ± ÿßŸÑŸÖŸÉÿ™ŸÖŸÑŸäŸÜ ŸÅŸÇÿ∑'"></option>
                                        <option value="current_filter" x-text="translations[currentLanguage].reports.currentFiltered || 'ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸÅŸÑÿ™ÿ±ÿ© ÿ≠ÿßŸÑŸäÿßŸã'"></option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" x-text="translations[currentLanguage].reports.exportFormat || 'ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑÿ™ÿµÿØŸäÿ±'"></label>
                                    <select x-model="exportFormat" class="form-select">
                                        <option value="excel">Excel (.xlsx)</option>
                                        <option value="pdf">PDF</option>
                                        <option value="csv">CSV</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" x-text="translations[currentLanguage].reports.additionalOptions || 'ÿÆŸäÿßÿ±ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©'"></label>
                                    <div class="space-y-2">
                                        <label class="flex items-center gap-2">
                                            <input type="checkbox" x-model="reportOptions.includeCharts">
                                            <span x-text="translations[currentLanguage].reports.includeCharts || 'ÿ™ÿ∂ŸÖŸäŸÜ ÿßŸÑÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ®ŸäÿßŸÜŸäÿ© (PDF ŸÅŸÇÿ∑)'"></span>
                                        </label>
                                        <label class="flex items-center gap-2">
                                            <input type="checkbox" x-model="reportOptions.includeSummary">
                                            <span x-text="translations[currentLanguage].reports.includeStats"></span>
                                        </label>
                                    </div>
                                </div>

                                <button @click="exportCustomReport()" :disabled="selectedColumns.length === 0" class="btn btn-primary w-full">
                                    <i class="fas fa-download"></i>
                                    <span x-text="translations[currentLanguage].reports.createCustomReport"></span>
                                </button>
                            </div>
                        </div>

                        <!-- Report Templates -->
                        <div>
                            <h3 class="text-lg font-semibold mb-4" x-text="translations[currentLanguage].reports.reportTemplates || 'ŸÇŸàÿßŸÑÿ® ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±'"></h3>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <span class="font-medium">üìä <span x-text="translations[currentLanguage].reports.executiveSummary || 'ÿßŸÑŸÖŸÑÿÆÿµ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞Ÿä'"></span></span>
                                    <div class="flex gap-2">
                                        <select x-model="templateFormat" class="form-select text-sm">
                                            <option value="excel">Excel</option>
                                            <option value="pdf">PDF</option>
                                            <option value="csv">CSV</option>
                                        </select>
                                        <button @click="generateExecutiveSummary(templateFormat)" class="btn btn-primary">
                                            <i class="fas fa-download"></i>
                                            <span x-text="translations[currentLanguage].reports.export"></span>
                                        </button>
                                    </div>
                                </div>

                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <span class="font-medium">üèÜ <span x-text="translations[currentLanguage].reports.performanceReport || 'ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ£ÿØÿßÿ°'"></span></span>
                                    <div class="flex gap-2">
                                        <select x-model="templateFormat" class="form-select text-sm">
                                            <option value="excel">Excel</option>
                                            <option value="pdf">PDF</option>
                                            <option value="csv">CSV</option>
                                        </select>
                                        <button @click="generatePerformanceReport(templateFormat)" class="btn btn-success">
                                            <i class="fas fa-download"></i>
                                            <span x-text="translations[currentLanguage].reports.export"></span>
                                        </button>
                                    </div>
                                </div>

                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                    <span class="font-medium">üî¨ <span x-text="translations[currentLanguage].reports.detailedAnalysis || 'ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ™ŸÅÿµŸäŸÑŸä'"></span></span>
                                    <div class="flex gap-2">
                                        <select x-model="templateFormat" class="form-select text-sm">
                                            <option value="excel">Excel</option>
                                            <option value="pdf">PDF</option>
                                            <option value="csv">CSV</option>
                                        </select>
                                        <button @click="generateDetailedAnalysis(templateFormat)" class="btn btn-secondary">
                                            <i class="fas fa-download"></i>
                                            <span x-text="translations[currentLanguage].reports.export"></span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Costs View -->
            <div x-show="currentView === 'costs'" class="fade-in">
                <!-- Cost Column Detection -->
                <div class="card mb-6" style="background: linear-gradient(135deg, var(--primary), #003875); color: white;">
                    <div class="card-header" style="border-bottom: 1px solid rgba(255,255,255,0.2);">
                        <h2 class="card-title" style="color: white;" x-text="'üîç ' + (translations[currentLanguage].costs.detectColumns || 'ŸÉÿ¥ŸÅ ÿ£ÿπŸÖÿØÿ© ÿßŸÑÿ™ŸÉŸÑŸÅÿ©')"></h2>
                    </div>
                    <div x-show="!rows.length" class="text-center py-8">
                        <i class="fas fa-upload text-4xl mb-4 opacity-70"></i>
                        <p class="text-lg" x-text="translations[currentLanguage].costs.uploadFirst || 'Ÿäÿ±ÿ¨Ÿâ ÿ±ŸÅÿπ ŸÖŸÑŸÅ Excel ÿ£ŸàŸÑÿßŸã ŸÑŸÉÿ¥ŸÅ ÿ£ÿπŸÖÿØÿ© ÿßŸÑÿ™ŸÉŸÑŸÅÿ©'"></p>
                    </div>
                    <div x-show="rows.length" class="space-y-4">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <h3 class="font-semibold mb-3">üìä <span x-text="translations[currentLanguage].costs.detectedColumns || 'ÿßŸÑÿ£ÿπŸÖÿØÿ© ÿßŸÑŸÖŸÉÿ™ÿ¥ŸÅÿ©'"></span>:</h3>
                                <div class="space-y-2">
                                    <div class="flex justify-between items-center p-3 bg-white bg-opacity-20 rounded-lg">
                                        <span x-text="translations[currentLanguage].costs.companyColumn || 'ÿπŸÖŸàÿØ ÿßŸÑÿ¥ÿ±ŸÉÿ©'"></span>:
                                        <span class="font-bold" x-text="detectedColumns.company || (translations[currentLanguage].costs.notFound || 'ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ')"></span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-white bg-opacity-20 rounded-lg">
                                        <span x-text="translations[currentLanguage].costs.costColumn || 'ÿπŸÖŸàÿØ ÿßŸÑÿ™ŸÉŸÑŸÅÿ©'"></span>:
                                        <span class="font-bold" x-text="detectedColumns.cost || (translations[currentLanguage].costs.notFound || 'ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ')"></span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-white bg-opacity-20 rounded-lg">
                                        <span x-text="translations[currentLanguage].costs.programColumn || 'ÿπŸÖŸàÿØ ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨'"></span>:
                                        <span class="font-bold" x-text="detectedColumns.program || (translations[currentLanguage].costs.notFound || 'ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ')"></span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-white bg-opacity-20 rounded-lg">
                                        <span x-text="translations[currentLanguage].costs.classColumn || 'ÿπŸÖŸàÿØ ÿßŸÑŸÉŸÑÿßÿ≥'"></span>:
                                        <span class="font-bold" x-text="detectedColumns.class || (translations[currentLanguage].costs.notFound || 'ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ')"></span>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h3 class="font-semibold mb-3">‚öôÔ∏è <span x-text="translations[currentLanguage].costs.manualSettings || 'ÿ•ÿπÿØÿßÿØÿßÿ™ ŸäÿØŸàŸäÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿäÿ©)'"></span>:</h3>
                                <div class="space-y-3">
                                    <div class="form-group">
                                        <label class="form-label" style="color: white;" x-text="translations[currentLanguage].costs.customCostColumn || 'ÿπŸÖŸàÿØ ÿßŸÑÿ™ŸÉŸÑŸÅÿ© ÿßŸÑŸÖÿÆÿµÿµ'"></label>:
                                        <select x-model="customCostColumn" class="form-select">
                                            <option value="" x-text="translations[currentLanguage].costs.useAutoDetection || 'ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÉÿ¥ŸÅ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä'"></option>
                                            <template x-for="col in columns" :key="col">
                                                <option :value="col" x-text="col"></option>
                                            </template>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" style="color: white;" x-text="translations[currentLanguage].costs.customCompanyColumn || 'ÿπŸÖŸàÿØ ÿßŸÑÿ¥ÿ±ŸÉÿ© ÿßŸÑŸÖÿÆÿµÿµ'"></label>:
                                        <select x-model="customCompanyColumn" class="form-select">
                                            <option value="" x-text="translations[currentLanguage].costs.useAutoDetection || 'ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÉÿ¥ŸÅ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä'"></option>
                                            <template x-for="col in columns" :key="col">
                                                <option :value="col" x-text="col"></option>
                                            </template>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-3 mt-6">
                            <button @click="detectCostColumns()" class="btn" style="background: var(--secondary); color: white;">
                                <i class="fas fa-search"></i>
                                <span x-text="translations[currentLanguage].costs.redetectColumns || 'ÿ•ÿπÿßÿØÿ© ŸÉÿ¥ŸÅ ÿßŸÑÿ£ÿπŸÖÿØÿ©'"></span>
                            </button>
                            <button @click="calculateCosts()" :disabled="!detectedColumns.cost && !customCostColumn" class="btn" style="background: var(--success); color: white;">
                                <i class="fas fa-calculator"></i>
                                <span x-text="translations[currentLanguage].costs.calculate || 'ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ™ŸÉÿßŸÑŸäŸÅ'"></span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Cost Summary -->
                <div x-show="costCalculated" class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6">
                    <div class="bg-gradient-to-r from-gray-500 to-gray-600 text-white p-6 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-lg font-semibold" x-text="translations[currentLanguage].costs.totalCost"></h3>
                                <p class="text-2xl font-bold" x-text="formatCurrency(totalCost)"></p>
                            </div>
                            <i class="fas fa-money-bill-wave text-3xl opacity-80"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-gray-600 to-gray-700 text-white p-6 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-lg font-semibold" x-text="translations[currentLanguage].costs.totalTrainees"></h3>
                                <p class="text-2xl font-bold" x-text="formatNumber(kpis.totalRecords)"></p>
                            </div>
                            <i class="fas fa-users text-3xl opacity-80"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-gray-700 to-gray-800 text-white p-6 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-lg font-semibold" x-text="translations[currentLanguage].costs.totalClasses"></h3>
                                <p class="text-2xl font-bold" x-text="formatNumber(totalClasses)"></p>
                            </div>
                            <i class="fas fa-chalkboard-teacher text-3xl opacity-80"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-r from-gray-400 to-gray-500 text-white p-6 rounded-lg">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-lg font-semibold" x-text="translations[currentLanguage].costs.averageCost"></h3>
                             </div>
                            <i class="fas fa-chart-line text-3xl opacity-80"></i>
                               <p class="text-2xl font-bold" x-text="formatCurrency(averageCostPerTrainee)"></p>
                        </div>
                    </div>
                </div>

                <!-- Company Costs Analysis -->
                <div x-show="costCalculated" class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" x-text="translations[currentLanguage].costs.companyCosts"></h3>
                            <div class="flex gap-2">
                                <select x-model="costExportFormat" class="form-select text-sm">
                                    <option value="excel">Excel</option>
                                    <option value="pdf">PDF</option>
                                    <option value="csv">CSV</option>
                                </select>
                                <button @click="exportCostAnalysis()" class="btn btn-success">
                                    <i class="fas fa-download"></i>
                                    <span x-text="translations[currentLanguage].reports.export"></span>
                                </button>
                            </div>
                        </div>
                        <div class="space-y-3 max-h-96 overflow-y-auto">
                            <template x-for="company in companyCosts" :key="company.name">
                                <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                                    <div>
                                        <div class="font-semibold" x-text="company.name"></div>
                                        <div class="text-sm text-gray-600">
                                            <span x-text="company.trainees"></span> <span x-text="translations[currentLanguage].costs.trainees"></span> ‚Ä¢
                                            <span x-text="company.classes"></span> <span x-text="translations[currentLanguage].costs.classes"></span>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-blue-600" x-text="formatCurrency(company.totalCost)"></div>
                                        <div class="text-xs text-gray-500" x-text="formatCurrency(company.avgCostPerTrainee) + ' / ' + translations[currentLanguage].costs.trainees"></div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- Program Costs Analysis -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title" x-text="translations[currentLanguage].costs.programCosts"></h3>
                        </div>
                        <div class="space-y-3 max-h-96 overflow-y-auto">
                            <template x-for="program in programCosts" :key="program.name">
                                <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                                    <div>
                                        <div class="font-semibold" x-text="program.name"></div>
                                        <div class="text-sm text-gray-600">
                                            <span x-text="program.trainees"></span> <span x-text="translations[currentLanguage].costs.trainees"></span> ‚Ä¢
                                            <span x-text="program.classes"></span> <span x-text="translations[currentLanguage].costs.classes"></span>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold text-green-600" x-text="formatCurrency(program.totalCost)"></div>
                                        <div class="text-xs text-gray-500" x-text="formatCurrency(program.avgCostPerTrainee) + ' / ' + translations[currentLanguage].costs.trainees"></div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>

                <!-- Advanced Attendance Tracking -->
                <div class="card mb-6">
                    <div class="card-header">
                        <h2 class="card-title">üìÖ <span x-text="translations[currentLanguage].costs.attendanceTracking"></span></h2>
                    </div>

                    <!-- Date and Filter Controls -->
                    <div class="bg-gray-50 p-4 rounded-lg mb-4">
                        <div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
                            <div class="form-group">
                                <label class="form-label" x-text="translations[currentLanguage].costs.fromDate"></label>
                                <input type="date" x-model="attendanceFilter.startDate" class="form-input">
                            </div>
                            <div class="form-group">
                                <label class="form-label" x-text="translations[currentLanguage].costs.toDate"></label>
                                <input type="date" x-model="attendanceFilter.endDate" class="form-input">
                            </div>
                            <div class="form-group">
                                <label class="form-label" x-text="translations[currentLanguage].costs.filterByCompany"></label>
                                <select x-model="attendanceFilter.company" class="form-select">
                                    <option value="" x-text="translations[currentLanguage].costs.allCompanies"></option>
                                    <template x-for="company in getUniqueCompanies()" :key="company">
                                        <option :value="company" x-text="company"></option>
                                    </template>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" x-text="translations[currentLanguage].costs.filterByClass"></label>
                                <select x-model="attendanceFilter.class" class="form-select">
                                    <option value="" x-text="translations[currentLanguage].costs.allClasses"></option>
                                    <template x-for="classItem in getUniqueClasses()" :key="classItem">
                                        <option :value="classItem" x-text="classItem"></option>
                                    </template>
                                </select>
                            </div>
                        </div>

                        <div class="flex gap-3 mt-4">
                            <button @click="analyzeAttendanceAdvanced()" class="btn btn-primary">
                                <i class="fas fa-search"></i>
                                <span x-text="translations[currentLanguage].costs.analyzeAttendance"></span>
                            </button>
                            <button @click="resetAttendanceFilter()" class="btn btn-secondary">
                                <i class="fas fa-undo"></i>
                                <span x-text="translations[currentLanguage].costs.reset"></span>
                            </button>
                            <button @click="exportAttendanceReport()" :disabled="!attendanceAnalyzed" class="btn btn-success">
                                <i class="fas fa-download"></i>
                                <span x-text="translations[currentLanguage].costs.exportAttendanceReport"></span>
                            </button>
                        </div>
                    </div>

                    <!-- Date Column Detection -->
                    <div x-show="rows.length" class="bg-blue-50 p-4 rounded-lg mb-4">
                        <h4 class="font-semibold text-blue-900 mb-3">üîç <span x-text="translations[currentLanguage].costs.detectedDateColumns + ':'"></span></h4>
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                            <div class="bg-white p-3 rounded border">
                                <label class="form-label" x-text="translations[currentLanguage].costs.startDateColumn"></label>
                                <select x-model="attendanceFilter.startDateColumn" class="form-select">
                                    <option value="" x-text="translations[currentLanguage].search.chooseColumn"></option>
                                    <template x-for="col in getDateColumns()" :key="col">
                                        <option :value="col" x-text="col"></option>
                                    </template>
                                </select>
                            </div>
                            <div class="bg-white p-3 rounded border">
                                <label class="form-label" x-text="translations[currentLanguage].costs.endDateColumn"></label>
                                <select x-model="attendanceFilter.endDateColumn" class="form-select">
                                    <option value="" x-text="translations[currentLanguage].search.chooseColumn"></option>
                                    <template x-for="col in getDateColumns()" :key="col">
                                        <option :value="col" x-text="col"></option>
                                    </template>
                                </select>
                            </div>
                            <div class="bg-white p-3 rounded border">
                                <label class="form-label" x-text="translations[currentLanguage].costs.statusColumn"></label>
                                <select x-model="attendanceFilter.statusColumn" class="form-select">
                                    <option value="" x-text="translations[currentLanguage].search.chooseColumn"></option>
                                    <template x-for="col in columns" :key="col">
                                        <option :value="col" x-text="col"></option>
                                    </template>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Attendance Results -->
                <div x-show="attendanceAnalyzed">
                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title text-gray-600">üìä <span x-text="translations[currentLanguage].costs.totalFiltered"></span></h3>
                            </div>
                            <div class="p-4">
                                <div class="text-3xl font-bold text-gray-700 mb-2" x-text="attendanceStats.total"></div>
                                <div class="text-sm text-gray-600" x-text="translations[currentLanguage].costs.trainees + ' ŸÅŸä ÿßŸÑŸÜÿ∑ÿßŸÇ ÿßŸÑŸÖÿ≠ÿØÿØ'"></div>
                                <div class="w-full bg-gray-100 rounded-full h-2 mt-3">
                                    <div class="bg-gray-600 h-2 rounded-full" :style="'width: ' + Math.min(100, (attendanceStats.total / kpis.totalRecords * 100)) + '%'"></div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title text-gray-600">‚úÖ <span x-text="translations[currentLanguage].costs.completed"></span></h3>
                            </div>
                            <div class="p-4">
                                <div class="text-3xl font-bold text-gray-700 mb-2" x-text="attendanceStats.completed"></div>
                                <div class="text-sm text-gray-600" x-text="translations[currentLanguage].costs.trainees + ' ÿ£ŸÉŸÖŸÑ ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨'"></div>
                                <div class="w-full bg-gray-100 rounded-full h-2 mt-3">
                                    <div class="bg-gray-500 h-2 rounded-full" :style="'width: ' + (attendanceStats.total > 0 ? (attendanceStats.completed / attendanceStats.total * 100) : 0) + '%'"></div>
                                </div>
                                <div class="text-xs text-gray-500 mt-1" x-text="attendanceStats.total > 0 ? Math.round(attendanceStats.completed / attendanceStats.total * 100) + '% ' + translations[currentLanguage].costs.ofFiltered : '0%'"></div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title text-gray-600">‚ùå <span x-text="translations[currentLanguage].costs.dropped"></span></h3>
                            </div>
                            <div class="p-4">
                                <div class="text-3xl font-bold text-gray-700 mb-2" x-text="attendanceStats.dropped"></div>
                                <div class="text-sm text-gray-600" x-text="translations[currentLanguage].costs.trainees + ' ÿßŸÜÿ≥ÿ≠ÿ® ŸÖŸÜ ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨'"></div>
                                <div class="w-full bg-gray-100 rounded-full h-2 mt-3">
                                    <div class="bg-gray-500 h-2 rounded-full" :style="'width: ' + (attendanceStats.total > 0 ? (attendanceStats.dropped / attendanceStats.total * 100) : 0) + '%'"></div>
                                </div>
                                <div class="text-xs text-gray-500 mt-1" x-text="attendanceStats.total > 0 ? Math.round(attendanceStats.dropped / attendanceStats.total * 100) + '% ' + translations[currentLanguage].costs.ofFiltered : '0%'"></div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title text-gray-600">‚è≥ <span x-text="translations[currentLanguage].costs.inProgress"></span></h3>
                            </div>
                            <div class="p-4">
                                <div class="text-3xl font-bold text-gray-700 mb-2" x-text="attendanceStats.inProgress"></div>
                                <div class="text-sm text-gray-600" x-text="translations[currentLanguage].costs.trainees + ' ŸÖÿß ÿ≤ÿßŸÑ ŸÅŸä ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨'"></div>
                                <div class="w-full bg-gray-100 rounded-full h-2 mt-3">
                                    <div class="bg-gray-500 h-2 rounded-full" :style="'width: ' + (attendanceStats.total > 0 ? (attendanceStats.inProgress / attendanceStats.total * 100) : 0) + '%'"></div>
                                </div>
                                <div class="text-xs text-gray-500 mt-1" x-text="attendanceStats.total > 0 ? Math.round(attendanceStats.inProgress / attendanceStats.total * 100) + '% ' + translations[currentLanguage].costs.ofFiltered : '0%'"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Breakdown -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Company Breakdown -->
                        <div class="card" x-show="attendanceByCompany.length > 0">
                            <div class="card-header">
                                <h3 class="card-title">üè¢ <span x-text="translations[currentLanguage].costs.attendanceByCompany"></span></h3>
                            </div>
                            <div class="space-y-3 max-h-96 overflow-y-auto">
                                <template x-for="company in attendanceByCompany" :key="company.name">
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="font-semibold text-gray-800" x-text="company.name"></span>
                                            <span class="text-sm text-gray-600" x-text="company.total + ' ' + translations[currentLanguage].costs.trainees"></span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2 text-sm">
                                            <div class="text-center">
                                                <div class="font-bold text-gray-700" x-text="company.completed"></div>
                                                <div class="text-gray-500" x-text="translations[currentLanguage].costs.completed"></div>
                                            </div>
                                            <div class="text-center">
                                                <div class="font-bold text-gray-700" x-text="company.dropped"></div>
                                                <div class="text-gray-500" x-text="translations[currentLanguage].costs.dropped"></div>
                                            </div>
                                            <div class="text-center">
                                                <div class="font-bold text-gray-700" x-text="company.inProgress"></div>
                                                <div class="text-gray-500" x-text="translations[currentLanguage].costs.inProgress"></div>
                                            </div>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2 mt-3">
                                            <div class="bg-gray-600 h-2 rounded-full" :style="'width: ' + (company.total > 0 ? (company.completed / company.total * 100) : 0) + '%'"></div>
                                        </div>
                                        <div class="text-xs text-gray-500 mt-1" x-text="company.total > 0 ? Math.round(company.completed / company.total * 100) + '% ' + translations[currentLanguage].costs.completionRate : '0%'"></div>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Class Breakdown -->
                        <div class="card" x-show="attendanceByClass.length > 0">
                            <div class="card-header">
                                <h3 class="card-title">üìö <span x-text="translations[currentLanguage].costs.attendanceByClass"></span></h3>
                            </div>
                            <div class="space-y-3 max-h-96 overflow-y-auto">
                                <template x-for="classItem in attendanceByClass" :key="classItem.name">
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="font-semibold text-gray-800" x-text="classItem.name"></span>
                                            <span class="text-sm text-gray-600" x-text="classItem.total + ' ' + translations[currentLanguage].costs.trainees"></span>
                                        </div>
                                        <div class="grid grid-cols-3 gap-2 text-sm">
                                            <div class="text-center">
                                                <div class="font-bold text-gray-700" x-text="classItem.completed"></div>
                                                <div class="text-gray-500">ŸÖŸÉÿ™ŸÖŸÑ</div>
                                            </div>
                                            <div class="text-center">
                                                <div class="font-bold text-gray-700" x-text="classItem.dropped"></div>
                                                <div class="text-gray-500">ŸÖŸÜÿ≥ÿ≠ÿ®</div>
                                            </div>
                                            <div class="text-center">
                                                <div class="font-bold text-gray-700" x-text="classItem.inProgress"></div>
                                                <div class="text-gray-500">ŸÇŸäÿØ ÿßŸÑÿ™ÿØÿ±Ÿäÿ®</div>
                                            </div>
                                        </div>
                                        <div class="w-full bg-gray-200 rounded-full h-2 mt-3">
                                            <div class="bg-gray-600 h-2 rounded-full" :style="'width: ' + (classItem.total > 0 ? (classItem.completed / classItem.total * 100) : 0) + '%'"></div>
                                        </div>
                                        <div class="text-xs text-gray-500 mt-1" x-text="classItem.total > 0 ? Math.round(classItem.completed / classItem.total * 100) + '% ' + translations[currentLanguage].costs.completionRate : '0%'"></div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div x-show="currentView === 'settings'" class="fade-in">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title" x-text="translations[currentLanguage].settings.title"></h2>
                    </div>

                    <div class="space-y-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-4" x-text="translations[currentLanguage].settings.displaySettings"></h3>
                            <div class="space-y-4">
                                <label class="flex items-center gap-3">
                                    <input type="checkbox" x-model="settings.autoRefresh">
                                    <span x-text="translations[currentLanguage].settings.autoRefresh"></span>
                                </label>
                                <label class="flex items-center gap-3">
                                    <input type="checkbox" x-model="settings.showAnimations">
                                    <span x-text="translations[currentLanguage].settings.showAnimations"></span>
                                </label>
                                <label class="flex items-center gap-3">
                                    <input type="checkbox" x-model="settings.compactMode">
                                    <span x-text="translations[currentLanguage].settings.compactMode"></span>
                                </label>
                            </div>
                        </div>

                        <div>
                            <h3 class="text-lg font-semibold mb-4" x-text="translations[currentLanguage].settings.dataSettings"></h3>
                            <div class="space-y-4">
                                <div class="form-group">
                                    <label class="form-label" x-text="translations[currentLanguage].settings.pageSize"></label>
                                    <select x-model="settings.pageSize" class="form-select">
                                        <option value="10">10</option>
                                        <option value="25">25</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                    </select>
                                </div>
                                <label class="flex items-center gap-3">
                                    <input type="checkbox" x-model="settings.cacheData">
                                    <span x-text="translations[currentLanguage].settings.cacheData"></span>
                                </label>
                            </div>
                        </div>

                        <div class="flex gap-3">
                            <button @click="saveSettings()" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                <span x-text="translations[currentLanguage].settings.saveSettings"></span>
                            </button>
                            <button @click="resetSettings()" class="btn btn-secondary">
                                <i class="fas fa-undo"></i>
                                <span x-text="translations[currentLanguage].settings.resetSettings"></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

<script>
function dashboard() {
    return {
        // Language and Localization
        currentLanguage: 'ar',
        translations: {
            ar: {
                title: 'ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ© - SABIC',
                subtitle: 'ŸÑŸàÿ≠ÿ© ÿ™ÿ≠ŸÉŸÖ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿßÿ≠ÿ™ÿ±ÿßŸÅŸäÿ©',
                nav: {
                    dashboard: 'ŸÜÿ∏ÿ±ÿ© ÿπÿßŸÖÿ©',
                    upload: 'ÿ±ŸÅÿπ ÿßŸÑŸÖŸÑŸÅÿßÿ™',
                    search: 'ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑÿ∞ŸÉŸä',
                    analytics: 'ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿßÿ™',
                    reports: 'ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±',
                    email: 'ÿßŸÑÿ•ŸäŸÖŸäŸÑÿßÿ™',
                    costs: 'ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ™ŸÉÿßŸÑŸäŸÅ',
                    settings: 'ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™'
                },
                dashboard: {
                    title: 'ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©',
                    kpis: {
                        totalRecords: 'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™',
                        completionRate: 'ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤',
                        totalCompanies: 'ÿπÿØÿØ ÿßŸÑÿ¥ÿ±ŸÉÿßÿ™',
                        totalPrograms: 'ÿπÿØÿØ ÿßŸÑÿ®ÿ±ÿßŸÖÿ¨'
                    },
                    charts: {
                        companyDistribution: 'ÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑÿ¥ÿ±ŸÉÿßÿ™',
                        programDistribution: 'ÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑÿ®ÿ±ÿßŸÖÿ¨',
                        attendanceStatus: 'ÿ≠ÿßŸÑÿ© ÿßŸÑÿ≠ÿ∂Ÿàÿ±',
                        timeline: 'ÿßŸÑÿ¨ÿØŸàŸÑ ÿßŸÑÿ≤ŸÖŸÜŸä'
                    }
                },
                upload: {
                    title: 'ÿ±ŸÅÿπ ŸÖŸÑŸÅ Excel',
                    subtitle: 'ÿßÿ±ŸÅÿπ ŸÖŸÑŸÅÿßÿ™ Excel ÿ£Ÿà CSV ŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™',
                    dragDrop: 'ÿßÿ≥ÿ≠ÿ® ÿßŸÑŸÖŸÑŸÅ ŸáŸÜÿß ÿ£Ÿà ÿßŸÜŸÇÿ± ŸÑŸÑÿßÿÆÿ™Ÿäÿßÿ±',
                    supportedFormats: 'ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ: 10MB | ÿßŸÑŸÖÿ≥ŸÖŸàÿ≠: .xlsx, .xls',
                    upload: 'ÿ±ŸÅÿπ ÿßŸÑŸÖŸÑŸÅ',
                    processing: 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ...',
                    success: 'ÿ™ŸÖ ÿ±ŸÅÿπ ÿßŸÑŸÖŸÑŸÅ ÿ®ŸÜÿ¨ÿßÿ≠',
                    error: 'ÿÆÿ∑ÿ£ ŸÅŸä ÿ±ŸÅÿπ ÿßŸÑŸÖŸÑŸÅ',
                    selectFile: 'ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÖŸÑŸÅ',
                    selectSheet: 'ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸàÿ±ŸÇÿ©',
                    chooseSheet: 'ÿßÿÆÿ™ÿ± Ÿàÿ±ŸÇÿ©...',
                    headerRow: 'ÿµŸÅ ÿßŸÑÿ±ÿ§Ÿàÿ≥',
                    analyze: 'ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™',
                    clear: 'ŸÖÿ≥ÿ≠ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™',
                    fileName: 'ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÑŸÅ',
                    fileSize: 'ÿ≠ÿ¨ŸÖ ÿßŸÑŸÖŸÑŸÅ',
                    uploadProgress: 'ÿ™ŸÇÿØŸÖ ÿßŸÑÿ±ŸÅÿπ'
                },
                search: {
                    title: 'ÿßŸÑÿ®ÿ≠ÿ´ ŸàÿßŸÑŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿ∞ŸÉŸäÿ©',
                    filters: 'ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑŸÖÿ™ŸÇÿØŸÖ',
                    column: 'ÿßŸÑÿπŸÖŸàÿØ',
                    value: 'ÿßŸÑŸÇŸäŸÖÿ©',
                    enable: 'ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÅŸÑÿ™ÿ±',
                    addFilter: 'ÿ•ÿ∂ÿßŸÅÿ© ŸÅŸÑÿ™ÿ±',
                    applyFilters: 'ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÅŸÑÿßÿ™ÿ±',
                    reset: 'ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ',
                    results: 'ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿ®ÿ≠ÿ´',
                    searchResults: 'ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿ®ÿ≠ÿ´',
                    foundResults: 'ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ',
                    outOf: 'ŸÖŸÜ ÿ£ÿµŸÑ',
                    records: 'ÿ≥ÿ¨ŸÑ',
                    matchingResults: 'ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÖÿ∑ÿßÿ®ŸÇÿ©',
                    completionRate: 'ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤',
                    companiesCount: 'ÿπÿØÿØ ÿßŸÑÿ¥ÿ±ŸÉÿßÿ™',
                    programsCount: 'ÿπÿØÿØ ÿßŸÑÿ®ÿ±ÿßŸÖÿ¨',
                    classesCount: 'ÿπÿØÿØ ÿßŸÑŸÉŸÑÿßÿ≥ÿßÿ™',
                    totalCost: 'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ™ŸÉŸÑŸÅÿ©',
                    chooseColumn: 'ÿßÿÆÿ™ÿ± ÿπŸÖŸàÿØ...',
                    chooseValue: 'ÿßÿÆÿ™ÿ± ŸÇŸäŸÖÿ©...',
                    enterValue: 'ÿßÿØÿÆŸÑ ÿßŸÑŸÇŸäŸÖÿ©...',
                    allValues: 'ÿ¨ŸÖŸäÿπ ÿßŸÑŸÇŸäŸÖ',
                    fromDate: 'ŸÖŸÜ ÿ™ÿßÿ±ŸäÿÆ',
                    toDate: 'ÿ•ŸÑŸâ ÿ™ÿßÿ±ŸäÿÆ',
                    delete: 'ÿ≠ÿ∞ŸÅ',
                    export: 'ÿ™ÿµÿØŸäÿ±',
                    excel: 'Excel',
                    pdf: 'PDF',
                    csv: 'CSV'
                },
                analytics: {
                    title: 'ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ™ŸÅÿßÿπŸÑŸä',
                    groupBy: 'ÿ™ÿ≠ŸÑŸäŸÑ ÿ≠ÿ≥ÿ®',
                    chooseColumn: 'ÿßÿÆÿ™ÿ± ÿßŸÑÿπŸÖŸàÿØ ŸÑŸÑÿ™ÿ≠ŸÑŸäŸÑ...',
                    analysisType: 'ŸÜŸàÿπ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ',
                    count: 'ÿßŸÑÿπÿØÿØ',
                    completion: 'ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤',
                    distribution: 'ÿßŸÑÿ™Ÿàÿ≤Ÿäÿπ',
                    comparison: 'ÿßŸÑŸÖŸÇÿßÿ±ŸÜÿ©',
                    cost: 'ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ™ŸÉŸÑŸÅÿ©',
                    chartType: 'ŸÜŸàÿπ ÿßŸÑÿ±ÿ≥ŸÖ',
                    bar: 'ÿ£ÿπŸÖÿØÿ©',
                    pie: 'ÿØÿßÿ¶ÿ±Ÿä',
                    line: 'ÿÆÿ∑Ÿä',
                    scatter: 'ŸÜŸÇÿ∑Ÿä',
                    analyticsFilters: 'ŸÅŸÑÿßÿ™ÿ± ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ',
                    updateAnalysis: 'ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ',
                    smartAnalysisResults: 'ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ∞ŸÉŸä',
                    totalCategories: 'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÅÿ¶ÿßÿ™',
                    totalRecords: 'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≥ÿ¨ŸÑÿßÿ™',
                    completionRate: 'ŸÖÿπÿØŸÑ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤',
                    averageValue: 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑŸÇŸäŸÖÿ©',
                    detailedStats: 'ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿ™ŸÅÿµŸäŸÑŸäÿ©',
                    largestCategory: 'ÿ£ŸÉÿ®ÿ± ŸÅÿ¶ÿ©',
                    smallestCategory: 'ÿ£ÿµÿ∫ÿ± ŸÅÿ¶ÿ©',
                    average: 'ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑',
                    median: 'ÿßŸÑŸàÿ≥Ÿäÿ∑',
                    interactiveChart: 'ÿßŸÑÿ±ÿ≥ŸÖ ÿßŸÑÿ®ŸäÿßŸÜŸä ÿßŸÑÿ™ŸÅÿßÿπŸÑŸä',
                    exportChart: 'ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ±ÿ≥ŸÖ',
                    fullScreen: 'ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©',
                    exportAnalysis: 'ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ',
                    variance: 'ÿßŸÑÿ™ÿ®ÿßŸäŸÜ',
                    topPerformers: 'ÿßŸÑÿ£ŸÅÿ∂ŸÑ ÿ£ÿØÿßÿ°Ÿã',
                    needsImprovement: 'Ÿäÿ≠ÿ™ÿßÿ¨ ÿ™ÿ≠ÿ≥ŸäŸÜ',
                    needsAttention: 'Ÿäÿ≠ÿ™ÿßÿ¨ ÿßŸÜÿ™ÿ®ÿßŸá',
                    rank: 'ÿßŸÑŸÖÿ±ÿ™ÿ®ÿ©',
                    dataDistribution: 'ÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ±ÿ¶Ÿä',
                    detailedAnalysis: 'ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ™ŸÅÿµŸäŸÑŸä',
                    percentage: 'ÿßŸÑŸÜÿ≥ÿ®ÿ©',
                    ranking: 'ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®'
                },
                costs: {
                    title: 'ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ™ŸÉÿßŸÑŸäŸÅ',
                    detectColumns: 'ŸÉÿ¥ŸÅ ÿ£ÿπŸÖÿØÿ© ÿßŸÑÿ™ŸÉŸÑŸÅÿ©',
                    uploadFirst: 'Ÿäÿ±ÿ¨Ÿâ ÿ±ŸÅÿπ ŸÖŸÑŸÅ Excel ÿ£ŸàŸÑÿßŸã ŸÑŸÉÿ¥ŸÅ ÿ£ÿπŸÖÿØÿ© ÿßŸÑÿ™ŸÉŸÑŸÅÿ©',
                    detectedColumns: 'ÿßŸÑÿ£ÿπŸÖÿØÿ© ÿßŸÑŸÖŸÉÿ™ÿ¥ŸÅÿ©',
                    companyColumn: 'ÿπŸÖŸàÿØ ÿßŸÑÿ¥ÿ±ŸÉÿ©',
                    costColumn: 'ÿπŸÖŸàÿØ ÿßŸÑÿ™ŸÉŸÑŸÅÿ©',
                    programColumn: 'ÿπŸÖŸàÿØ ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨',
                    classColumn: 'ÿπŸÖŸàÿØ ÿßŸÑŸÉŸÑÿßÿ≥',
                    notFound: 'ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ',
                    manualSettings: 'ÿ•ÿπÿØÿßÿØÿßÿ™ ŸäÿØŸàŸäÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿäÿ©)',
                    customCostColumn: 'ÿπŸÖŸàÿØ ÿßŸÑÿ™ŸÉŸÑŸÅÿ© ÿßŸÑŸÖÿÆÿµÿµ',
                    customCompanyColumn: 'ÿπŸÖŸàÿØ ÿßŸÑÿ¥ÿ±ŸÉÿ© ÿßŸÑŸÖÿÆÿµÿµ',
                    useAutoDetection: 'ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÉÿ¥ŸÅ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä',
                    redetectColumns: 'ÿ•ÿπÿßÿØÿ© ŸÉÿ¥ŸÅ ÿßŸÑÿ£ÿπŸÖÿØÿ©',
                    calculate: 'ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ™ŸÉÿßŸÑŸäŸÅ',
                    totalCost: 'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ™ŸÉŸÑŸÅÿ©',
                    totalTrainees: 'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ™ÿØÿ±ÿ®ŸäŸÜ',
                    totalClasses: 'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÉŸÑÿßÿ≥ÿßÿ™',
                    averageCost: 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿ™ŸÉŸÑŸÅÿ©',
                    companyCosts: 'ÿ™ŸÉÿßŸÑŸäŸÅ ÿßŸÑÿ¥ÿ±ŸÉÿßÿ™',
                    programCosts: 'ÿ™ŸÉÿßŸÑŸäŸÅ ÿßŸÑÿ®ÿ±ÿßŸÖÿ¨',
                    trainees: 'ŸÖÿ™ÿØÿ±ÿ®',
                    classes: 'ŸÉŸÑÿßÿ≥',
                    attendanceTracking: 'ÿ™ÿ™ÿ®ÿπ ÿßŸÑÿ≠ÿ∂Ÿàÿ± ÿßŸÑŸÖÿ™ŸÇÿØŸÖ',
                    fromDate: 'ŸÖŸÜ ÿ™ÿßÿ±ŸäÿÆ',
                    toDate: 'ÿ•ŸÑŸâ ÿ™ÿßÿ±ŸäÿÆ',
                    filterByCompany: 'ŸÅŸÑÿ™ÿ±ÿ© ÿ≠ÿ≥ÿ® ÿßŸÑÿ¥ÿ±ŸÉÿ©',
                    filterByClass: 'ŸÅŸÑÿ™ÿ±ÿ© ÿ≠ÿ≥ÿ® ÿßŸÑŸÉŸÑÿßÿ≥',
                    allCompanies: 'ÿ¨ŸÖŸäÿπ ÿßŸÑÿ¥ÿ±ŸÉÿßÿ™',
                    allClasses: 'ÿ¨ŸÖŸäÿπ ÿßŸÑŸÉŸÑÿßÿ≥ÿßÿ™',
                    analyzeAttendance: 'ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ±',
                    reset: 'ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ',
                    exportAttendanceReport: 'ÿ™ÿµÿØŸäÿ± ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ≠ÿ∂Ÿàÿ±',
                    detectedDateColumns: 'ÿ£ÿπŸÖÿØÿ© ÿßŸÑÿ™Ÿàÿßÿ±ŸäÿÆ ÿßŸÑŸÖŸÉÿ™ÿ¥ŸÅÿ©',
                    startDateColumn: 'ÿπŸÖŸàÿØ ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿ®ÿØÿßŸäÿ©',
                    endDateColumn: 'ÿπŸÖŸàÿØ ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÜŸáÿßŸäÿ©',
                    statusColumn: 'ÿπŸÖŸàÿØ ÿßŸÑÿ≠ÿßŸÑÿ©/ÿßŸÑÿ≠ÿ∂Ÿàÿ±',
                    totalFiltered: 'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖŸÅŸÑÿ™ÿ±ŸäŸÜ',
                    completed: 'ÿßŸÑŸÖŸÉÿ™ŸÖŸÑŸäŸÜ',
                    dropped: 'ÿßŸÑŸÖŸÜÿ≥ÿ≠ÿ®ŸäŸÜ',
                    inProgress: 'ŸÇŸäÿØ ÿßŸÑÿ™ÿØÿ±Ÿäÿ®',
                    attendanceByCompany: 'ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ± ÿ≠ÿ≥ÿ® ÿßŸÑÿ¥ÿ±ŸÉÿ©',
                    attendanceByClass: 'ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ± ÿ≠ÿ≥ÿ® ÿßŸÑŸÉŸÑÿßÿ≥',
                    completionRate: 'ŸÖÿπÿØŸÑ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤',
                    ofFiltered: 'ŸÖŸÜ ÿßŸÑŸÖŸÅŸÑÿ™ÿ±ŸäŸÜ'
                },
                search: {
                    title: 'ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑÿ∞ŸÉŸä ŸàÿßŸÑŸÅŸÑÿ™ÿ±ÿ©',
                    filters: 'ŸÜÿ∏ÿßŸÖ ÿßŸÑŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑŸÖÿ™ŸÇÿØŸÖ',
                    column: 'ÿßŸÑÿπŸÖŸàÿØ',
                    value: 'ÿßŸÑŸÇŸäŸÖÿ©',
                    enable: 'ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÅŸÑÿ™ÿ±',
                    addFilter: 'ÿ•ÿ∂ÿßŸÅÿ© ŸÅŸÑÿ™ÿ±',
                    applyFilters: 'ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÅŸÑÿßÿ™ÿ±',
                    reset: 'ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ',
                    results: 'ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿ®ÿ≠ÿ´',
                    searchResults: 'ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿ®ÿ≠ÿ´',
                    foundResults: 'ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ',
                    outOf: 'ŸÖŸÜ ÿ£ÿµŸÑ',
                    records: 'ÿ≥ÿ¨ŸÑ',
                    matchingResults: 'ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÖÿ∑ÿßÿ®ŸÇÿ©',
                    completionRate: 'ŸÖÿπÿØŸÑ ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤',
                    companiesCount: 'ÿπÿØÿØ ÿßŸÑÿ¥ÿ±ŸÉÿßÿ™',
                    programsCount: 'ÿπÿØÿØ ÿßŸÑÿ®ÿ±ÿßŸÖÿ¨',
                    classesCount: 'ÿπÿØÿØ ÿßŸÑŸÉŸÑÿßÿ≥ÿßÿ™',
                    totalCost: 'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ™ŸÉŸÑŸÅÿ©',
                    chooseColumn: 'ÿßÿÆÿ™ÿ± ÿπŸÖŸàÿØ...',
                    chooseValue: 'ÿßÿÆÿ™ÿ± ŸÇŸäŸÖÿ©...',
                    enterValue: 'ÿ£ÿØÿÆŸÑ ŸÇŸäŸÖÿ©...',
                    allValues: 'ÿ¨ŸÖŸäÿπ ÿßŸÑŸÇŸäŸÖ',
                    fromDate: 'ŸÖŸÜ ÿ™ÿßÿ±ŸäÿÆ',
                    toDate: 'ÿ•ŸÑŸâ ÿ™ÿßÿ±ŸäÿÆ',
                    delete: 'ÿ≠ÿ∞ŸÅ',
                    export: 'ÿ™ÿµÿØŸäÿ±',
                    excel: 'Excel',
                    pdf: 'PDF',
                    csv: 'CSV',
                    quickFilters: 'ŸÅŸÑÿßÿ™ÿ± ÿ≥ÿ±Ÿäÿπÿ©',
                    search: 'ÿ®ÿ≠ÿ´',
                    detailedReport: 'ÿ™ŸÇÿ±Ÿäÿ± ÿ™ŸÅÿµŸäŸÑŸä',
                    ofTotalData: 'ŸÖŸÜ ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™',
                    companyCosts: 'ÿ™ŸÉÿßŸÑŸäŸÅ ÿßŸÑÿ¥ÿ±ŸÉÿßÿ™ (ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÖŸÅŸÑÿ™ÿ±ÿ©)',
                    dateRangeAnalysis: 'ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÜÿ∑ÿßŸÇ ÿßŸÑÿ≤ŸÖŸÜŸä',
                    selectedPeriod: 'ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑŸÖÿ≠ÿØÿØÿ©',
                    dailyCostAverage: 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿ™ŸÉŸÑŸÅÿ© ÿßŸÑŸäŸàŸÖŸäÿ©',
                    topCostCompany: 'ÿ£ÿπŸÑŸâ ÿ¥ÿ±ŸÉÿ© ÿ™ŸÉŸÑŸÅÿ©',
                    avgTraineesPerClass: 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑŸÖÿ™ÿØÿ±ÿ®ŸäŸÜ/ŸÉŸÑÿßÿ≥',
                    page: 'ÿµŸÅÿ≠ÿ©',
                    of: 'ŸÖŸÜ'
                },
                reports: {
                    title: 'ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ± ŸàÿßŸÑÿ™ÿµÿØŸäÿ±',
                    quickReports: 'ÿ™ŸÇÿßÿ±Ÿäÿ± ÿ≥ÿ±Ÿäÿπÿ©',
                    completedTrainees: 'ÿßŸÑŸÖÿ™ÿØÿ±ÿ®ŸäŸÜ ÿßŸÑŸÖŸÉÿ™ŸÖŸÑŸäŸÜ',
                    incompleteTrainees: 'ÿßŸÑŸÖÿ™ÿØÿ±ÿ®ŸäŸÜ ÿ∫Ÿäÿ± ÿßŸÑŸÖŸÉÿ™ŸÖŸÑŸäŸÜ',
                    companyReport: 'ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ¥ÿ±ŸÉÿßÿ™',
                    programReport: 'ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ®ÿ±ÿßŸÖÿ¨',
                    summaryReport: 'ÿ™ŸÇÿ±Ÿäÿ± ŸÖŸÑÿÆÿµ',
                    customReport: 'ÿ™ŸÇÿ±Ÿäÿ± ŸÖÿÆÿµÿµ',
                    selectColumns: 'ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ£ÿπŸÖÿØÿ©',
                    includeStats: 'ÿ™ÿ∂ŸÖŸäŸÜ ÿßŸÑŸÖŸÑÿÆÿµ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿä',
                    createCustomReport: 'ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑŸÖÿÆÿµÿµ',
                    comprehensive: 'ÿ¥ÿßŸÖŸÑ',
                    selectAll: 'ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÉŸÑ',
                    filterData: 'ŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™',
                    allData: 'ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™',
                    completedOnly: 'ÿßŸÑŸÖŸÉÿ™ŸÖŸÑŸäŸÜ ŸÅŸÇÿ∑',
                    incompleteOnly: 'ÿ∫Ÿäÿ± ÿßŸÑŸÖŸÉÿ™ŸÖŸÑŸäŸÜ ŸÅŸÇÿ∑',
                    currentFiltered: 'ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖŸÅŸÑÿ™ÿ±ÿ© ÿ≠ÿßŸÑŸäÿßŸã',
                    exportFormat: 'ÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑÿ™ÿµÿØŸäÿ±',
                    additionalOptions: 'ÿÆŸäÿßÿ±ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©',
                    includeCharts: 'ÿ™ÿ∂ŸÖŸäŸÜ ÿßŸÑÿ±ÿ≥ŸàŸÖ ÿßŸÑÿ®ŸäÿßŸÜŸäÿ© (PDF ŸÅŸÇÿ∑)',
                    reportTemplates: 'ŸÇŸàÿßŸÑÿ® ÿßŸÑÿ™ŸÇÿßÿ±Ÿäÿ±',
                    executiveSummary: 'ÿßŸÑŸÖŸÑÿÆÿµ ÿßŸÑÿ™ŸÜŸÅŸäÿ∞Ÿä',
                    performanceReport: 'ÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ£ÿØÿßÿ°',
                    detailedAnalysis: 'ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ™ŸÅÿµŸäŸÑŸä',
                    generate: 'ÿ•ŸÜÿ¥ÿßÿ°',
                    export: 'ÿ™ÿµÿØŸäÿ±'
                },
                settings: {
                    title: 'ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™',
                    displaySettings: 'ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿπÿ±ÿ∂',
                    dataSettings: 'ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™',
                    autoRefresh: 'ÿ™ÿ≠ÿØŸäÿ´ ÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÑŸÑÿ®ŸäÿßŸÜÿßÿ™',
                    showAnimations: 'ÿπÿ±ÿ∂ ÿßŸÑÿ±ÿ≥ŸàŸÖ ÿßŸÑŸÖÿ™ÿ≠ÿ±ŸÉÿ©',
                    compactMode: 'ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÖÿ∂ÿ∫Ÿàÿ∑',
                    pageSize: 'ÿπÿØÿØ ÿßŸÑÿµŸÅŸàŸÅ ŸÅŸä ÿßŸÑÿµŸÅÿ≠ÿ©',
                    cacheData: 'ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿ≠ŸÑŸäÿßŸã',
                    saveSettings: 'ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™',
                    resetSettings: 'ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ'
                },
                email: {
                    title: 'ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ•ŸäŸÖŸäŸÑÿßÿ™',
                    templates: 'ŸÇŸàÿßŸÑÿ® ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ',
                    messageType: 'ŸÜŸàÿπ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©',
                    announcement: 'ÿ•ÿπŸÑÿßŸÜ ŸÖŸáŸÖ',
                    appreciation: 'ÿ¥ŸÉÿ± Ÿàÿ™ŸÇÿØŸäÿ±',
                    graduation: 'ÿ™ŸáŸÜÿ¶ÿ© ÿ™ÿÆÿ±ÿ¨',
                    reminder: 'ÿ™ÿ∞ŸÉŸäÿ±',
                    cancellation: 'ÿ•ÿ¥ÿπÿßÿ± ÿ•ŸÑÿ∫ÿßÿ°',
                    copyEmails: 'ŸÜÿ≥ÿÆ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ•ŸäŸÖŸäŸÑÿßÿ™',
                    generateEmail: 'ÿ•ŸÜÿ¥ÿßÿ° ÿ•ŸäŸÖŸäŸÑ ÿ¨ŸÖÿßÿπŸä',
                    preview: 'ŸÖÿπÿßŸäŸÜÿ© ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©',
                    subject: 'ÿßŸÑŸÖŸàÿ∂Ÿàÿπ',
                    body: 'ÿßŸÑŸÜÿµ'
                },
                common: {
                    loading: 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...',
                    error: 'ÿÆÿ∑ÿ£',
                    success: 'ŸÜÿ¨ÿ≠',
                    warning: 'ÿ™ÿ≠ÿ∞Ÿäÿ±',
                    info: 'ŸÖÿπŸÑŸàŸÖÿßÿ™',
                    close: 'ÿ•ÿ∫ŸÑÿßŸÇ',
                    save: 'ÿ≠ŸÅÿ∏',
                    cancel: 'ÿ•ŸÑÿ∫ÿßÿ°',
                    confirm: 'ÿ™ÿ£ŸÉŸäÿØ',
                    yes: 'ŸÜÿπŸÖ',
                    no: 'ŸÑÿß',
                    search: 'ÿ®ÿ≠ÿ´',
                    filter: 'ŸÅŸÑÿ™ÿ±',
                    sort: 'ÿ™ÿ±ÿ™Ÿäÿ®',
                    page: 'ÿµŸÅÿ≠ÿ©',
                    of: 'ŸÖŸÜ',
                    showing: 'ÿπÿ±ÿ∂',
                    entries: 'ŸÖÿØÿÆŸÑÿßÿ™',
                    noData: 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™',
                    selectAll: 'ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÉŸÑ',
                    clear: 'ŸÖÿ≥ÿ≠',
                    refresh: 'ÿ™ÿ≠ÿØŸäÿ´',
                    darkMode: 'ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿØÿßŸÉŸÜ',
                    lightMode: 'ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÖÿ∂Ÿäÿ°',
                    hidePersonalData: 'ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ¥ÿÆÿµŸäÿ©',
                    showPersonalData: 'ÿ•ÿ∏Ÿáÿßÿ± ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ¥ÿÆÿµŸäÿ©'
                }
            },
            en: {
                title: 'Professional Dashboard - SABIC',
                subtitle: 'Professional Data Control Panel',
                nav: {
                    dashboard: 'Overview',
                    upload: 'Upload Files',
                    search: 'Smart Search',
                    analytics: 'Analytics',
                    reports: 'Reports',
                    email: 'Emails',
                    costs: 'Cost Calculation',
                    settings: 'Settings'
                },
                dashboard: {
                    title: 'Main Dashboard',
                    kpis: {
                        totalRecords: 'Total Records',
                        completionRate: 'Completion Rate',
                        totalCompanies: 'Total Companies',
                        totalPrograms: 'Total Programs'
                    },
                    charts: {
                        companyDistribution: 'Company Distribution',
                        programDistribution: 'Program Distribution',
                        attendanceStatus: 'Attendance Status',
                        timeline: 'Timeline'
                    }
                },
                upload: {
                    title: 'Upload Excel File',
                    subtitle: 'Upload Excel or CSV files for data analysis',
                    dragDrop: 'Drag file here or click to select',
                    supportedFormats: 'Max: 10MB | Allowed: .xlsx, .xls',
                    upload: 'Upload File',
                    processing: 'Analyzing...',
                    success: 'File uploaded successfully',
                    error: 'Error uploading file',
                    selectFile: 'Select File',
                    selectSheet: 'Select Sheet',
                    chooseSheet: 'Choose sheet...',
                    headerRow: 'Header Row',
                    analyze: 'Analyze Data',
                    clear: 'Clear Data',
                    fileName: 'File Name',
                    fileSize: 'File Size',
                    uploadProgress: 'Upload Progress'
                },
                search: {
                    title: 'Smart Search and Filtering',
                    filters: 'Advanced Filter System',
                    column: 'Column',
                    value: 'Value',
                    enable: 'Enable Filter',
                    addFilter: 'Add Filter',
                    applyFilters: 'Apply Filters',
                    reset: 'Reset',
                    results: 'Search Results',
                    searchResults: 'Search Results',
                    foundResults: 'Found',
                    outOf: 'out of',
                    records: 'records',
                    matchingResults: 'Matching Results',
                    completionRate: 'Completion Rate',
                    companiesCount: 'Companies Count',
                    programsCount: 'Programs Count',
                    classesCount: 'Classes Count',
                    totalCost: 'Total Cost',
                    chooseColumn: 'Choose column...',
                    chooseValue: 'Choose value...',
                    enterValue: 'Enter value...',
                    allValues: 'All values',
                    fromDate: 'From date',
                    toDate: 'To date',
                    delete: 'Delete',
                    export: 'Export',
                    excel: 'Excel',
                    pdf: 'PDF',
                    csv: 'CSV',
                    quickFilters: 'Quick Filters',
                    search: 'Search',
                    detailedReport: 'Detailed Report',
                    ofTotalData: 'of total data',
                    companyCosts: 'Company Costs (Filtered Results)',
                    dateRangeAnalysis: 'Date Range Analysis',
                    selectedPeriod: 'ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑŸÖÿ≠ÿØÿØÿ©',
                    dailyCostAverage: 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑÿ™ŸÉŸÑŸÅÿ© ÿßŸÑŸäŸàŸÖŸäÿ©',
                    topCostCompany: 'ÿ£ÿπŸÑŸâ ÿ¥ÿ±ŸÉÿ© ÿ™ŸÉŸÑŸÅÿ©',
                    avgTraineesPerClass: 'ŸÖÿ™Ÿàÿ≥ÿ∑ ÿßŸÑŸÖÿ™ÿØÿ±ÿ®ŸäŸÜ/ŸÉŸÑÿßÿ≥',
                    results: 'ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿ®ÿ≠ÿ´',
                    page: 'ÿµŸÅÿ≠ÿ©',
                    of: 'ŸÖŸÜ'
                },
                analytics: {
                    title: 'Interactive Analytics',
                    groupBy: 'Analyze by',
                    chooseColumn: 'Choose column for analysis...',
                    analysisType: 'Analysis Type',
                    count: 'Count',
                    completion: 'Completion Rate',
                    distribution: 'Distribution',
                    comparison: 'Comparison',
                    cost: 'Cost Analysis',
                    chartType: 'Chart Type',
                    bar: 'Bar',
                    pie: 'Pie',
                    line: 'Line',
                    scatter: 'Scatter',
                    analyticsFilters: 'Analytics Filters',
                    updateAnalysis: 'Update Analysis',
                    smartAnalysisResults: 'Smart Analysis Results',
                    totalCategories: 'Total Categories',
                    totalRecords: 'Total Records',
                    completionRate: 'Completion Rate',
                    averageValue: 'Average Value',
                    detailedStats: 'Detailed Statistics',
                    largestCategory: 'Largest Category',
                    smallestCategory: 'Smallest Category',
                    average: 'Average',
                    median: 'Median',
                    interactiveChart: 'Interactive Chart',
                    exportChart: 'Export Chart',
                    fullScreen: 'Full Screen',
                    exportAnalysis: 'Export Analysis',
                    variance: 'Variance',
                    topPerformers: 'Top Performers',
                    needsImprovement: 'Needs Improvement',
                    needsAttention: 'Needs Attention',
                    rank: 'Rank',
                    dataDistribution: 'Visual Data Distribution',
                    detailedAnalysis: 'Detailed Analysis',
                    percentage: 'Percentage',
                    ranking: 'Ranking'
                },
                costs: {
                    title: 'Cost Calculation',
                    detectColumns: 'Detect Cost Columns',
                    uploadFirst: 'Please upload an Excel file first to detect cost columns',
                    detectedColumns: 'Detected Columns',
                    companyColumn: 'Company Column',
                    costColumn: 'Cost Column',
                    programColumn: 'Program Column',
                    classColumn: 'Class Column',
                    notFound: 'Not Found',
                    manualSettings: 'Manual Settings (Optional)',
                    customCostColumn: 'Custom Cost Column',
                    customCompanyColumn: 'Custom Company Column',
                    useAutoDetection: 'Use Auto Detection',
                    redetectColumns: 'Re-detect Columns',
                    calculate: 'Calculate Costs',
                    totalCost: 'Total Cost',
                    totalTrainees: 'Total Trainees',
                    totalClasses: 'Total Classes',
                    averageCost: 'Average Cost',
                    companyCosts: 'Company Costs',
                    programCosts: 'Program Costs',
                    trainees: 'trainees',
                    classes: 'classes',
                    attendanceTracking: 'Advanced Attendance Tracking',
                    fromDate: 'From date',
                    toDate: 'To date',
                    filterByCompany: 'Filter by company',
                    filterByClass: 'Filter by class',
                    allCompanies: 'All companies',
                    allClasses: 'All classes',
                    analyzeAttendance: 'Analyze Attendance',
                    reset: 'Reset',
                    exportAttendanceReport: 'Export Attendance Report',
                    detectedDateColumns: 'Detected Date Columns',
                    startDateColumn: 'Start Date Column',
                    endDateColumn: 'End Date Column',
                    statusColumn: 'Status/Attendance Column',
                    totalFiltered: 'Total Filtered',
                    completed: 'Completed',
                    dropped: 'Dropped',
                    inProgress: 'In Progress',
                    attendanceByCompany: 'Attendance Analysis by Company',
                    attendanceByClass: 'Attendance Analysis by Class',
                    completionRate: 'Completion Rate',
                    ofFiltered: 'of filtered'
                },
                settings: {
                    title: 'Settings',
                    displaySettings: 'Display Settings',
                    dataSettings: 'Data Settings',
                    autoRefresh: 'Auto refresh data',
                    showAnimations: 'Show animations',
                    compactMode: 'Compact mode',
                    pageSize: 'Rows per page',
                    cacheData: 'Cache data locally',
                    saveSettings: 'Save Settings',
                    resetSettings: 'Reset'
                },
                reports: {
                    title: 'Reports and Export',
                    quickReports: 'Quick Reports',
                    completedTrainees: 'Completed Trainees',
                    incompleteTrainees: 'Incomplete Trainees',
                    companyReport: 'Company Report',
                    programReport: 'Program Report',
                    summaryReport: 'Summary Report',
                    customReport: 'Custom Report',
                    selectColumns: 'Select Columns',
                    includeStats: 'Include Statistical Summary',
                    createCustomReport: 'Create Custom Report',
                    comprehensive: 'Comprehensive',
                    selectAll: 'Select All',
                    filterData: 'Filter Data',
                    allData: 'All Data',
                    completedOnly: 'Completed Only',
                    incompleteOnly: 'Incomplete Only',
                    currentFiltered: 'Currently Filtered Data',
                    exportFormat: 'Export Format',
                    additionalOptions: 'Additional Options',
                    includeCharts: 'Include Charts (PDF only)',
                    reportTemplates: 'Report Templates',
                    executiveSummary: 'Executive Summary',
                    performanceReport: 'Performance Report',
                    detailedAnalysis: 'Detailed Analysis',
                    generate: 'Generate',
                    export: 'Export'
                },
                email: {
                    title: 'Email Management',
                    templates: 'Message Templates',
                    messageType: 'Message Type',
                    announcement: 'Important Announcement',
                    appreciation: 'Appreciation',
                    graduation: 'Graduation Congratulations',
                    reminder: 'Reminder',
                    cancellation: 'Cancellation Notice',
                    copyEmails: 'Copy All Emails',
                    generateEmail: 'Generate Group Email',
                    preview: 'Message Preview',
                    subject: 'Subject',
                    body: 'Body'
                },
                common: {
                    loading: 'Loading...',
                    error: 'Error',
                    success: 'Success',
                    warning: 'Warning',
                    info: 'Info',
                    close: 'Close',
                    save: 'Save',
                    cancel: 'Cancel',
                    confirm: 'Confirm',
                    yes: 'Yes',
                    no: 'No',
                    search: 'Search',
                    filter: 'Filter',
                    sort: 'Sort',
                    page: 'Page',
                    of: 'of',
                    showing: 'Showing',
                    entries: 'entries',
                    noData: 'No data available',
                    selectAll: 'Select All',
                    clear: 'Clear',
                    refresh: 'Refresh',
                    darkMode: 'Dark Mode',
                    lightMode: 'Light Mode',
                    hidePersonalData: 'Hide Personal Data',
                    showPersonalData: 'Show Personal Data'
                }
            }
        },

        // UI State
        sidebarOpen: false,
        currentView: 'dashboard',
        isDark: false,
        maskPII: true,
        dragActive: false,
        processing: false,

        // Data State
        workbook: null,
        sheets: [],
        selectedSheet: '',
        rows: [],
        columns: [],
        visibleRows: [],

        // File Info
        fileInfo: {
            name: '',
            size: 0,
            uploadDate: ''
        },

        // Advanced Filter State
        advancedFilters: [
            {
                enabled: false,
                column: '',
                value: '',
                type: 'contains',
                startDate: '',
                endDate: ''
            }
        ],
        analyticsFilters: [
            {
                enabled: false,
                column: '',
                value: '',
                type: 'contains'
            }
        ],
        searchExportFormat: 'excel',
        filteredCostStats: {
            totalCost: 0,
            avgCost: 0
        },
        filteredCompanyCosts: [],

        // Analytics State
        analytics: {
            groupBy: '',
            type: 'count',
            chartType: 'bar'
        },
        analyticsData: {},
        analyticsExportFormat: 'excel',

        // Dynamic Filter Options
        columnValues: {},
        quickFilters: [],

        // Pagination
        currentPage: 1,
        pageSize: 25,

        // KPIs
        kpis: {
            totalRecords: 0,
            completionRate: 0,
            totalCompanies: 0,
            totalPrograms: 0
        },

        // Statistics
        companyStats: [],
        programStats: [],

        // Email
        emailTemplate: 'announcement',

        // Reports
        selectedColumns: [],
        exportFormat: 'excel',
        reportFilter: 'all',
        quickReportFormat: 'excel',
        templateFormat: 'excel',
        reportOptions: {
            includeCharts: true,
            includeSummary: true
        },

        // Status
        status: '',
        statusClass: '',

        // Cost Calculation
        detectedColumns: {
            company: '',
            cost: '',
            program: '',
            class: ''
        },
        customCostColumn: '',
        customCompanyColumn: '',
        costCalculated: false,
        totalCost: 0,
        totalClasses: 0,
        averageCostPerTrainee: 0,
        companyCosts: [],
        programCosts: [],
        costExportFormat: 'excel',

        // Advanced Attendance Tracking
        attendanceFilter: {
            startDate: '',
            endDate: '',
            company: '',
            class: '',
            startDateColumn: '',
            endDateColumn: '',
            statusColumn: ''
        },
        attendanceAnalyzed: false,
        attendanceStats: {
            total: 0,
            completed: 0,
            dropped: 0,
            inProgress: 0
        },
        attendanceByCompany: [],
        attendanceByClass: [],

        // Settings
        settings: {
            autoRefresh: false,
            showAnimations: true,
            compactMode: false,
            pageSize: 25,
            cacheData: true,
            dateFormat: 'dd/mm/yyyy',
            includeTimestamp: true
        },

        // Initialize
        init() {
            this.loadSettings();
            this.loadTheme();
            this.loadLanguage();
            this.loadPIISettings();
        },

        // Language Management
        setLanguage(lang) {
            this.currentLanguage = lang;
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            document.title = this.translations[lang].title;
            localStorage.setItem('language', lang);
        },

        loadLanguage() {
            const savedLang = localStorage.getItem('language') || 'ar';
            this.setLanguage(savedLang);
        },

        // View Management
        setView(view) {
            this.currentView = view;
            if (view === 'dashboard' && this.rows.length > 0) {
                this.$nextTick(() => this.drawCharts());
            }
        },

        getViewTitle() {
            return this.translations[this.currentLanguage].nav[this.currentView] ||
                   (this.currentLanguage === 'ar' ? 'ŸÜÿ∏ÿ±ÿ© ÿπÿßŸÖÿ©' : 'Overview');
        },

        // Theme Management
        toggleTheme() {
            this.isDark = !this.isDark;
            document.body.classList.toggle('dark', this.isDark);
            localStorage.setItem('darkMode', this.isDark ? '1' : '0');
            if (this.rows.length > 0) {
                this.$nextTick(() => this.drawCharts());
            }
        },

        loadTheme() {
            const saved = localStorage.getItem('darkMode');
            this.isDark = saved === '1';
            document.body.classList.toggle('dark', this.isDark);
        },

        // PII Management
        maskPersonalData(text) {
            if (!this.maskPII || !text) return text;

            // Mask email addresses
            text = text.replace(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g, '***@***.***');

            // Mask phone numbers
            text = text.replace(/(\+?966|0)?[0-9]{8,9}/g, '***-***-****');

            // Mask ID numbers (Saudi ID pattern)
            text = text.replace(/[0-9]{10}/g, '**********');

            // Mask names (if they contain Arabic or English names)
            if (typeof text === 'string' && text.length > 2) {
                // Simple name masking - replace middle characters
                if (text.length <= 4) {
                    return text.charAt(0) + '*'.repeat(text.length - 2) + text.charAt(text.length - 1);
                } else {
                    return text.substring(0, 2) + '*'.repeat(text.length - 4) + text.substring(text.length - 2);
                }
            }

            return text;
        },

        togglePII() {
            this.maskPII = !this.maskPII;
            localStorage.setItem('maskPII', this.maskPII ? '1' : '0');
        },

        loadPIISettings() {
            const saved = localStorage.getItem('maskPII');
            this.maskPII = saved !== '0'; // Default to true
        },

        // File Handling
        handleDrop(event) {
            this.dragActive = false;
            const file = event.dataTransfer.files[0];
            if (file) this.handleFile(file);
        },

        handleFile(file) {
            if (!file) return;

            const allowedTypes = ['application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'application/vnd.ms-excel'];
            const isValidType = allowedTypes.includes(file.type) || /\.(xlsx|xls)$/i.test(file.name);
            const isValidSize = file.size <= 10 * 1024 * 1024;

            if (!isValidType) {
                this.setStatus('ŸÜŸàÿπ ÿßŸÑŸÖŸÑŸÅ ÿ∫Ÿäÿ± ŸÖÿØÿπŸàŸÖ. ÿßÿ≥ÿ™ÿÆÿØŸÖ .xlsx ÿ£Ÿà .xls', 'danger');
                return;
            }

            if (!isValidSize) {
                this.setStatus('ÿ≠ÿ¨ŸÖ ÿßŸÑŸÖŸÑŸÅ ŸÉÿ®Ÿäÿ± ÿ¨ÿØÿßŸã. ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ 10MB', 'danger');
                return;
            }

            this.fileInfo = {
                name: file.name,
                size: file.size,
                uploadDate: new Date().toLocaleDateString('ar-SA')
            };

            this.setStatus('ÿ¨ÿßÿ±Ÿä ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÖŸÑŸÅ...', 'info');

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    this.workbook = XLSX.read(e.target.result, { type: 'array' });
                    this.sheets = this.workbook.SheetNames;
                    this.setStatus('ÿ™ŸÖ ÿ±ŸÅÿπ ÿßŸÑŸÖŸÑŸÅ ÿ®ŸÜÿ¨ÿßÿ≠! ÿßÿÆÿ™ÿ± ÿßŸÑŸàÿ±ŸÇÿ© ŸÑŸÑŸÖÿ™ÿßÿ®ÿπÿ©', 'success');
                } catch (error) {
                    console.error(error);
                    this.setStatus('ŸÅÿ¥ŸÑ ŸÅŸä ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÖŸÑŸÅ. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑŸÖŸÑŸÅ', 'danger');
                }
            };
            reader.readAsArrayBuffer(file);
        },

        // Data Processing
        processData() {
            if (!this.workbook || !this.selectedSheet) {
                this.setStatus('ÿßÿÆÿ™ÿ± Ÿàÿ±ŸÇÿ© ÿ£ŸàŸÑÿßŸã', 'danger');
                return;
            }

            this.processing = true;
            this.setStatus('ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...', 'info');

            try {
                const sheet = this.workbook.Sheets[this.selectedSheet];
                const rawRows = XLSX.utils.sheet_to_json(sheet, { raw: false, defval: '' });

                if (!rawRows.length) {
                    this.setStatus('ÿßŸÑŸàÿ±ŸÇÿ© ŸÅÿßÿ±ÿ∫ÿ©', 'danger');
                    this.processing = false;
                    return;
                }

                this.rows = rawRows;
                this.columns = Object.keys(rawRows[0]);
                this.visibleRows = [...this.rows];

                this.calculateKPIs();
                this.generateStatistics();
                this.generateColumnValues();
                this.generateQuickFilters();
                this.detectCostColumns();
                this.currentPage = 1;

                this.setStatus(`ÿ™ŸÖ ÿ™ÿ≠ŸÑŸäŸÑ ${this.rows.length} ÿ≥ÿ¨ŸÑ ÿ®ŸÜÿ¨ÿßÿ≠`, 'success');
                this.setView('dashboard');

                this.$nextTick(() => this.drawCharts());

            } catch (error) {
                console.error(error);
                this.setStatus('ÿÆÿ∑ÿ£ ŸÅŸä ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™', 'danger');
            } finally {
                this.processing = false;
            }
        },

        clearData() {
            this.rows = [];
            this.columns = [];
            this.visibleRows = [];
            this.sheets = [];
            this.selectedSheet = '';
            this.workbook = null;
            this.fileInfo = { name: '', size: 0, uploadDate: '' };
            this.kpis = { totalRecords: 0, completionRate: 0, totalCompanies: 0, totalPrograms: 0 };
            this.companyStats = [];
            this.programStats = [];
            this.setStatus('ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™', 'info');
        },

        // KPI Calculations
        calculateKPIs() {
            this.kpis.totalRecords = this.rows.length;

            // Completion Rate
            const completed = this.rows.filter(row => {
                const attendance = String(row['Attendance'] || '').toLowerCase();
                return attendance.includes('complete') || attendance.includes('ŸÖŸÉÿ™ŸÖŸÑ');
            }).length;
            this.kpis.completionRate = Math.round((completed / this.rows.length) * 100);

            // Total Companies
            const companies = new Set(this.rows.map(row => row['Learner: Company']).filter(c => c));
            this.kpis.totalCompanies = companies.size;

            // Total Programs
            const programs = new Set(this.rows.map(row => row['Program']).filter(p => p));
            this.kpis.totalPrograms = programs.size;
        },

        // Statistics Generation
        generateStatistics() {
            // Company Statistics
            const companyData = {};
            this.rows.forEach(row => {
                const company = row['Learner: Company'] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
                const attendance = String(row['Attendance'] || '').toLowerCase();
                const isComplete = attendance.includes('complete') || attendance.includes('ŸÖŸÉÿ™ŸÖŸÑ');

                if (!companyData[company]) {
                    companyData[company] = { total: 0, completed: 0 };
                }
                companyData[company].total++;
                if (isComplete) companyData[company].completed++;
            });

            this.companyStats = Object.keys(companyData)
                .map(company => ({
                    name: company,
                    total: companyData[company].total,
                    completionRate: Math.round((companyData[company].completed / companyData[company].total) * 100)
                }))
                .sort((a, b) => b.completionRate - a.completionRate)
                .slice(0, 10);

            // Program Statistics
            const programData = {};
            this.rows.forEach(row => {
                const program = row['Program'] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
                const attendance = String(row['Attendance'] || '').toLowerCase();
                const isComplete = attendance.includes('complete') || attendance.includes('ŸÖŸÉÿ™ŸÖŸÑ');

                if (!programData[program]) {
                    programData[program] = { total: 0, completed: 0 };
                }
                programData[program].total++;
                if (isComplete) programData[program].completed++;
            });

            this.programStats = Object.keys(programData)
                .map(program => ({
                    name: program,
                    total: programData[program].total,
                    completionRate: Math.round((programData[program].completed / programData[program].total) * 100)
                }))
                .sort((a, b) => b.total - a.total)
                .slice(0, 10);
        },

        // Generate Column Values for Dropdowns
        generateColumnValues() {
            this.columnValues = {};
            this.columns.forEach(col => {
                const values = [...new Set(this.rows.map(row => row[col]).filter(v => v))];
                if (values.length <= 50) { // Only show dropdown for columns with reasonable number of unique values
                    this.columnValues[col] = values.sort();
                }
            });
        },

        // Generate Quick Filters
        generateQuickFilters() {
            this.quickFilters = [];

            // Attendance quick filters
            if (this.columns.includes('Attendance')) {
                const attendanceValues = {};
                this.rows.forEach(row => {
                    const attendance = row['Attendance'] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
                    attendanceValues[attendance] = (attendanceValues[attendance] || 0) + 1;
                });

                Object.keys(attendanceValues).forEach(value => {
                    this.quickFilters.push({
                        key: `attendance_${value}`,
                        label: value,
                        count: attendanceValues[value],
                        column: 'Attendance',
                        value: value
                    });
                });
            }

            // Company quick filters (top 5)
            if (this.columns.includes('Learner: Company')) {
                const companyValues = {};
                this.rows.forEach(row => {
                    const company = row['Learner: Company'] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
                    companyValues[company] = (companyValues[company] || 0) + 1;
                });

                Object.keys(companyValues)
                    .sort((a, b) => companyValues[b] - companyValues[a])
                    .slice(0, 5)
                    .forEach(company => {
                        this.quickFilters.push({
                            key: `company_${company}`,
                            label: company,
                            count: companyValues[company],
                            column: 'Learner: Company',
                            value: company
                        });
                    });
            }
        },

        // Update Filter Options
        updateFilterOptions() {
            // This function is called when column selection changes
            // It can be used to update available values dynamically
        },

        // Quick Filter Functions
        applyQuickFilter(quickFilter) {
            this.filter.column = quickFilter.column;
            this.filter.value = quickFilter.value;
            this.filter.type = 'exact';
            this.applyFilter();
        },

        isQuickFilterActive(quickFilter) {
            return this.filter.column === quickFilter.column &&
                   this.filter.value === quickFilter.value &&
                   this.filter.type === 'exact';
        },

        // Filtered Statistics
        getFilteredCompletionRate() {
            if (!this.visibleRows.length) return 0;
            const completed = this.visibleRows.filter(row => {
                const attendance = String(row['Attendance'] || '').toLowerCase();
                return attendance.includes('complete') || attendance.includes('ŸÖŸÉÿ™ŸÖŸÑ');
            }).length;
            return Math.round((completed / this.visibleRows.length) * 100);
        },

        getFilteredCompaniesCount() {
            const companies = new Set(this.visibleRows.map(row => row['Learner: Company']).filter(c => c));
            return companies.size;
        },

        getFilteredProgramsCount() {
            const programs = new Set(this.visibleRows.map(row => row['Program']).filter(p => p));
            return programs.size;
        },

        generateFilterReport() {
            if (!this.visibleRows.length) return;

            const report = {
                filterCriteria: {
                    column: this.filter.column || 'ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿπŸÖÿØÿ©',
                    value: this.filter.value,
                    type: this.filter.type
                },
                summary: {
                    totalResults: this.visibleRows.length,
                    completionRate: this.getFilteredCompletionRate(),
                    companiesCount: this.getFilteredCompaniesCount(),
                    programsCount: this.getFilteredProgramsCount()
                },
                timestamp: new Date().toLocaleString('ar-SA')
            };

            // Create detailed report
            const summaryData = [
                { 'Filter Criteria': 'Column', 'Value': report.filterCriteria.column },
                { 'Filter Criteria': 'Search Text', 'Value': report.filterCriteria.value },
                { 'Filter Criteria': 'Search Type', 'Value': report.filterCriteria.type },
                { 'Filter Criteria': '', 'Value': '' },
                { 'Filter Criteria': 'Total Results', 'Value': report.summary.totalResults },
                { 'Filter Criteria': 'Completion Rate', 'Value': report.summary.completionRate + '%' },
                { 'Filter Criteria': 'Companies Count', 'Value': report.summary.companiesCount },
                { 'Filter Criteria': 'Programs Count', 'Value': report.summary.programsCount },
                { 'Filter Criteria': 'Report Date', 'Value': report.timestamp }
            ];

            if (this.searchExportFormat === 'excel') {
                const ws = XLSX.utils.json_to_sheet(summaryData);
                const ws2 = XLSX.utils.json_to_sheet(this.visibleRows);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Report Summary');
                XLSX.utils.book_append_sheet(wb, ws2, 'Filtered Data');
                XLSX.writeFile(wb, `Filter_Report_${new Date().toISOString().split('T')[0]}.xlsx`);
            } else {
                // For PDF/CSV, combine summary and data
                const combinedData = [...summaryData, ...this.visibleRows.slice(0, 100)];
                this.exportDataInFormat(combinedData, this.searchExportFormat, 'Filter_Report');
            }

            this.setStatus('ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑÿ™ŸÅÿµŸäŸÑŸä ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
        },

        // Analytics Functions
        updateAnalytics() {
            if (!this.analytics.groupBy) {
                this.analyticsData = {};
                return;
            }

            // Apply analytics filters
            const activeFilters = this.analyticsFilters.filter(f => f.enabled && f.column && f.value);
            let filteredRows = this.rows;

            if (activeFilters.length > 0) {
                filteredRows = this.rows.filter(row => {
                    return activeFilters.every(filter => {
                        const cellValue = String(row[filter.column] || '').toLowerCase();
                        const filterValue = String(filter.value || '').toLowerCase();
                        return this.matchValue(cellValue, filterValue, 'contains');
                    });
                });
            }

            this.analyticsData = {};
            const column = this.analytics.groupBy;
            const costColumn = this.customCostColumn || this.detectedColumns.cost;

            filteredRows.forEach(row => {
                const value = row[column] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
                if (!this.analyticsData[value]) {
                    this.analyticsData[value] = {
                        count: 0,
                        completed: 0,
                        total: 0,
                        cost: 0
                    };
                }

                this.analyticsData[value].count++;
                this.analyticsData[value].total++;

                // Add cost if available
                if (costColumn && this.analytics.type === 'cost') {
                    const cost = parseFloat(row[costColumn]) || 0;
                    this.analyticsData[value].cost += cost;
                }

                const attendance = String(row['Attendance'] || '').toLowerCase();
                if (attendance.includes('complete') || attendance.includes('ŸÖŸÉÿ™ŸÖŸÑ')) {
                    this.analyticsData[value].completed++;
                }
            });

            this.$nextTick(() => this.drawAnalyticsChart());
        },

        getLargestCategory() {
            if (!Object.keys(this.analyticsData).length) return '-';
            const largest = Object.keys(this.analyticsData).reduce((a, b) =>
                this.analyticsData[a].count > this.analyticsData[b].count ? a : b
            );
            return `${largest} (${this.analyticsData[largest].count})`;
        },

        getSmallestCategory() {
            if (!Object.keys(this.analyticsData).length) return '-';
            const smallest = Object.keys(this.analyticsData).reduce((a, b) =>
                this.analyticsData[a].count < this.analyticsData[b].count ? a : b
            );
            return `${smallest} (${this.analyticsData[smallest].count})`;
        },

        getAverageValue() {
            if (!Object.keys(this.analyticsData).length) return '-';
            const total = Object.values(this.analyticsData).reduce((sum, item) => sum + item.count, 0);
            const avg = Math.round(total / Object.keys(this.analyticsData).length);
            return avg;
        },

        // Advanced Analytics Functions
        getTotalAnalyzedRecords() {
            if (!Object.keys(this.analyticsData).length) return 0;
            return Object.values(this.analyticsData).reduce((sum, item) => sum + item.count, 0);
        },

        getAnalyticsCompletionRate() {
            if (!Object.keys(this.analyticsData).length) return 0;
            const totalCompleted = Object.values(this.analyticsData).reduce((sum, item) => sum + item.completed, 0);
            const totalRecords = Object.values(this.analyticsData).reduce((sum, item) => sum + item.total, 0);
            return totalRecords > 0 ? Math.round((totalCompleted / totalRecords) * 100) : 0;
        },

        getAnalyticsVariance() {
            if (!Object.keys(this.analyticsData).length) return 0;
            const values = Object.values(this.analyticsData).map(item => item.count);
            const mean = values.reduce((sum, val) => sum + val, 0) / values.length;
            const variance = values.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / values.length;
            return Math.round(Math.sqrt(variance));
        },

        getMedianValue() {
            if (!Object.keys(this.analyticsData).length) return '-';
            const values = Object.values(this.analyticsData).map(item => item.count).sort((a, b) => a - b);
            const mid = Math.floor(values.length / 2);
            return values.length % 2 !== 0 ? values[mid] : Math.round((values[mid - 1] + values[mid]) / 2);
        },

        getTopPerformers() {
            if (!Object.keys(this.analyticsData).length) return [];
            const total = this.getTotalAnalyzedRecords();
            return Object.keys(this.analyticsData)
                .map(key => ({
                    name: key,
                    value: this.analytics.type === 'completion'
                        ? Math.round((this.analyticsData[key].completed / this.analyticsData[key].total) * 100) + '%'
                        : this.analyticsData[key].count,
                    percentage: Math.round((this.analyticsData[key].count / total) * 100),
                    rawValue: this.analytics.type === 'completion'
                        ? Math.round((this.analyticsData[key].completed / this.analyticsData[key].total) * 100)
                        : this.analyticsData[key].count
                }))
                .sort((a, b) => b.rawValue - a.rawValue)
                .slice(0, 5);
        },

        getBottomPerformers() {
            if (!Object.keys(this.analyticsData).length) return [];
            const total = this.getTotalAnalyzedRecords();
            return Object.keys(this.analyticsData)
                .map(key => ({
                    name: key,
                    value: this.analytics.type === 'completion'
                        ? Math.round((this.analyticsData[key].completed / this.analyticsData[key].total) * 100) + '%'
                        : this.analyticsData[key].count,
                    percentage: Math.round((this.analyticsData[key].count / total) * 100),
                    rawValue: this.analytics.type === 'completion'
                        ? Math.round((this.analyticsData[key].completed / this.analyticsData[key].total) * 100)
                        : this.analyticsData[key].count
                }))
                .sort((a, b) => a.rawValue - b.rawValue)
                .slice(0, 5);
        },

        getSortedAnalyticsData() {
            if (!Object.keys(this.analyticsData).length) return [];
            const total = Object.values(this.analyticsData).reduce((sum, item) => sum + item.count, 0);

            return Object.keys(this.analyticsData)
                .map(key => ({
                    name: key,
                    count: this.analyticsData[key].count,
                    percentage: Math.round((this.analyticsData[key].count / total) * 100),
                    completionRate: Math.round((this.analyticsData[key].completed / this.analyticsData[key].total) * 100)
                }))
                .sort((a, b) => b.count - a.count);
        },

        exportAnalyticsData() {
            if (!Object.keys(this.analyticsData).length) return;

            const data = this.getSortedAnalyticsData().map(item => ({
                [this.analytics.groupBy]: item.name,
                'Count': item.count,
                'Percentage': item.percentage + '%',
                'Completion Rate': item.completionRate + '%',
                'Analysis Type': this.analytics.type,
                'Chart Type': this.analytics.chartType
            }));

            this.exportDataInFormat(data, this.analyticsExportFormat, `Analysis_${this.analytics.groupBy}`);
        },

        // Advanced Filter Functions
        applyAdvancedFilter() {
            const activeFilters = this.advancedFilters.filter(f => f.enabled && f.column);

            if (activeFilters.length === 0) {
                this.visibleRows = [...this.rows];
                this.currentPage = 1;
                this.calculateFilteredCosts();
                return;
            }

            this.visibleRows = this.rows.filter(row => {
                return activeFilters.every(filter => {
                    // Date range filter
                    if (this.isDateColumn(filter.column)) {
                        const cellValue = row[filter.column];
                        const cellDate = this.parseDate(cellValue);

                        if (!cellDate) return false;

                        if (filter.startDate) {
                            const startDate = new Date(filter.startDate);
                            if (cellDate < startDate) return false;
                        }
                        if (filter.endDate) {
                            const endDate = new Date(filter.endDate);
                            if (cellDate > endDate) return false;
                        }
                        return true;
                    } else {
                        // Regular text filter
                        if (!filter.value) return true;

                        const cellValue = String(row[filter.column] || '').toLowerCase();
                        const filterValue = String(filter.value || '').toLowerCase();

                        return this.matchValue(cellValue, filterValue, 'contains');
                    }
                });
            });

            this.currentPage = 1;
            this.calculateFilteredCosts();
            this.setStatus(`ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ${this.visibleRows.length} ŸÜÿ™Ÿäÿ¨ÿ©`, 'info');
        },

        addFilter() {
            this.advancedFilters.push({
                enabled: false,
                column: '',
                value: '',
                type: 'contains',
                startDate: '',
                endDate: ''
            });
        },

        removeFilter(index) {
            if (this.advancedFilters.length > 1) {
                this.advancedFilters.splice(index, 1);
                this.applyAdvancedFilter();
            }
        },

        updateFilterValues(index) {
            // Reset values when column changes
            this.advancedFilters[index].value = '';
            this.advancedFilters[index].startDate = '';
            this.advancedFilters[index].endDate = '';
            this.applyAdvancedFilter();
        },

        resetAdvancedFilters() {
            this.advancedFilters = [
                {
                    enabled: false,
                    column: '',
                    value: '',
                    type: 'contains',
                    startDate: '',
                    endDate: ''
                }
            ];
            this.visibleRows = [...this.rows];
            this.filteredCostStats = { totalCost: 0, avgCost: 0 };
            this.filteredCompanyCosts = [];
            this.currentPage = 1;
            this.setStatus('ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÅŸÑÿßÿ™ÿ±', 'info');
        },

        // Analytics Filter Functions
        addAnalyticsFilter() {
            this.analyticsFilters.push({
                enabled: false,
                column: '',
                value: '',
                type: 'contains'
            });
        },

        removeAnalyticsFilter(index) {
            if (this.analyticsFilters.length > 1) {
                this.analyticsFilters.splice(index, 1);
                this.updateAnalytics();
            }
        },

        updateAnalyticsFilterValues(index) {
            this.analyticsFilters[index].value = '';
            this.updateAnalytics();
        },

        resetAnalyticsFilters() {
            this.analyticsFilters = [
                {
                    enabled: false,
                    column: '',
                    value: '',
                    type: 'contains'
                }
            ];
            this.updateAnalytics();
        },

        matchValue(cellValue, searchValue, type = 'contains') {
            switch (type) {
                case 'exact':
                    return cellValue === searchValue;
                case 'starts':
                    return cellValue.startsWith(searchValue);
                case 'ends':
                    return cellValue.endsWith(searchValue);
                default:
                    return cellValue.includes(searchValue);
            }
        },

        resetFilter() {
            this.filter = {
                column: '',
                value: '',
                type: 'contains',
                startDate: '',
                endDate: '',
                company: ''
            };
            this.visibleRows = [...this.rows];
            this.filteredCostStats = { totalCost: 0, avgCost: 0 };
            this.filteredCompanyCosts = [];
            this.currentPage = 1;
            this.setStatus('ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÅŸÑÿ™ÿ±', 'info');
        },

        // Pagination
        get totalPages() {
            return Math.ceil(this.visibleRows.length / this.pageSize);
        },

        get paginatedRows() {
            const start = (this.currentPage - 1) * this.pageSize;
            const end = start + this.pageSize;
            return this.visibleRows.slice(start, end);
        },

        // PII Masking
        maskValue(column, value) {
            if (!value) return '';

            const emailCols = ['email', 'ÿßŸÑÿ®ÿ±ŸäÿØ', 'ÿßŸÑÿ•ŸäŸÖŸäŸÑ'];
            const nameCols = ['name', 'ÿßŸÑÿßÿ≥ŸÖ', 'ÿßÿ≥ŸÖ', 'learner'];
            const idCols = ['id', 'ÿ±ŸÇŸÖ', 'ŸáŸàŸäÿ©'];

            const colLower = column.toLowerCase();

            if (emailCols.some(col => colLower.includes(col))) {
                return this.maskEmail(value);
            }

            if (nameCols.some(col => colLower.includes(col))) {
                return this.maskName(value);
            }

            if (idCols.some(col => colLower.includes(col))) {
                return this.maskID(value);
            }

            return value;
        },

        maskEmail(email) {
            if (!email) return '';
            const [user, domain] = String(email).split('@');
            if (!domain) return email;
            const maskedUser = user.length <= 2 ? '*'.repeat(user.length) :
                user[0] + '*'.repeat(Math.max(1, user.length - 2)) + user[user.length - 1];
            return maskedUser + '@' + domain;
        },

        maskName(name) {
            if (!name) return '';
            const str = String(name);
            return str.length <= 1 ? '*' : str[0] + '***';
        },

        maskID(id) {
            if (!id) return '';
            const str = String(id);
            if (str.length <= 4) return '*'.repeat(str.length);
            return str.slice(0, 2) + '*'.repeat(str.length - 4) + str.slice(-2);
        },

        // Email Functions
        getEmailCount() {
            const emails = this.extractEmails();
            return emails.length;
        },

        getValidEmailCount() {
            const emails = this.extractEmails();
            return emails.filter(email => this.isValidEmail(email)).length;
        },

        getDuplicateEmailCount() {
            const emails = this.extractEmails();
            const unique = new Set(emails);
            return emails.length - unique.size;
        },

        getInvalidEmailCount() {
            const emails = this.extractEmails();
            return emails.filter(email => !this.isValidEmail(email)).length;
        },

        extractEmails() {
            const emails = [];
            const emailCols = ['email', 'ÿßŸÑÿ®ÿ±ŸäÿØ', 'ÿßŸÑÿ•ŸäŸÖŸäŸÑ', 'learner: email'];

            this.visibleRows.forEach(row => {
                this.columns.forEach(col => {
                    if (emailCols.some(emailCol => col.toLowerCase().includes(emailCol))) {
                        const email = row[col];
                        if (email) emails.push(email);
                    }
                });
            });

            return emails;
        },

        isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        },

        copyEmails() {
            const emails = this.extractEmails().filter(email => this.isValidEmail(email));
            if (!emails.length) {
                this.setStatus('ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ•ŸäŸÖŸäŸÑÿßÿ™ ÿµÿßŸÑÿ≠ÿ©', 'danger');
                return;
            }

            navigator.clipboard.writeText(emails.join('\n')).then(() => {
                this.setStatus(`ÿ™ŸÖ ŸÜÿ≥ÿÆ ${emails.length} ÿ•ŸäŸÖŸäŸÑ`, 'success');
            }).catch(() => {
                this.setStatus('ŸÅÿ¥ŸÑ ŸÅŸä ŸÜÿ≥ÿÆ ÿßŸÑÿ•ŸäŸÖŸäŸÑÿßÿ™', 'danger');
            });
        },

        getEmailSubject() {
            const templates = this.currentLanguage === 'ar' ? {
                announcement: 'ÿ•ÿπŸÑÿßŸÜ ŸÖŸáŸÖ - SABIC',
                appreciation: 'ÿ¥ŸÉÿ± Ÿàÿ™ŸÇÿØŸäÿ± - SABIC',
                graduation: 'ÿ™ŸáŸÜÿ¶ÿ© ÿ®ÿßŸÑÿ™ÿÆÿ±ÿ¨ - SABIC',
                reminder: 'ÿ™ÿ∞ŸÉŸäÿ± ŸÖŸáŸÖ - SABIC',
                cancellation: 'ÿ•ÿ¥ÿπÿßÿ± ÿ•ŸÑÿ∫ÿßÿ° - SABIC'
            } : {
                announcement: 'Important Announcement - SABIC',
                appreciation: 'Appreciation & Recognition - SABIC',
                graduation: 'Graduation Congratulations - SABIC',
                reminder: 'Important Reminder - SABIC',
                cancellation: 'Cancellation Notice - SABIC'
            };
            return templates[this.emailTemplate] || (this.currentLanguage === 'ar' ? 'ÿ±ÿ≥ÿßŸÑÿ© ŸÖŸÜ SABIC' : 'Message from SABIC');
        },

        getEmailBody() {
            const templates = this.currentLanguage === 'ar' ? {
                announcement: 'ÿßŸÑÿ≥ŸÑÿßŸÖ ÿπŸÑŸäŸÉŸÖ Ÿàÿ±ÿ≠ŸÖÿ© ÿßŸÑŸÑŸá Ÿàÿ®ÿ±ŸÉÿßÿ™Ÿáÿå\n\nŸÜŸàÿØ ÿ•ÿπŸÑÿßŸÖŸÉŸÖ ÿ®ÿ£ŸÖÿ± ŸÖŸáŸÖ ŸÖÿ™ÿπŸÑŸÇ ÿ®ÿ®ÿ±ÿßŸÖÿ¨ ÿßŸÑÿ™ÿ∑ŸàŸäÿ± ŸÅŸä ÿ≥ÿßÿ®ŸÉ.\n\nŸÖÿπ ÿ£ÿ∑Ÿäÿ® ÿßŸÑÿ™ÿ≠Ÿäÿßÿ™ÿå\nŸÅÿ±ŸäŸÇ ÿßŸÑÿ™ÿ∑ŸàŸäÿ± ÿßŸÑŸÇŸäÿßÿØŸä - ÿ≥ÿßÿ®ŸÉ',
                appreciation: 'ÿßŸÑÿ≥ŸÑÿßŸÖ ÿπŸÑŸäŸÉŸÖ Ÿàÿ±ÿ≠ŸÖÿ© ÿßŸÑŸÑŸá Ÿàÿ®ÿ±ŸÉÿßÿ™Ÿáÿå\n\nŸÜÿ™ŸÇÿØŸÖ ŸÑŸÉŸÖ ÿ®ÿ¨ÿ≤ŸäŸÑ ÿßŸÑÿ¥ŸÉÿ± ŸàÿßŸÑÿ™ŸÇÿØŸäÿ± ÿπŸÑŸâ ÿ¨ŸáŸàÿØŸÉŸÖ ÿßŸÑŸÖÿ™ŸÖŸäÿ≤ÿ© ŸÅŸä ÿ®ÿ±ÿßŸÖÿ¨ ÿßŸÑÿ™ÿ∑ŸàŸäÿ±.\n\nŸÖÿπ ÿ£ÿ∑Ÿäÿ® ÿßŸÑÿ™ÿ≠Ÿäÿßÿ™ÿå\nŸÅÿ±ŸäŸÇ ÿßŸÑÿ™ÿ∑ŸàŸäÿ± ÿßŸÑŸÇŸäÿßÿØŸä - ÿ≥ÿßÿ®ŸÉ',
                graduation: 'ÿßŸÑÿ≥ŸÑÿßŸÖ ÿπŸÑŸäŸÉŸÖ Ÿàÿ±ÿ≠ŸÖÿ© ÿßŸÑŸÑŸá Ÿàÿ®ÿ±ŸÉÿßÿ™Ÿáÿå\n\nŸÜÿ™ŸÇÿØŸÖ ŸÑŸÉŸÖ ÿ®ÿ£ÿ≠ÿ± ÿßŸÑÿ™ŸáÿßŸÜŸä ÿ®ŸÖŸÜÿßÿ≥ÿ®ÿ© ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨ ÿßŸÑÿ™ÿØÿ±Ÿäÿ®Ÿä ÿ®ŸÜÿ¨ÿßÿ≠.\n\nŸÖÿπ ÿ£ÿ∑Ÿäÿ® ÿßŸÑÿ™ÿ≠Ÿäÿßÿ™ÿå\nŸÅÿ±ŸäŸÇ ÿßŸÑÿ™ÿ∑ŸàŸäÿ± ÿßŸÑŸÇŸäÿßÿØŸä - ÿ≥ÿßÿ®ŸÉ',
                reminder: 'ÿßŸÑÿ≥ŸÑÿßŸÖ ÿπŸÑŸäŸÉŸÖ Ÿàÿ±ÿ≠ŸÖÿ© ÿßŸÑŸÑŸá Ÿàÿ®ÿ±ŸÉÿßÿ™Ÿáÿå\n\nŸÜÿ∞ŸÉÿ±ŸÉŸÖ ÿ®ŸÖŸàÿπÿØ ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨ ÿßŸÑÿ™ÿØÿ±Ÿäÿ®Ÿä ÿßŸÑŸÇÿßÿØŸÖ.\n\nŸÖÿπ ÿ£ÿ∑Ÿäÿ® ÿßŸÑÿ™ÿ≠Ÿäÿßÿ™ÿå\nŸÅÿ±ŸäŸÇ ÿßŸÑÿ™ÿ∑ŸàŸäÿ± ÿßŸÑŸÇŸäÿßÿØŸä - ÿ≥ÿßÿ®ŸÉ',
                cancellation: 'ÿßŸÑÿ≥ŸÑÿßŸÖ ÿπŸÑŸäŸÉŸÖ Ÿàÿ±ÿ≠ŸÖÿ© ÿßŸÑŸÑŸá Ÿàÿ®ÿ±ŸÉÿßÿ™Ÿáÿå\n\nŸÜÿ£ÿ≥ŸÅ ŸÑÿ•ÿ®ŸÑÿßÿ∫ŸÉŸÖ ÿ®ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨ ÿßŸÑÿ™ÿØÿ±Ÿäÿ®Ÿä.\n\nŸÖÿπ ÿ£ÿ∑Ÿäÿ® ÿßŸÑÿ™ÿ≠Ÿäÿßÿ™ÿå\nŸÅÿ±ŸäŸÇ ÿßŸÑÿ™ÿ∑ŸàŸäÿ± ÿßŸÑŸÇŸäÿßÿØŸä - ÿ≥ÿßÿ®ŸÉ'
            } : {
                announcement: 'Dear Valued Participants,\n\nWe would like to inform you about an important matter regarding SABIC development programs.\n\nBest regards,\nSABIC Leadership Development Team',
                appreciation: 'Dear Valued Participants,\n\nWe extend our sincere appreciation and recognition for your outstanding efforts in our development programs.\n\nBest regards,\nSABIC Leadership Development Team',
                graduation: 'Dear Valued Participants,\n\nWe extend our warmest congratulations on successfully completing the training program.\n\nBest regards,\nSABIC Leadership Development Team',
                reminder: 'Dear Valued Participants,\n\nThis is a reminder about your upcoming training program schedule.\n\nBest regards,\nSABIC Leadership Development Team',
                cancellation: 'Dear Valued Participants,\n\nWe regret to inform you about the cancellation of the training program.\n\nBest regards,\nSABIC Leadership Development Team'
            };
            return templates[this.emailTemplate] || (this.currentLanguage === 'ar' ? 'ÿ±ÿ≥ÿßŸÑÿ© ŸÖŸÜ ŸÅÿ±ŸäŸÇ ÿ≥ÿßÿ®ŸÉ' : 'Message from SABIC Team');
        },

        generateEmail() {
            const emails = this.extractEmails().filter(email => this.isValidEmail(email));
            if (!emails.length) {
                this.setStatus('ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ•ŸäŸÖŸäŸÑÿßÿ™ ÿµÿßŸÑÿ≠ÿ©', 'danger');
                return;
            }

            const subject = this.getEmailSubject();
            const body = this.getEmailBody();
            const mailto = `mailto:?bcc=${emails.join(';')}&subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.location.href = mailto;
        },

        // Chart Functions
        drawCharts() {
            this.drawCompanyChart();
            this.drawProgramChart();
            this.drawAttendanceChart();
            this.drawTimelineChart();
            this.drawLocationChart();
            this.drawModuleChart();
        },

        drawAnalyticsChart() {
            if (!Object.keys(this.analyticsData).length) return;

            const sortedData = this.getSortedAnalyticsData();
            const labels = sortedData.map(item => item.name);
            const values = sortedData.map(item =>
                this.analytics.type === 'completion' ? item.completionRate : item.count
            );
            const percentages = sortedData.map(item => item.percentage);

            let data, layout;
            const colors = this.generateColorPalette(labels.length);

            switch (this.analytics.chartType) {
                case 'pie':
                    data = [{
                        labels: labels,
                        values: values,
                        type: 'pie',
                        textinfo: 'label+percent+value',
                        textposition: 'auto',
                        hovertemplate: '<b>%{label}</b><br>' +
                                     'ÿßŸÑŸÇŸäŸÖÿ©: %{value}<br>' +
                                     'ÿßŸÑŸÜÿ≥ÿ®ÿ©: %{percent}<br>' +
                                     '<extra></extra>',
                        marker: {
                            colors: colors,
                            line: { color: '#ffffff', width: 2 }
                        }
                    }];
                    layout = {
                        title: {
                            text: `ÿ™Ÿàÿ≤Ÿäÿπ ${this.analytics.groupBy}`,
                            font: { size: 18, color: this.isDark ? '#ffffff' : '#000000' }
                        },
                        showlegend: true,
                        legend: { orientation: 'v', x: 1.05, y: 0.5 }
                    };
                    break;

                case 'line':
                    data = [{
                        x: labels,
                        y: values,
                        type: 'scatter',
                        mode: 'lines+markers+text',
                        line: { color: '#004C97', width: 4 },
                        marker: {
                            color: '#004C97',
                            size: 10,
                            line: { color: '#ffffff', width: 2 }
                        },
                        text: values,
                        textposition: 'top center',
                        hovertemplate: '<b>%{x}</b><br>' +
                                     'ÿßŸÑŸÇŸäŸÖÿ©: %{y}<br>' +
                                     '<extra></extra>'
                    }];
                    break;

                case 'scatter':
                    data = [{
                        x: labels.map((_, i) => i + 1),
                        y: values,
                        mode: 'markers+text',
                        marker: {
                            color: values,
                            colorscale: 'Viridis',
                            size: values.map(v => Math.max(10, Math.min(30, v / Math.max(...values) * 30))),
                            line: { color: '#ffffff', width: 2 },
                            colorbar: { title: this.analytics.type === 'completion' ? 'ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤' : 'ÿßŸÑÿπÿØÿØ' }
                        },
                        text: labels,
                        textposition: 'middle center',
                        textfont: { color: '#ffffff', size: 10 },
                        type: 'scatter',
                        hovertemplate: '<b>%{text}</b><br>' +
                                     'ÿßŸÑŸÇŸäŸÖÿ©: %{y}<br>' +
                                     '<extra></extra>'
                    }];
                    break;

                default: // bar
                    data = [{
                        x: labels,
                        y: values,
                        type: 'bar',
                        text: values,
                        textposition: 'auto',
                        textfont: { color: '#ffffff', size: 12 },
                        hovertemplate: '<b>%{x}</b><br>' +
                                     'ÿßŸÑŸÇŸäŸÖÿ©: %{y}<br>' +
                                     'ÿßŸÑŸÜÿ≥ÿ®ÿ©: %{customdata}%<br>' +
                                     '<extra></extra>',
                        customdata: percentages,
                        marker: {
                            color: colors,
                            line: { color: '#ffffff', width: 1 }
                        }
                    }];
            }

            if (!layout) {
                layout = {
                    title: {
                        text: `ÿ™ÿ≠ŸÑŸäŸÑ ${this.analytics.groupBy} - ${this.analytics.type === 'completion' ? 'ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤' : 'ÿßŸÑÿπÿØÿØ'}`,
                        font: { size: 18, color: this.isDark ? '#ffffff' : '#000000' }
                    },
                    xaxis: {
                        title: this.analytics.groupBy,
                        tickangle: -45,
                        color: this.isDark ? '#ffffff' : '#000000'
                    },
                    yaxis: {
                        title: this.analytics.type === 'completion' ? 'ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ (%)' : 'ÿßŸÑÿπÿØÿØ',
                        color: this.isDark ? '#ffffff' : '#000000'
                    }
                };
            }

            // Common layout properties
            layout.font = { family: 'Arial, sans-serif', color: this.isDark ? '#ffffff' : '#000000' };
            layout.paper_bgcolor = this.isDark ? '#1F2937' : '#ffffff';
            layout.plot_bgcolor = this.isDark ? '#1F2937' : '#ffffff';
            layout.margin = { t: 60, r: 50, b: 100, l: 80 };

            if (this.isDark) {
                layout.xaxis = { ...layout.xaxis, gridcolor: '#374151', zerolinecolor: '#374151' };
                layout.yaxis = { ...layout.yaxis, gridcolor: '#374151', zerolinecolor: '#374151' };
            }

            const config = {
                displayModeBar: true,
                modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d'],
                displaylogo: false,
                responsive: true
            };

            Plotly.newPlot('analyticsChart', data, layout, config);
        },

        generateColorPalette(count) {
            const baseColors = [
                '#004C97', '#F9A11B', '#10B981', '#EF4444', '#8B5CF6',
                '#F59E0B', '#3B82F6', '#EC4899', '#14B8A6', '#F97316'
            ];

            if (count <= baseColors.length) {
                return baseColors.slice(0, count);
            }

            // Generate additional colors if needed
            const colors = [...baseColors];
            for (let i = baseColors.length; i < count; i++) {
                const hue = (i * 137.508) % 360; // Golden angle approximation
                colors.push(`hsl(${hue}, 70%, 50%)`);
            }

            return colors;
        },

        drawLocationChart() {
            if (!this.rows.length || !this.columns.includes('Location')) return;

            const locationData = {};
            this.rows.forEach(row => {
                const location = row['Location'] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
                locationData[location] = (locationData[location] || 0) + 1;
            });

            const data = [{
                labels: Object.keys(locationData),
                values: Object.values(locationData),
                type: 'pie',
                marker: {
                    colors: ['#004C97', '#F9A11B', '#10B981', '#EF4444', '#8B5CF6']
                }
            }];

            const layout = {
                title: 'ÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑŸÖŸàÿßŸÇÿπ',
                font: { family: 'Arial, sans-serif' },
                paper_bgcolor: this.isDark ? '#1F2937' : '#ffffff',
                plot_bgcolor: this.isDark ? '#1F2937' : '#ffffff'
            };

            Plotly.newPlot('locationChart', data, layout, { displayModeBar: false, responsive: true });
        },

        drawModuleChart() {
            if (!this.rows.length || !this.columns.includes('Module')) return;

            const moduleData = {};
            this.rows.forEach(row => {
                const module = row['Module'] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
                moduleData[module] = (moduleData[module] || 0) + 1;
            });

            const data = [{
                x: Object.keys(moduleData),
                y: Object.values(moduleData),
                type: 'bar',
                marker: { color: '#F9A11B' }
            }];

            const layout = {
                title: 'ÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑŸàÿ≠ÿØÿßÿ™ ÿßŸÑÿ™ÿØÿ±Ÿäÿ®Ÿäÿ©',
                xaxis: { title: 'ÿßŸÑŸàÿ≠ÿØÿ©' },
                yaxis: { title: 'ÿπÿØÿØ ÿßŸÑŸÖÿ™ÿØÿ±ÿ®ŸäŸÜ' },
                font: { family: 'Arial, sans-serif' },
                paper_bgcolor: this.isDark ? '#1F2937' : '#ffffff',
                plot_bgcolor: this.isDark ? '#1F2937' : '#ffffff'
            };

            Plotly.newPlot('moduleChart', data, layout, { displayModeBar: false, responsive: true });
        },

        exportChart() {
            if (!Object.keys(this.analyticsData).length) return;

            Plotly.downloadImage('analyticsChart', {
                format: 'png',
                width: 1200,
                height: 800,
                filename: `ÿ±ÿ≥ŸÖ_ÿ®ŸäÿßŸÜŸä_${this.analytics.groupBy}_${new Date().toISOString().split('T')[0]}`
            });
        },

        fullScreenChart() {
            const chartDiv = document.getElementById('analyticsChart');
            if (chartDiv.requestFullscreen) {
                chartDiv.requestFullscreen();
            }
        },

        drawCompanyChart() {
            if (!this.companyStats.length) return;

            const data = [{
                x: this.companyStats.map(c => c.name),
                y: this.companyStats.map(c => c.total),
                type: 'bar',
                marker: { color: '#004C97' },
                name: 'ÿπÿØÿØ ÿßŸÑŸÖÿ™ÿØÿ±ÿ®ŸäŸÜ'
            }];

            const layout = {
                title: 'ÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑŸÖÿ™ÿØÿ±ÿ®ŸäŸÜ ÿ≠ÿ≥ÿ® ÿßŸÑÿ¥ÿ±ŸÉÿ©',
                xaxis: { title: 'ÿßŸÑÿ¥ÿ±ŸÉÿ©' },
                yaxis: { title: 'ÿπÿØÿØ ÿßŸÑŸÖÿ™ÿØÿ±ÿ®ŸäŸÜ' },
                font: { family: 'Arial, sans-serif' },
                paper_bgcolor: this.isDark ? '#1F2937' : '#ffffff',
                plot_bgcolor: this.isDark ? '#1F2937' : '#ffffff'
            };

            Plotly.newPlot('companyChart', data, layout, { displayModeBar: false, responsive: true });
        },

        drawProgramChart() {
            if (!this.programStats.length) return;

            const data = [{
                labels: this.programStats.map(p => p.name),
                values: this.programStats.map(p => p.total),
                type: 'pie',
                marker: {
                    colors: ['#004C97', '#F9A11B', '#10B981', '#EF4444', '#8B5CF6', '#F59E0B', '#3B82F6', '#EC4899', '#14B8A6', '#F97316']
                }
            }];

            const layout = {
                title: 'ÿ™Ÿàÿ≤Ÿäÿπ ÿßŸÑÿ®ÿ±ÿßŸÖÿ¨ ÿßŸÑÿ™ÿØÿ±Ÿäÿ®Ÿäÿ©',
                font: { family: 'Arial, sans-serif' },
                paper_bgcolor: this.isDark ? '#1F2937' : '#ffffff',
                plot_bgcolor: this.isDark ? '#1F2937' : '#ffffff'
            };

            Plotly.newPlot('programChart', data, layout, { displayModeBar: false, responsive: true });
        },

        drawAttendanceChart() {
            const attendanceData = {};
            this.rows.forEach(row => {
                const attendance = row['Attendance'] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
                attendanceData[attendance] = (attendanceData[attendance] || 0) + 1;
            });

            const data = [{
                x: Object.keys(attendanceData),
                y: Object.values(attendanceData),
                type: 'bar',
                marker: { color: '#10B981' },
                name: 'ÿßŸÑÿ≠ÿ∂Ÿàÿ±'
            }];

            const layout = {
                title: 'ÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™ ÿßŸÑÿ≠ÿ∂Ÿàÿ±',
                xaxis: { title: 'ÿ≠ÿßŸÑÿ© ÿßŸÑÿ≠ÿ∂Ÿàÿ±' },
                yaxis: { title: 'ÿπÿØÿØ ÿßŸÑŸÖÿ™ÿØÿ±ÿ®ŸäŸÜ' },
                font: { family: 'Arial, sans-serif' },
                paper_bgcolor: this.isDark ? '#1F2937' : '#ffffff',
                plot_bgcolor: this.isDark ? '#1F2937' : '#ffffff'
            };

            Plotly.newPlot('attendanceChart', data, layout, { displayModeBar: false, responsive: true });
        },

        drawTimelineChart() {
            // Simple timeline based on available data
            const monthlyData = {};
            this.rows.forEach((row, index) => {
                const month = Math.floor(index / 50); // Simulate monthly data
                const monthName = `ÿßŸÑÿ¥Ÿáÿ± ${month + 1}`;
                monthlyData[monthName] = (monthlyData[monthName] || 0) + 1;
            });

            const data = [{
                x: Object.keys(monthlyData),
                y: Object.values(monthlyData),
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: '#8B5CF6', width: 3 },
                marker: { color: '#8B5CF6', size: 8 }
            }];

            const layout = {
                title: 'ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿπÿ®ÿ± ÿßŸÑÿ≤ŸÖŸÜ',
                xaxis: { title: 'ÿßŸÑŸÅÿ™ÿ±ÿ© ÿßŸÑÿ≤ŸÖŸÜŸäÿ©' },
                yaxis: { title: 'ÿπÿØÿØ ÿßŸÑŸÖÿ™ÿØÿ±ÿ®ŸäŸÜ' },
                font: { family: 'Arial, sans-serif' },
                paper_bgcolor: this.isDark ? '#1F2937' : '#ffffff',
                plot_bgcolor: this.isDark ? '#1F2937' : '#ffffff'
            };

            Plotly.newPlot('timelineChart', data, layout, { displayModeBar: false, responsive: true });
        },

        // Export Functions
        exportFiltered(format = null) {
            if (!this.visibleRows.length) {
                this.setStatus('ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ŸÑŸÑÿ™ÿµÿØŸäÿ±', 'danger');
                return;
            }

            const exportFormat = format || this.searchExportFormat;
            this.exportDataInFormat(this.visibleRows, exportFormat, 'Search_Results');
        },

        // Report Functions
        getCompletedCount() {
            return this.rows.filter(row => {
                const attendance = String(row['Attendance'] || '').toLowerCase();
                return attendance.includes('complete') || attendance.includes('ŸÖŸÉÿ™ŸÖŸÑ');
            }).length;
        },

        getIncompleteCount() {
            return this.rows.filter(row => {
                const attendance = String(row['Attendance'] || '').toLowerCase();
                return !attendance.includes('complete') && !attendance.includes('ŸÖŸÉÿ™ŸÖŸÑ');
            }).length;
        },

        exportReport(type) {
            if (!this.rows.length) {
                this.setStatus('ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ŸÑŸÑÿ™ÿµÿØŸäÿ±', 'danger');
                return;
            }

            let data = [];
            let filename = '';
            let sheetName = '';

            switch (type) {
                case 'complete':
                    data = this.rows.filter(row => {
                        const attendance = String(row['Attendance'] || '').toLowerCase();
                        return attendance.includes('complete') || attendance.includes('ŸÖŸÉÿ™ŸÖŸÑ');
                    });
                    filename = 'ÿ™ŸÇÿ±Ÿäÿ±_ÿßŸÑŸÖÿ™ÿØÿ±ÿ®ŸäŸÜ_ÿßŸÑŸÖŸÉÿ™ŸÖŸÑŸäŸÜ';
                    sheetName = 'ÿßŸÑŸÖŸÉÿ™ŸÖŸÑŸäŸÜ';
                    break;

                case 'incomplete':
                    data = this.rows.filter(row => {
                        const attendance = String(row['Attendance'] || '').toLowerCase();
                        return !attendance.includes('complete') && !attendance.includes('ŸÖŸÉÿ™ŸÖŸÑ');
                    });
                    filename = 'ÿ™ŸÇÿ±Ÿäÿ±_ÿßŸÑŸÖÿ™ÿØÿ±ÿ®ŸäŸÜ_ÿ∫Ÿäÿ±_ÿßŸÑŸÖŸÉÿ™ŸÖŸÑŸäŸÜ';
                    sheetName = 'ÿ∫Ÿäÿ± ÿßŸÑŸÖŸÉÿ™ŸÖŸÑŸäŸÜ';
                    break;

                case 'companies':
                    const companyData = {};
                    this.rows.forEach(row => {
                        const company = row['Learner: Company'] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
                        if (!companyData[company]) {
                            companyData[company] = { total: 0, completed: 0, incomplete: 0 };
                        }
                        companyData[company].total++;
                        const attendance = String(row['Attendance'] || '').toLowerCase();
                        if (attendance.includes('complete') || attendance.includes('ŸÖŸÉÿ™ŸÖŸÑ')) {
                            companyData[company].completed++;
                        } else {
                            companyData[company].incomplete++;
                        }
                    });

                    data = Object.keys(companyData).map(company => ({
                        'ÿßŸÑÿ¥ÿ±ŸÉÿ©': company,
                        'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ™ÿØÿ±ÿ®ŸäŸÜ': companyData[company].total,
                        'ÿßŸÑŸÖŸÉÿ™ŸÖŸÑŸäŸÜ': companyData[company].completed,
                        'ÿ∫Ÿäÿ± ÿßŸÑŸÖŸÉÿ™ŸÖŸÑŸäŸÜ': companyData[company].incomplete,
                        'ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤': Math.round((companyData[company].completed / companyData[company].total) * 100) + '%'
                    }));
                    filename = 'ÿ™ŸÇÿ±Ÿäÿ±_ÿßŸÑÿ¥ÿ±ŸÉÿßÿ™';
                    sheetName = 'ÿßŸÑÿ¥ÿ±ŸÉÿßÿ™';
                    break;

                case 'programs':
                    const programData = {};
                    this.rows.forEach(row => {
                        const program = row['Program'] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
                        if (!programData[program]) {
                            programData[program] = { total: 0, completed: 0, incomplete: 0 };
                        }
                        programData[program].total++;
                        const attendance = String(row['Attendance'] || '').toLowerCase();
                        if (attendance.includes('complete') || attendance.includes('ŸÖŸÉÿ™ŸÖŸÑ')) {
                            programData[program].completed++;
                        } else {
                            programData[program].incomplete++;
                        }
                    });

                    data = Object.keys(programData).map(program => ({
                        'ÿßŸÑÿ®ÿ±ŸÜÿßŸÖÿ¨': program,
                        'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ™ÿØÿ±ÿ®ŸäŸÜ': programData[program].total,
                        'ÿßŸÑŸÖŸÉÿ™ŸÖŸÑŸäŸÜ': programData[program].completed,
                        'ÿ∫Ÿäÿ± ÿßŸÑŸÖŸÉÿ™ŸÖŸÑŸäŸÜ': programData[program].incomplete,
                        'ŸÜÿ≥ÿ®ÿ© ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤': Math.round((programData[program].completed / programData[program].total) * 100) + '%'
                    }));
                    filename = 'ÿ™ŸÇÿ±Ÿäÿ±_ÿßŸÑÿ®ÿ±ÿßŸÖÿ¨';
                    sheetName = 'ÿßŸÑÿ®ÿ±ÿßŸÖÿ¨';
                    break;

                case 'summary':
                    this.generateExecutiveSummary();
                    return;

                default:
                    data = this.rows;
                    filename = 'ÿ™ŸÇÿ±Ÿäÿ±_ÿ¥ÿßŸÖŸÑ';
                    sheetName = 'ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™';
            }

            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, sheetName);
            XLSX.writeFile(wb, `${filename}_${new Date().toISOString().split('T')[0]}.xlsx`);
            this.setStatus(`ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ${sheetName} ÿ®ŸÜÿ¨ÿßÿ≠ (${data.length} ÿ≥ÿ¨ŸÑ)`, 'success');
        },

        toggleAllColumns(event) {
            if (event.target.checked) {
                this.selectedColumns = [...this.columns];
            } else {
                this.selectedColumns = [];
            }
        },

        exportCustomReport() {
            if (!this.selectedColumns.length) {
                this.setStatus('ÿßÿÆÿ™ÿ± ÿπŸÖŸàÿØ Ÿàÿßÿ≠ÿØ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ', 'danger');
                return;
            }

            let data = [];
            switch (this.reportFilter) {
                case 'complete':
                    data = this.rows.filter(row => {
                        const attendance = String(row['Attendance'] || '').toLowerCase();
                        return attendance.includes('complete') || attendance.includes('ŸÖŸÉÿ™ŸÖŸÑ');
                    });
                    break;
                case 'incomplete':
                    data = this.rows.filter(row => {
                        const attendance = String(row['Attendance'] || '').toLowerCase();
                        return !attendance.includes('complete') && !attendance.includes('ŸÖŸÉÿ™ŸÖŸÑ');
                    });
                    break;
                case 'current_filter':
                    data = this.visibleRows;
                    break;
                default:
                    data = this.rows;
            }

            // Filter columns
            const filteredData = data.map(row => {
                const filteredRow = {};
                this.selectedColumns.forEach(col => {
                    filteredRow[col] = row[col];
                });
                return filteredRow;
            });

            this.exportDataInFormat(filteredData, this.exportFormat, 'ÿ™ŸÇÿ±Ÿäÿ±_ŸÖÿÆÿµÿµ');

            this.setStatus(`ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ÿßŸÑÿ™ŸÇÿ±Ÿäÿ± ÿßŸÑŸÖÿÆÿµÿµ ÿ®ŸÜÿ¨ÿßÿ≠ (${filteredData.length} ÿ≥ÿ¨ŸÑ)`, 'success');
        },

        generateExecutiveSummary(format = null) {
            const useFormat = format || this.exportFormat;

            const summaryData = [
                { 'Indicator': 'Total Trainees', 'Value': this.kpis.totalRecords },
                { 'Indicator': 'Completed Trainees', 'Value': this.getCompletedCount() },
                { 'Indicator': 'Incomplete Trainees', 'Value': this.getIncompleteCount() },
                { 'Indicator': 'Overall Completion Rate', 'Value': this.kpis.completionRate + '%' },
                { 'Indicator': 'Number of Companies', 'Value': this.kpis.totalCompanies },
                { 'Indicator': 'Number of Programs', 'Value': this.kpis.totalPrograms },
                { 'Indicator': 'Number of Locations', 'Value': new Set(this.rows.map(r => r['Location'])).size },
                { 'Indicator': 'Best Company (by completion)', 'Value': this.companyStats.length > 0 ? this.companyStats[0].name : 'N/A' },
                { 'Indicator': 'Most Popular Program', 'Value': this.programStats.length > 0 ? this.programStats[0].name : 'N/A' },
                { 'Indicator': 'Report Date', 'Value': new Date().toLocaleDateString('en-US') }
            ];

            this.exportDataInFormat(summaryData, useFormat, 'Executive_Summary');
        },

        generatePerformanceReport(format = null) {
            const useFormat = format || this.exportFormat;
            const performanceData = [];

            // Company performance
            this.companyStats.forEach(company => {
                performanceData.push({
                    'Type': 'Company',
                    'Name': company.name,
                    'Count': company.total,
                    'Completion Rate': company.completionRate + '%',
                    'Rating': company.completionRate >= 80 ? 'Excellent' : company.completionRate >= 60 ? 'Good' : 'Needs Improvement'
                });
            });

            // Program performance
            this.programStats.forEach(program => {
                performanceData.push({
                    'Type': 'Program',
                    'Name': program.name,
                    'Count': program.total,
                    'Completion Rate': program.completionRate + '%',
                    'Rating': program.completionRate >= 80 ? 'Excellent' : program.completionRate >= 60 ? 'Good' : 'Needs Improvement'
                });
            });

            this.exportDataInFormat(performanceData, useFormat, 'Performance_Report');
        },

        generateDetailedAnalysis(format = null) {
            const useFormat = format || this.exportFormat;

            if (useFormat === 'excel') {
                // For Excel, create multi-sheet workbook
                const wb = XLSX.utils.book_new();

                // Main data
                const ws1 = XLSX.utils.json_to_sheet(this.rows);
                XLSX.utils.book_append_sheet(wb, ws1, 'Main Data');

                // Company analysis
                const companyAnalysis = this.generateCompanyReport();
                const ws2 = XLSX.utils.json_to_sheet(companyAnalysis);
                XLSX.utils.book_append_sheet(wb, ws2, 'Company Analysis');

                // Program analysis
                const programAnalysis = this.generateProgramReport();
                const ws3 = XLSX.utils.json_to_sheet(programAnalysis);
                XLSX.utils.book_append_sheet(wb, ws3, 'Program Analysis');

                XLSX.writeFile(wb, `Detailed_Analysis_${new Date().toISOString().split('T')[0]}.xlsx`);
                this.setStatus('ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ™ŸÅÿµŸäŸÑŸä ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
            } else {
                // For PDF/CSV, export combined data
                const combinedData = [
                    ...this.rows.slice(0, 100), // Limit for PDF
                    ...this.generateCompanyReport(),
                    ...this.generateProgramReport()
                ];
                this.exportDataInFormat(combinedData, useFormat, 'Detailed_Analysis');
            }
        },

        // Universal Export Function
        exportDataInFormat(data, format, filename) {
            const timestamp = new Date().toISOString().split('T')[0];
            const fullFilename = `${filename}_${timestamp}`;

            switch (format) {
                case 'excel':
                    const ws = XLSX.utils.json_to_sheet(data);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™');
                    XLSX.writeFile(wb, `${fullFilename}.xlsx`);
                    break;

                case 'csv':
                    const csvContent = this.convertToCSV(data);
                    this.downloadFile(csvContent, `${fullFilename}.csv`, 'text/csv;charset=utf-8;');
                    break;

                case 'pdf':
                    this.exportToPDF(data, fullFilename);
                    break;

                default:
                    this.setStatus('ÿµŸäÿ∫ÿ© ÿßŸÑÿ™ÿµÿØŸäÿ± ÿ∫Ÿäÿ± ŸÖÿØÿπŸàŸÖÿ©', 'danger');
                    return;
            }

            this.setStatus(`ÿ™ŸÖ ÿ™ÿµÿØŸäÿ± ${filename} ÿ®ÿµŸäÿ∫ÿ© ${format.toUpperCase()} ÿ®ŸÜÿ¨ÿßÿ≠`, 'success');
        },

        convertToCSV(data) {
            if (!data.length) return '';

            const headers = Object.keys(data[0]);
            const csvHeaders = headers.join(',');

            const csvRows = data.map(row =>
                headers.map(header => {
                    const value = row[header] || '';
                    // Escape commas and quotes
                    return typeof value === 'string' && (value.includes(',') || value.includes('"'))
                        ? `"${value.replace(/"/g, '""')}"`
                        : value;
                }).join(',')
            );

            return [csvHeaders, ...csvRows].join('\n');
        },

        exportToPDF(data, filename) {
            try {
                // Check if jsPDF is available in multiple ways
                let jsPDF = null;

                if (typeof window.jsPDF !== 'undefined') {
                    jsPDF = window.jsPDF;
                } else if (typeof window.jspdf !== 'undefined' && window.jspdf.jsPDF) {
                    jsPDF = window.jspdf.jsPDF;
                } else if (typeof jspdf !== 'undefined' && jspdf.jsPDF) {
                    jsPDF = jspdf.jsPDF;
                }

                if (!jsPDF) {
                    this.setStatus('ŸÖŸÉÿ™ÿ®ÿ© PDF ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±ÿ©. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ© ÿ®ÿßŸÑŸÉÿßŸÖŸÑ.', 'danger');
                    return;
                }
                const doc = new jsPDF('p', 'mm', 'a4');
                let yPosition = 20;

                // SABIC Header
                doc.setFillColor(0, 76, 151); // SABIC Blue
                doc.rect(0, 0, 210, 25, 'F');

                doc.setTextColor(255, 255, 255);
                doc.setFontSize(20);
                doc.setFont('helvetica', 'bold');
                doc.text('SABIC', 20, 15);

                doc.setFontSize(14);
                doc.setFont('helvetica', 'normal');
                doc.text('Training Analytics Report', 20, 22);

                // Reset colors and add report info
                doc.setTextColor(0, 0, 0);
                yPosition = 35;

                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                doc.text(`Report: ${filename.replace(/_/g, ' ')}`, 20, yPosition);
                yPosition += 7;

                doc.setFont('helvetica', 'normal');
                doc.text(`Generated: ${new Date().toLocaleDateString('en-US')} ${new Date().toLocaleTimeString('en-US')}`, 20, yPosition);
                yPosition += 7;

                doc.text(`Total Records: ${data.length}`, 20, yPosition);
                yPosition += 15;

                // Add summary if requested and data is available
                if (this.reportOptions.includeSummary && this.rows && this.rows.length > 0) {
                    doc.setFont('helvetica', 'bold');
                    doc.text('Executive Summary', 20, yPosition);
                    yPosition += 7;

                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(10);

                    const summaryData = [
                        `Total Trainees: ${this.kpis.totalRecords || 0}`,
                        `Completion Rate: ${this.kpis.completionRate || 0}%`,
                        `Companies: ${this.kpis.totalCompanies || 0}`,
                        `Programs: ${this.kpis.totalPrograms || 0}`,
                        `Completed: ${this.getCompletedCount ? this.getCompletedCount() : 0}`,
                        `Incomplete: ${this.getIncompleteCount ? this.getIncompleteCount() : 0}`
                    ];

                    summaryData.forEach(item => {
                        doc.text(`‚Ä¢ ${item}`, 25, yPosition);
                        yPosition += 5;
                    });

                    yPosition += 10;
                }

                // Prepare table data
                if (data && data.length > 0) {
                    const headers = Object.keys(data[0]);
                    const rows = data.map(row => headers.map(header => {
                        let value = row[header] || '';
                        // Truncate long values for PDF
                        if (typeof value === 'string' && value.length > 25) {
                            value = value.substring(0, 22) + '...';
                        }
                        return String(value);
                    }));

                    // Check if autoTable is available
                    if (doc.autoTable && typeof doc.autoTable === 'function') {
                        doc.autoTable({
                            head: [headers],
                            body: rows,
                            startY: yPosition,
                            styles: {
                                fontSize: 8,
                                cellPadding: 2,
                                overflow: 'linebreak'
                            },
                            headStyles: {
                                fillColor: [0, 76, 151], // SABIC Blue
                                textColor: 255,
                                fontStyle: 'bold'
                            },
                            alternateRowStyles: {
                                fillColor: [248, 249, 250]
                            },
                            margin: { top: yPosition, left: 10, right: 10 },
                            pageBreak: 'auto',
                            showHead: 'everyPage'
                        });

                        // Add footer to each page
                        const pageCount = doc.internal.getNumberOfPages();
                        for (let i = 1; i <= pageCount; i++) {
                            doc.setPage(i);
                            doc.setFontSize(8);
                            doc.setTextColor(128, 128, 128);
                            doc.text(`Page ${i} of ${pageCount}`, 105, 290, { align: 'center' });
                            doc.text('SABIC Training Analytics', 20, 290);
                            doc.text(new Date().toLocaleDateString('en-US'), 190, 290, { align: 'right' });
                        }
                    } else {
                        // Fallback: simple text output
                        doc.setFontSize(9);

                        // Headers
                        doc.setFont('helvetica', 'bold');
                        const headerText = headers.join(' | ');
                        if (headerText.length > 80) {
                            doc.text(headers.slice(0, 4).join(' | '), 20, yPosition);
                        } else {
                            doc.text(headerText, 20, yPosition);
                        }
                        yPosition += 7;

                        doc.setFont('helvetica', 'normal');

                        // Data rows (limit to prevent overflow)
                        const maxRows = Math.floor((270 - yPosition) / 6);
                        rows.slice(0, maxRows).forEach(row => {
                            if (yPosition > 270) return; // Page limit
                            const rowText = row.slice(0, 4).join(' | '); // Limit columns
                            doc.text(rowText, 20, yPosition);
                            yPosition += 6;
                        });

                        if (rows.length > maxRows) {
                            doc.text(`... and ${rows.length - maxRows} more records`, 20, yPosition + 5);
                        }
                    }
                } else {
                    doc.text('No data available for this report.', 20, yPosition);
                }

                // Save the PDF
                doc.save(`${filename}.pdf`);
                this.setStatus('ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ PDF ÿ®ŸÜÿ¨ÿßÿ≠', 'success');

            } catch (error) {
                console.error('PDF Export Error:', error);
                this.setStatus('ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ŸÖŸÑŸÅ PDF: ' + error.message, 'danger');
            }
        },

        downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
        },

        // Enhanced Export Functions for Reports
        exportReport(type) {
            if (!this.rows.length) {
                this.setStatus('ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ŸÑŸÑÿ™ÿµÿØŸäÿ±', 'danger');
                return;
            }

            let data = [];
            let filename = '';

            switch (type) {
                case 'complete':
                    data = this.rows.filter(row => {
                        const attendance = String(row['Attendance'] || '').toLowerCase();
                        return attendance.includes('complete') || attendance.includes('ŸÖŸÉÿ™ŸÖŸÑ');
                    });
                    filename = 'Completed_Trainees_Report';
                    break;

                case 'incomplete':
                    data = this.rows.filter(row => {
                        const attendance = String(row['Attendance'] || '').toLowerCase();
                        return !attendance.includes('complete') && !attendance.includes('ŸÖŸÉÿ™ŸÖŸÑ');
                    });
                    filename = 'Incomplete_Trainees_Report';
                    break;

                case 'companies':
                    data = this.generateCompanyReport();
                    filename = 'Companies_Analysis_Report';
                    break;

                case 'programs':
                    data = this.generateProgramReport();
                    filename = 'Programs_Analysis_Report';
                    break;

                case 'summary':
                    this.generateExecutiveSummary();
                    return;

                default:
                    data = this.rows;
                    filename = 'Complete_Training_Report';
            }

            this.exportDataInFormat(data, this.exportFormat, filename);
        },

        // Quick export buttons with format selection
        exportQuickReport(type, format) {
            const originalFormat = this.exportFormat;
            this.exportFormat = format;
            this.exportReport(type);
            this.exportFormat = originalFormat;
        },

        generateCompanyReport() {
            const companyData = {};
            this.rows.forEach(row => {
                const company = row['Learner: Company'] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
                if (!companyData[company]) {
                    companyData[company] = { total: 0, completed: 0, incomplete: 0 };
                }
                companyData[company].total++;
                const attendance = String(row['Attendance'] || '').toLowerCase();
                if (attendance.includes('complete') || attendance.includes('ŸÖŸÉÿ™ŸÖŸÑ')) {
                    companyData[company].completed++;
                } else {
                    companyData[company].incomplete++;
                }
            });

            return Object.keys(companyData).map(company => ({
                'Company': company,
                'Total Trainees': companyData[company].total,
                'Completed': companyData[company].completed,
                'Incomplete': companyData[company].incomplete,
                'Completion Rate': Math.round((companyData[company].completed / companyData[company].total) * 100) + '%'
            }));
        },

        generateProgramReport() {
            const programData = {};
            this.rows.forEach(row => {
                const program = row['Program'] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
                if (!programData[program]) {
                    programData[program] = { total: 0, completed: 0, incomplete: 0 };
                }
                programData[program].total++;
                const attendance = String(row['Attendance'] || '').toLowerCase();
                if (attendance.includes('complete') || attendance.includes('ŸÖŸÉÿ™ŸÖŸÑ')) {
                    programData[program].completed++;
                } else {
                    programData[program].incomplete++;
                }
            });

            return Object.keys(programData).map(program => ({
                'Program': program,
                'Total Trainees': programData[program].total,
                'Completed': programData[program].completed,
                'Incomplete': programData[program].incomplete,
                'Completion Rate': Math.round((programData[program].completed / programData[program].total) * 100) + '%'
            }));
        },

        // Utility Functions
        formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        },

        setStatus(message, type = 'info') {
            this.status = message;
            this.statusClass = `status-${type}`;
            setTimeout(() => {
                this.status = '';
            }, 5000);
        },

        // Settings
        saveSettings() {
            localStorage.setItem('dashboardSettings', JSON.stringify(this.settings));
            this.setStatus('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™', 'success');
        },

        loadSettings() {
            const saved = localStorage.getItem('dashboardSettings');
            if (saved) {
                this.settings = { ...this.settings, ...JSON.parse(saved) };
            }
        },

        resetSettings() {
            this.settings = {
                autoRefresh: false,
                showAnimations: true,
                compactMode: false,
                pageSize: 25,
                cacheData: true,
                dateFormat: 'dd/mm/yyyy',
                includeTimestamp: true
            };
            this.saveSettings();
            this.setStatus('ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™', 'info');
        },

        // Cost Column Detection
        detectCostColumns() {
            if (!this.rows.length) return;

            const headers = Object.keys(this.rows[0] || {});

            // Detect company column
            this.detectedColumns.company = headers.find(k =>
                /company|department|dept|ÿßŸÑÿ¥ÿ±ŸÉÿ©|ÿßŸÑŸÇÿ≥ŸÖ|ÿ¥ÿ±ŸÉÿ©|ŸÇÿ≥ŸÖ/i.test(k)
            ) || '';

            // Detect cost column
            this.detectedColumns.cost = headers.find(k =>
                /cost|ÿßŸÑÿ™ŸÉŸÑŸÅÿ©|ÿ™ŸÉŸÑŸÅ|ÿ™ŸÉŸÑŸÅÿ©|price|ÿ≥ÿπÿ±|ŸÖÿ®ŸÑÿ∫|amount/i.test(k)
            ) || '';

            // Detect program column
            this.detectedColumns.program = headers.find(k =>
                /program|course|training|ÿ®ÿ±ŸÜÿßŸÖÿ¨|ŸÉŸàÿ±ÿ≥|ÿ™ÿØÿ±Ÿäÿ®|ÿØŸàÿ±ÿ©/i.test(k)
            ) || '';

            // Detect class column
            this.detectedColumns.class = headers.find(k =>
                /class|module|session|ŸÉŸÑÿßÿ≥|Ÿàÿ≠ÿØÿ©|ÿ¨ŸÑÿ≥ÿ©|ŸÅÿµŸÑ/i.test(k)
            ) || '';
        },

        // Cost Calculation Functions
        calculateCosts() {
            if (!this.rows.length) {
                this.setStatus('ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ŸÑÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ™ŸÉÿßŸÑŸäŸÅ', 'danger');
                return;
            }

            // Use custom columns if specified, otherwise use detected ones
            const companyColumn = this.customCompanyColumn || this.detectedColumns.company;
            const costColumn = this.customCostColumn || this.detectedColumns.cost;
            const programColumn = this.detectedColumns.program;
            const classColumn = this.detectedColumns.class;

            if (!costColumn) {
                this.setStatus('ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿπŸÖŸàÿØ ÿßŸÑÿ™ŸÉŸÑŸÅÿ©. Ÿäÿ±ÿ¨Ÿâ ÿ™ÿ≠ÿØŸäÿØŸá ŸäÿØŸàŸäÿßŸã', 'danger');
                return;
            }

            // Calculate company costs
            this.companyCosts = [];
            const companyData = {};
            let grandTotal = 0;

            this.rows.forEach(row => {
                const company = row[companyColumn] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
                const cost = parseFloat(row[costColumn]) || 0;
                const program = row[programColumn] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
                const classId = row[classColumn] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';

                if (!companyData[company]) {
                    companyData[company] = {
                        name: company,
                        totalCost: 0,
                        trainees: 0,
                        classes: new Set(),
                        programs: new Set()
                    };
                }

                companyData[company].totalCost += cost;
                companyData[company].trainees++;
                companyData[company].classes.add(classId);
                companyData[company].programs.add(program);
                grandTotal += cost;
            });

            // Process company data
            Object.values(companyData).forEach(company => {
                const classCount = company.classes.size;
                const traineeCount = company.trainees;

                this.companyCosts.push({
                    name: company.name,
                    trainees: traineeCount,
                    classes: classCount,
                    totalCost: company.totalCost,
                    avgCostPerTrainee: traineeCount > 0 ? Math.round(company.totalCost / traineeCount) : 0
                });
            });

            // Sort by total cost
            this.companyCosts.sort((a, b) => b.totalCost - a.totalCost);

            // Calculate program costs
            this.programCosts = [];
            const programData = {};

            this.rows.forEach(row => {
                const program = row[programColumn] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
                const cost = parseFloat(row[costColumn]) || 0;
                const classId = row[classColumn] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';

                if (!programData[program]) {
                    programData[program] = {
                        name: program,
                        totalCost: 0,
                        trainees: 0,
                        classes: new Set()
                    };
                }

                programData[program].totalCost += cost;
                programData[program].trainees++;
                programData[program].classes.add(classId);
            });

            Object.values(programData).forEach(program => {
                const classCount = program.classes.size;
                const traineeCount = program.trainees;

                this.programCosts.push({
                    name: program.name,
                    trainees: traineeCount,
                    classes: classCount,
                    totalCost: program.totalCost,
                    avgCostPerTrainee: traineeCount > 0 ? Math.round(program.totalCost / traineeCount) : 0
                });
            });

            this.programCosts.sort((a, b) => b.totalCost - a.totalCost);

            // Calculate totals
            this.totalCost = grandTotal;
            this.totalClasses = Math.max(...this.companyCosts.map(c => c.classes), 0);
            this.averageCostPerTrainee = this.kpis.totalRecords > 0 ? Math.round(this.totalCost / this.kpis.totalRecords) : 0;

            this.costCalculated = true;
            this.setStatus('ÿ™ŸÖ ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ™ŸÉÿßŸÑŸäŸÅ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
        },

        resetCostSettings() {
            this.detectedColumns = {
                company: '',
                cost: '',
                program: '',
                class: ''
            };
            this.customCostColumn = '';
            this.customCompanyColumn = '';
            this.costCalculated = false;
            this.companyCosts = [];
            this.programCosts = [];
            this.totalCost = 0;
            this.detectCostColumns();
            this.setStatus('ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿ™ŸÉŸÑŸÅÿ©', 'info');
        },

        isMobile() { return window.matchMedia && window.matchMedia('(max-width: 768px)').matches; },

        formatCurrency(amount) {
            // Always use Western Arabic numerals (0-9) regardless of UI language
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'SAR',
                minimumFractionDigits: 0
            }).format(amount);
        },

        formatNumber(n) {
            // Always render with Western numerals
            try { return new Intl.NumberFormat('en-US', { maximumFractionDigits: 0 }).format(Number(n) || 0); } catch (e) { return String(n); }
        },

        exportCostAnalysis() {
            if (!this.costCalculated) {
                this.setStatus('ÿßÿ≠ÿ≥ÿ® ÿßŸÑÿ™ŸÉÿßŸÑŸäŸÅ ÿ£ŸàŸÑÿßŸã', 'danger');
                return;
            }

            const costData = [
                { 'Type': 'Summary', 'Name': 'Total Cost', 'Value': this.totalCost },
                { 'Type': 'Summary', 'Name': 'Total Trainees', 'Value': this.kpis.totalRecords },
                { 'Type': 'Summary', 'Name': 'Total Classes', 'Value': this.totalClasses },
                { 'Type': 'Summary', 'Name': 'Average Cost per Trainee', 'Value': this.averageCostPerTrainee },
                { 'Type': '', 'Name': '', 'Value': '' },
                ...this.companyCosts.map(company => ({
                    'Type': 'Company',
                    'Name': company.name,
                    'Trainees': company.trainees,
                    'Classes': company.classes,
                    'Total Cost': company.totalCost,
                    'Avg Cost per Trainee': company.avgCostPerTrainee
                })),
                { 'Type': '', 'Name': '', 'Value': '' },
                ...this.programCosts.map(program => ({
                    'Type': 'Program',
                    'Name': program.name,
                    'Trainees': program.trainees,
                    'Classes': program.classes,
                    'Total Cost': program.totalCost,
                    'Avg Cost per Trainee': program.avgCostPerTrainee
                }))
            ];

            this.exportDataInFormat(costData, this.costExportFormat, 'Cost_Analysis');
        },

        // Advanced Attendance Analysis Functions
        getDateColumns() {
            if (!this.rows.length) return [];

            const headers = Object.keys(this.rows[0] || {});
            return headers.filter(k =>
                /date|ÿ™ÿßÿ±ŸäÿÆ|start|end|begin|finish|ŸÖŸÜ|ÿ•ŸÑŸâ|ÿ®ÿØÿßŸäÿ©|ŸÜŸáÿßŸäÿ©|time|ŸàŸÇÿ™/i.test(k)
            );
        },

        getUniqueClasses() {
            if (!this.rows.length) return [];

            const classColumn = this.detectedColumns.class;
            if (!classColumn) return [];

            const classes = new Set();
            this.rows.forEach(row => {
                const classItem = row[classColumn];
                if (classItem && classItem.trim()) {
                    classes.add(classItem.trim());
                }
            });

            return Array.from(classes).sort();
        },

        analyzeAttendanceAdvanced() {
            if (!this.rows.length) {
                this.setStatus('ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ±', 'danger');
                return;
            }

            // Auto-detect columns if not set
            if (!this.attendanceFilter.startDateColumn) {
                const dateColumns = this.getDateColumns();
                this.attendanceFilter.startDateColumn = dateColumns.find(col =>
                    /start|begin|ÿ®ÿØÿßŸäÿ©|ŸÖŸÜ/i.test(col)
                ) || dateColumns[0] || '';
            }

            if (!this.attendanceFilter.statusColumn) {
                const headers = Object.keys(this.rows[0] || {});
                this.attendanceFilter.statusColumn = headers.find(col =>
                    /status|attendance|completion|ÿ≠ÿßŸÑÿ©|ÿ≠ÿ∂Ÿàÿ±|ÿ•ŸÜÿ¨ÿßÿ≤/i.test(col)
                ) || '';
            }

            // Filter rows based on criteria
            let filteredRows = this.rows;

            // Filter by company
            if (this.attendanceFilter.company) {
                const companyColumn = this.customCompanyColumn || this.detectedColumns.company;
                if (companyColumn) {
                    filteredRows = filteredRows.filter(row =>
                        String(row[companyColumn] || '').toLowerCase().includes(
                            this.attendanceFilter.company.toLowerCase()
                        )
                    );
                }
            }

            // Filter by class
            if (this.attendanceFilter.class) {
                const classColumn = this.detectedColumns.class;
                if (classColumn) {
                    filteredRows = filteredRows.filter(row =>
                        String(row[classColumn] || '').toLowerCase().includes(
                            this.attendanceFilter.class.toLowerCase()
                        )
                    );
                }
            }

            // Filter by date range
            if (this.attendanceFilter.startDate || this.attendanceFilter.endDate) {
                const startDateCol = this.attendanceFilter.startDateColumn;
                const endDateCol = this.attendanceFilter.endDateColumn || startDateCol;

                if (startDateCol) {
                    filteredRows = filteredRows.filter(row => {
                        const rowStartDate = this.parseDate(row[startDateCol]);
                        const rowEndDate = this.parseDate(row[endDateCol]);

                        if (!rowStartDate) return false;

                        const filterStart = this.attendanceFilter.startDate ? new Date(this.attendanceFilter.startDate) : null;
                        const filterEnd = this.attendanceFilter.endDate ? new Date(this.attendanceFilter.endDate) : null;

                        if (filterStart && rowStartDate < filterStart) return false;
                        if (filterEnd && (rowEndDate || rowStartDate) > filterEnd) return false;

                        return true;
                    });
                }
            }

            // Analyze attendance status
            let completed = 0;
            let dropped = 0;
            let inProgress = 0;

            const statusColumn = this.attendanceFilter.statusColumn;

            filteredRows.forEach(row => {
                const attendance = String(row['Attendance'] || '').toLowerCase();
                const status = String(row['Status'] || '').toLowerCase();
                const completion = String(row['Completion'] || '').toLowerCase();
                const customStatus = statusColumn ? String(row[statusColumn] || '').toLowerCase() : '';

                const allStatus = `${attendance} ${status} ${completion} ${customStatus}`;

                if (allStatus.includes('complete') || allStatus.includes('ŸÖŸÉÿ™ŸÖŸÑ') ||
                    allStatus.includes('graduated') || allStatus.includes('ÿ™ÿÆÿ±ÿ¨') ||
                    allStatus.includes('finished') || allStatus.includes('ÿßŸÜÿ™ŸáŸâ') ||
                    completion === '100%' || allStatus.includes('passed')) {
                    completed++;
                } else if (allStatus.includes('drop') || allStatus.includes('withdraw') ||
                          allStatus.includes('ŸÖŸÜÿ≥ÿ≠ÿ®') || allStatus.includes('ÿßŸÜÿ≥ÿ≠ÿ®') ||
                          allStatus.includes('absent') || allStatus.includes('cancelled') ||
                          allStatus.includes('failed') || allStatus.includes('ÿ±ÿ≥ÿ®')) {
                    dropped++;
                } else {
                    inProgress++;
                }
            });

            this.attendanceStats = {
                total: filteredRows.length,
                completed: completed,
                dropped: dropped,
                inProgress: inProgress
            };

            // Analyze by company
            this.analyzeAttendanceByCompany(filteredRows);

            // Analyze by class
            this.analyzeAttendanceByClass(filteredRows);

            this.attendanceAnalyzed = true;
            this.setStatus(`ÿ™ŸÖ ÿ™ÿ≠ŸÑŸäŸÑ ${filteredRows.length} ÿ≥ÿ¨ŸÑ ÿ®ŸÜÿ¨ÿßÿ≠`, 'success');
        },

        analyzeAttendanceByCompany(filteredRows) {
            const companyColumn = this.customCompanyColumn || this.detectedColumns.company;
            if (!companyColumn) {
                this.attendanceByCompany = [];
                return;
            }

            const companyData = {};
            const statusColumn = this.attendanceFilter.statusColumn;

            filteredRows.forEach(row => {
                const company = row[companyColumn] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';

                if (!companyData[company]) {
                    companyData[company] = {
                        name: company,
                        total: 0,
                        completed: 0,
                        dropped: 0,
                        inProgress: 0
                    };
                }

                companyData[company].total++;

                const attendance = String(row['Attendance'] || '').toLowerCase();
                const status = String(row['Status'] || '').toLowerCase();
                const completion = String(row['Completion'] || '').toLowerCase();
                const customStatus = statusColumn ? String(row[statusColumn] || '').toLowerCase() : '';

                const allStatus = `${attendance} ${status} ${completion} ${customStatus}`;

                if (allStatus.includes('complete') || allStatus.includes('ŸÖŸÉÿ™ŸÖŸÑ') ||
                    allStatus.includes('graduated') || completion === '100%') {
                    companyData[company].completed++;
                } else if (allStatus.includes('drop') || allStatus.includes('withdraw') ||
                          allStatus.includes('ŸÖŸÜÿ≥ÿ≠ÿ®') || allStatus.includes('absent')) {
                    companyData[company].dropped++;
                } else {
                    companyData[company].inProgress++;
                }
            });

            this.attendanceByCompany = Object.values(companyData).sort((a, b) => b.total - a.total);
        },

        analyzeAttendanceByClass(filteredRows) {
            const classColumn = this.detectedColumns.class;
            if (!classColumn) {
                this.attendanceByClass = [];
                return;
            }

            const classData = {};
            const statusColumn = this.attendanceFilter.statusColumn;

            filteredRows.forEach(row => {
                const classItem = row[classColumn] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';

                if (!classData[classItem]) {
                    classData[classItem] = {
                        name: classItem,
                        total: 0,
                        completed: 0,
                        dropped: 0,
                        inProgress: 0
                    };
                }

                classData[classItem].total++;

                const attendance = String(row['Attendance'] || '').toLowerCase();
                const status = String(row['Status'] || '').toLowerCase();
                const completion = String(row['Completion'] || '').toLowerCase();
                const customStatus = statusColumn ? String(row[statusColumn] || '').toLowerCase() : '';

                const allStatus = `${attendance} ${status} ${completion} ${customStatus}`;

                if (allStatus.includes('complete') || allStatus.includes('ŸÖŸÉÿ™ŸÖŸÑ') ||
                    allStatus.includes('graduated') || completion === '100%') {
                    classData[classItem].completed++;
                } else if (allStatus.includes('drop') || allStatus.includes('withdraw') ||
                          allStatus.includes('ŸÖŸÜÿ≥ÿ≠ÿ®') || allStatus.includes('absent')) {
                    classData[classItem].dropped++;
                } else {
                    classData[classItem].inProgress++;
                }
            });

            this.attendanceByClass = Object.values(classData).sort((a, b) => b.total - a.total);
        },

        resetAttendanceFilter() {
            this.attendanceFilter = {
                startDate: '',
                endDate: '',
                company: '',
                class: '',
                startDateColumn: '',
                endDateColumn: '',
                statusColumn: ''
            };
            this.attendanceAnalyzed = false;
            this.attendanceStats = {
                total: 0,
                completed: 0,
                dropped: 0,
                inProgress: 0
            };
            this.attendanceByCompany = [];
            this.attendanceByClass = [];
            this.setStatus('ÿ™ŸÖ ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÅŸÑÿßÿ™ÿ± ÿßŸÑÿ≠ÿ∂Ÿàÿ±', 'info');
        },

        exportAttendanceReport() {
            if (!this.attendanceAnalyzed) {
                this.setStatus('ŸÇŸÖ ÿ®ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ≠ÿ∂Ÿàÿ± ÿ£ŸàŸÑÿßŸã', 'danger');
                return;
            }

            const reportData = [
                { 'Type': 'Summary', 'Name': 'Total Filtered', 'Value': this.attendanceStats.total },
                { 'Type': 'Summary', 'Name': 'Completed', 'Value': this.attendanceStats.completed },
                { 'Type': 'Summary', 'Name': 'Dropped', 'Value': this.attendanceStats.dropped },
                { 'Type': 'Summary', 'Name': 'In Progress', 'Value': this.attendanceStats.inProgress },
                { 'Type': 'Summary', 'Name': 'Completion Rate', 'Value': this.attendanceStats.total > 0 ? Math.round(this.attendanceStats.completed / this.attendanceStats.total * 100) + '%' : '0%' },
                { 'Type': '', 'Name': '', 'Value': '' },
                ...this.attendanceByCompany.map(company => ({
                    'Type': 'Company',
                    'Name': company.name,
                    'Total': company.total,
                    'Completed': company.completed,
                    'Dropped': company.dropped,
                    'In Progress': company.inProgress,
                    'Completion Rate': company.total > 0 ? Math.round(company.completed / company.total * 100) + '%' : '0%'
                })),
                { 'Type': '', 'Name': '', 'Value': '' },
                ...this.attendanceByClass.map(classItem => ({
                    'Type': 'Class',
                    'Name': classItem.name,
                    'Total': classItem.total,
                    'Completed': classItem.completed,
                    'Dropped': classItem.dropped,
                    'In Progress': classItem.inProgress,
                    'Completion Rate': classItem.total > 0 ? Math.round(classItem.completed / classItem.total * 100) + '%' : '0%'
                }))
            ];

            this.exportDataInFormat(reportData, this.costExportFormat, 'Attendance_Report');
        },

        // Advanced Search Functions
        isDateColumn(columnName) {
            if (!columnName) return false;
            return /date|ÿ™ÿßÿ±ŸäÿÆ|start|end|begin|finish|ŸÖŸÜ|ÿ•ŸÑŸâ|ÿ®ÿØÿßŸäÿ©|ŸÜŸáÿßŸäÿ©/i.test(columnName);
        },

        parseDate(dateValue) {
            if (!dateValue) return null;

            // Try different date formats
            const dateStr = String(dateValue).trim();

            // ISO format (YYYY-MM-DD)
            if (/^\d{4}-\d{2}-\d{2}/.test(dateStr)) {
                return new Date(dateStr);
            }

            // DD/MM/YYYY or MM/DD/YYYY
            if (/^\d{1,2}\/\d{1,2}\/\d{4}/.test(dateStr)) {
                return new Date(dateStr);
            }

            // Try general parsing
            const parsed = new Date(dateStr);
            return isNaN(parsed.getTime()) ? null : parsed;
        },

        getUniqueCompanies() {
            if (!this.rows.length) return [];

            const companyColumn = this.customCompanyColumn || this.detectedColumns.company;
            if (!companyColumn) return [];

            const companies = new Set();
            this.rows.forEach(row => {
                const company = row[companyColumn];
                if (company && company.trim()) {
                    companies.add(company.trim());
                }
            });

            return Array.from(companies).sort();
        },

        calculateFilteredCosts() {
            if (!this.visibleRows.length) {
                this.filteredCostStats = { totalCost: 0, avgCost: 0 };
                this.filteredCompanyCosts = [];
                return;
            }

            const costColumn = this.customCostColumn || this.detectedColumns.cost;
            const companyColumn = this.customCompanyColumn || this.detectedColumns.company;
            const classColumn = this.detectedColumns.class;

            if (!costColumn) {
                this.filteredCostStats = { totalCost: 0, avgCost: 0 };
                this.filteredCompanyCosts = [];
                return;
            }

            let totalCost = 0;
            const companyData = {};

            this.visibleRows.forEach(row => {
                const cost = parseFloat(row[costColumn]) || 0;
                const company = row[companyColumn] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
                const classId = row[classColumn] || 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';

                totalCost += cost;

                if (!companyData[company]) {
                    companyData[company] = {
                        name: company,
                        totalCost: 0,
                        trainees: 0,
                        classes: new Set()
                    };
                }

                companyData[company].totalCost += cost;
                companyData[company].trainees++;
                companyData[company].classes.add(classId);
            });

            this.filteredCostStats = {
                totalCost: totalCost,
                avgCost: this.visibleRows.length > 0 ? Math.round(totalCost / this.visibleRows.length) : 0
            };

            this.filteredCompanyCosts = Object.values(companyData).map(company => ({
                name: company.name,
                totalCost: company.totalCost,
                trainees: company.trainees,
                classes: company.classes.size,
                avgCost: company.trainees > 0 ? Math.round(company.totalCost / company.trainees) : 0
            })).sort((a, b) => b.totalCost - a.totalCost);
        },

        getFilteredClassesCount() {
            if (!this.visibleRows.length) return 0;

            const classColumn = this.detectedColumns.class;
            if (!classColumn) return 0;

            const classes = new Set();
            this.visibleRows.forEach(row => {
                const classId = row[classColumn];
                if (classId && classId.trim()) {
                    classes.add(classId.trim());
                }
            });

            return classes.size;
        },

        getTotalClasses() {
            if (!this.rows.length) return 1;

            const classColumn = this.detectedColumns.class;
            if (!classColumn) return 1;

            const classes = new Set();
            this.rows.forEach(row => {
                const classId = row[classColumn];
                if (classId && classId.trim()) {
                    classes.add(classId.trim());
                }
            });

            return Math.max(classes.size, 1);
        },

        getTotalCost() {
            if (!this.rows.length) return 1;

            const costColumn = this.customCostColumn || this.detectedColumns.cost;
            if (!costColumn) return 1;

            let total = 0;
            this.rows.forEach(row => {
                total += parseFloat(row[costColumn]) || 0;
            });

            return Math.max(total, 1);
        },

        getDateRangeText() {
            if (!this.filter.startDate && !this.filter.endDate) {
                return 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
            }

            const start = this.filter.startDate || 'ÿßŸÑÿ®ÿØÿßŸäÿ©';
            const end = this.filter.endDate || 'ÿßŸÑŸÜŸáÿßŸäÿ©';

            return `${start} - ${end}`;
        },

        getDailyCostAverage() {
            if (!this.filter.startDate || !this.filter.endDate || this.filteredCostStats.totalCost === 0) {
                return 0;
            }

            const startDate = new Date(this.filter.startDate);
            const endDate = new Date(this.filter.endDate);
            const daysDiff = Math.max(1, Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)));

            return Math.round(this.filteredCostStats.totalCost / daysDiff);
        },

        getTopCostCompany() {
            if (!this.filteredCompanyCosts.length) return 'ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ';
            return this.filteredCompanyCosts[0].name;
        },

        getAvgTraineesPerClass() {
            const classesCount = this.getFilteredClassesCount();
            if (classesCount === 0) return 0;

            return Math.round(this.visibleRows.length / classesCount);
        }
    };
}
</script>

</body>
</html>
